## Activity Log (80+ Required) â€” Entry 9: UK Biobank Feature Synonym Generation

**Hours:** 5  
**Date:** 2025-08-13  
**Next Steps:** The next step involves applying named entity recognition (NER) models to the enriched feature set with synonyms to detect and tag biomedical entities such as diseases, drugs, procedures, and anatomy in text.  
**Category:** ðŸ§¬ Feature Selection  
**Summary:**  
The document outlines a project aimed at generating medically accurate synonyms for UK Biobank feature titles to enhance search and retrieval across scientific literature. The process involves data preparation, synonym generation using an API, validation through two stages, and concludes with a next step for tagging enriched feature sets.  

**Nr:** 9  
**Entry:** UK Biobank Feature Synonym Generation  

## Content


```markdown
## Objective
Generate medically accurate synonyms for UK Biobank feature titles. Each feature receives exactly **5 alternative forms** that reflect how terms appear across scientific literature. The goal is to improve search and retrieval by covering abbreviations, formal terms, informal usage, measurement-focused variants, and regional (British English) differences.

---

## Process

1. **Data Preparation**
   - Input: `uk_biobank_features_worked.csv` containing feature titles.

2. **Synonym Generation**
   - Powered by Claude 3.7 Sonnet via OpenRouter API.  
   - Five synonyms per feature generated under strict rules:  
     - Common abbreviation (e.g., *BMI* for body mass index).  
     - Formal medical term.  
     - Informal/methods-section usage.  
     - Measurement-focused description.  
     - British English variant if different.  

3. **Batch Processing**
   - Features processed in batches (default: 30).  
   - Balances API rate limits and cost management.  
   - Supports incremental execution and recovery.

4. **Containerization**
   - Entire workflow runs inside Docker containers for reproducibility.  

5. **Two-Stage Validation**
   - **LLM-based (Llama 3.1 70B)**: Checks rule adherence, conciseness, medical appropriateness, and contextual relevance.  
   - **Embedding-based**: Biomedical sentence transformers calculate cosine similarity; threshold â‰¥0.85 required for pass.  

---

## Validation

1. **Qualitative Validation (LLM)**
   - Confirms each set meets the 5-category rules.  
   - Example:  
     - *â€œDate I71 first reported (aortic aneurysm and dissection)â€* â†’  
       `I71 diagnosis date; aortic aneurysm onset; initial dissection documentation; aneurysm detection timing; aortic rupture diagnosis`  
       > Verdict: Meets abbreviation, formal, informal, measurement, and regional coverage.  
     - *â€œIGF-1 assay dateâ€* â†’  
       `IGF-1 date; insulin-like growth factor measurement date; serum IGF-1 collection; IGF-1 sampling timepoint; IGF-1 assay timing`  
       > Verdict: Fully meets criteria across all categories.  

2. **GPU-Accelerated Semantic Validation**
   - Run on NVIDIA RTX 6000 Pro Blackwell GPUs.  
   - Primary model: `MohammadKhodadad/MedTE-cl15-step-8000`.  
   - Fallback: `cambridgeltl/SapBERT-from-PubMedBERT-fulltext`.  
   - Cosine similarity threshold: 0.85.  
   - Outputs both **tidy format** (per title-variant pair) and **wide format** (one row per feature).  

---

## Reflection

1. **Terminology Complexity**
   - Medical language is inconsistent across contexts, specialties, and geographies.  
   - The 5-rule system forces coverage across the most important usage categories.  

2. **Quality vs Quantity**
   - Early runs produced 10+ synonyms per term, with redundancy.  
   - Limiting to 5 forced precision and reduced noise.  

3. **Validation Challenges**
   - LLM checks captured linguistic nuance but sometimes allowed weak synonyms.  
   - Embedding similarity was quantitative but context-blind.  
   - Using both methods balanced these weaknesses.  

4. **GPU Optimization**
   - Validation workloads required significant compute.  
   - CUDA 12.8 with TF32/FP8 precision + batching reduced runtime from days to hours.  

5. **Docker Integration**
   - Ensured reproducibility.  
   - Extra care needed for secure API key handling, file permissions, and GPU passthrough.  

6. **Batch Processing**
   - Necessary for cost and rate limits.  
   - Added complexity for resuming failed runs.  
   - Solved with `parallel_run.sh` to manage execution.  

---

## Next Step
Proceed to **tagging** in `data_conversion/ukb/4_tagging/`.  
- Apply NER models to enriched feature set with synonyms.  
- Detect and tag biomedical entities (diseases, drugs, procedures, anatomy) in text.
```





