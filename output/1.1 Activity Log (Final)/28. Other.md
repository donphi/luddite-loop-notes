# Other


## Content




~~~{=html}
<pre class="notion-ascii-diagram"><code>╔══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                         STAGE 1: ALIAS DISCOVERY — COMPLETE HYPERPARAMETER REFERENCE                                                             ║
║                                                                    (01_mine_aliases.py)                                                                                           ║
║                                                                                                                                                                                   ║
║  CONFIG FILES:                                                                                                                                                                    ║
║    • feature_extraction.yaml — ALL quality, embedding, collocation, and output parameters                                                                                        ║
║    • paper_extract_es.yaml   — Extraction zone definitions (source_type values)                                                                                                  ║
║    • resources.yaml          — Elasticsearch connection and indexing settings                                                                                                    ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                                                                      │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  STEP 1: GENERATE BASE ALIASES (generate_base_aliases)                                                                                                                               │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│                                                                                                                                                                                      │
│  INPUT: feature from ukb_fields table                                                                                                                                                │
│    ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐                   │
│    │  field_id:       &quot;21001&quot;                                                                                                                                    │                   │
│    │  title:          &quot;Body mass index (BMI)&quot;                                                                                                                    │                   │
│    │  units:          &quot;kg/m2&quot;                                                                                                                                    │                   │
│    │  acr_abb_1:      &quot;BMI&quot;                                                                                                                                      │                   │
│    │  acr_abb_2:      &quot;body mass index&quot;                                                                                                                          │                   │
│    │  acr_abb_3..15:  (additional curated acronyms/abbreviations if any)                                                                                         │                   │
│    │  category_title: &quot;Physical measures&quot;                                                                                                                        │                   │
│    │  notes:          &quot;Calculated as weight/height^2...&quot;                                                                                                         │                   │
│    └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘                   │
│                                                                                                                                                                                      │
│  ALIAS GENERATION SOURCES:                                                                                                                                                           │
│                                                                                                                                                                                      │
│    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│    │  SOURCE 1: Field ID Patterns (HIGH TRUST)                                                                                                                                    │ │
│    │  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── │ │
│    │  Config: field_id_patterns.templates (feature_extraction.yaml lines 321-371)                                                                                                │ │
│    │  Config: field_id_patterns.generate_lowercase_variants: true                                                                                                                 │ │
│    │                                                                                                                                                                              │ │
│    │  For field_id = &quot;21001&quot;, generates ~70 patterns:                                                                                                                             │ │
│    │                                                                                                                                                                              │ │
│    │    TEMPLATE                          │  GENERATED ALIAS             │  NOTES                                                                                                │ │
│    │    ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────                             │ │
│    │    &quot;field {id}&quot;                      │  &quot;field 21001&quot;               │  Standard reference                                                                                   │ │
│    │    &quot;feature {id}&quot;                    │  &quot;feature 21001&quot;             │  Alternative reference                                                                                │ │
│    │    &quot;field id {id}&quot;                   │  &quot;field id 21001&quot;            │  Explicit ID reference                                                                                │ │
│    │    &quot;id {id}&quot;                         │  &quot;id 21001&quot;                  │  Short form                                                                                           │ │
│    │    &quot;field_id {id}&quot;                   │  &quot;field_id 21001&quot;            │  Underscore variant                                                                                   │ │
│    │    &quot;biomarker {id}&quot;                  │  &quot;biomarker 21001&quot;           │  UKB-specific                                                                                         │ │
│    │    &quot;phenotype {id}&quot;                  │  &quot;phenotype 21001&quot;           │  UKB-specific                                                                                         │ │
│    │    &quot;data-field {id}&quot;                 │  &quot;data-field 21001&quot;          │  UKB-specific                                                                                         │ │
│    │    &quot;ukb {id}&quot;                        │  &quot;ukb 21001&quot;                 │  UK Biobank prefix                                                                                    │ │
│    │    &quot;ukb:{id}&quot;                        │  &quot;ukb:21001&quot;                 │  Colon separator                                                                                      │ │
│    │    &quot;ukb-{id}&quot;                        │  &quot;ukb-21001&quot;                 │  Dash separator                                                                                       │ │
│    │    &quot;ukb_{id}&quot;                        │  &quot;ukb_21001&quot;                 │  Underscore separator                                                                                 │ │
│    │    &quot;ukb.{id}&quot;                        │  &quot;ukb.21001&quot;                 │  Dot separator                                                                                        │ │
│    │    &quot;f.{id}&quot;                          │  &quot;f.21001&quot;                   │  Short prefix                                                                                         │ │
│    │    &quot;f{id}&quot;                           │  &quot;f21001&quot;                    │  Compact prefix                                                                                       │ │
│    │    &quot;F{id}&quot;                           │  &quot;F21001&quot;                    │  Uppercase compact                                                                                    │ │
│    │    &quot;variable {id}&quot;                   │  &quot;variable 21001&quot;            │  Data reference                                                                                       │ │
│    │    &quot;var {id}&quot;                        │  &quot;var 21001&quot;                 │  Short data reference                                                                                 │ │
│    │    &quot;code {id}&quot;                       │  &quot;code 21001&quot;                │  Code reference                                                                                       │ │
│    │    &quot;data code {id}&quot;                  │  &quot;data code 21001&quot;           │  Explicit code reference                                                                              │ │
│    │    &quot;measure {id}&quot;                    │  &quot;measure 21001&quot;             │  Measurement reference                                                                                │ │
│    │    &quot;metric {id}&quot;                     │  &quot;metric 21001&quot;              │  Metric reference                                                                                     │ │
│    │    &quot;item {id}&quot;                       │  &quot;item 21001&quot;                │  Item reference                                                                                       │ │
│    │    &quot;col {id}&quot;                        │  &quot;col 21001&quot;                 │  Column reference                                                                                     │ │
│    │    &quot;column {id}&quot;                     │  &quot;column 21001&quot;              │  Full column reference                                                                                │ │
│    │    &quot;number {id}&quot;                     │  &quot;number 21001&quot;              │  Number reference                                                                                     │ │
│    │    &quot;field:{id}&quot;                      │  &quot;field:21001&quot;               │  Colon variant                                                                                        │ │
│    │    &quot;({id})&quot;                          │  &quot;(21001)&quot;                   │  Parenthesized                                                                                        │ │
│    │    &quot;[{id}]&quot;                          │  &quot;[21001]&quot;                   │  Bracketed                                                                                            │ │
│    │    &quot;#{id}&quot;                           │  &quot;#21001&quot;                    │  Hash prefix                                                                                          │ │
│    │    &#39;&quot;{id}&quot;&#39;                          │  &#39;&quot;21001&quot;&#39;                   │  Double-quoted                                                                                        │ │
│    │    &quot;&#39;{id}&#39;&quot;                          │  &quot;&#39;21001&#39;&quot;                   │  Single-quoted                                                                                        │ │
│    │                                                                                                                                                                              │ │
│    │  PLUS additional_variants (not case-duplicated):                                                                                                                             │ │
│    │    &quot;field-{id}&quot;   →  &quot;field-21001&quot;                                                                                                                                           │ │
│    │    &quot;field_{id}&quot;   →  &quot;field_21001&quot;                                                                                                                                           │ │
│    │    &quot;feature-{id}&quot; →  &quot;feature-21001&quot;                                                                                                                                         │ │
│    │    &quot;feature_{id}&quot; →  &quot;feature_21001&quot;                                                                                                                                         │ │
│    │                                                                                                                                                                              │ │
│    │  PLUS lowercase variants if generate_lowercase_variants: true                                                                                                                │ │
│    │    Each template generates BOTH: &quot;Field 21001&quot; AND &quot;field 21001&quot;                                                                                                             │ │
│    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                                                      │
│    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│    │  SOURCE 2: Title Variations                                                                                                                                                  │ │
│    │  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── │ │
│    │  Config: quality.min_word_count: 1                                                                                                                                           │ │
│    │  Config: tokenizer.spacy_model: &quot;en_core_web_sm&quot;                                                                                                                             │ │
│    │                                                                                                                                                                              │ │
│    │  title = &quot;Body mass index (BMI)&quot;                                                                                                                                             │ │
│    │                                                                                                                                                                              │ │
│    │  GENERATED ALIASES:                                                                                                                                                          │ │
│    │    • &quot;Body mass index (BMI)&quot;        ← Original title (exact case)                                                                                                            │ │
│    │    • &quot;body mass index (bmi)&quot;        ← Lowercase version                                                                                                                      │ │
│    │    • &quot;body mass index&quot;              ← Lemmatized (spaCy), stopwords removed                                                                                                  │ │
│    │                                         Only if result has &gt;= min_word_count (1) words                                                                                       │ │
│    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                                                      │
│    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│    │  SOURCE 3: Curated Acronyms (from DuckDB acr_abb_1..15 columns)                                                                                                              │ │
│    │  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── │ │
│    │                                                                                                                                                                              │ │
│    │  For each acr_abb_N column (N = 1 to 15):                                                                                                                                    │ │
│    │    if acr_abb_N is not null/empty:                                                                                                                                           │ │
│    │      add to aliases: acr_abb_N                                                                                                                                               │ │
│    │      add to aliases: acr_abb_N.lower()                                                                                                                                       │ │
│    │      mark as CURATED_ACRONYM (gets special threshold treatment in Stage 2)                                                                                                  │ │
│    │                                                                                                                                                                              │ │
│    │  Example for field 21001:                                                                                                                                                    │ │
│    │    acr_abb_1 = &quot;BMI&quot;           →  adds &quot;BMI&quot;, &quot;bmi&quot;  (both marked as curated)                                                                                                │ │
│    │    acr_abb_2 = &quot;body mass index&quot; →  adds &quot;body mass index&quot; (marked as curated)                                                                                               │ │
│    │                                                                                                                                                                              │ │
│    │  CURATED ACRONYMS get special treatment:                                                                                                                                     │ │
│    │    • BYPASS some quality filters (trusted source)                                                                                                                            │ │
│    │    • Use length-based thresholds in Stage 2 scoring                                                                                                                          │ │
│    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                                                      │
│  OUTPUT: base_aliases = [&quot;21001&quot;, &quot;field 21001&quot;, &quot;Field 21001&quot;, &quot;feature 21001&quot;, ..., &quot;Body mass index (BMI)&quot;, &quot;body mass index (bmi)&quot;, &quot;BMI&quot;, &quot;bmi&quot;, ...]                           │
│          curated_acronyms = {&quot;BMI&quot;, &quot;bmi&quot;, &quot;body mass index&quot;}  ← These get special threshold treatment                                                                               │
│                                                                                                                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                                            │
                                                                                            ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                                                                      │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  STEP 2: QUALITY FILTER (is_clean_alias)                                                                                                                                             │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│                                                                                                                                                                                      │
│  For each base_alias, query Elasticsearch for document counts:                                                                                                                       │
│                                                                                                                                                                                      │
│    ES QUERY (batch via msearch):                                                                                                                                                     │
│    ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│    │  {                                                                                                                                                                          │   │
│    │    &quot;query&quot;: {                                                                                                                                                               │   │
│    │      &quot;bool&quot;: {                                                                                                                                                              │   │
│    │        &quot;must&quot;: [                                                                                                                                                            │   │
│    │          {&quot;match_phrase&quot;: {&quot;text_lower&quot;: &quot;bmi&quot;}}   ← Case-insensitive phrase match                                                                                          │   │
│    │        ]                                                                                                                                                                    │   │
│    │      }                                                                                                                                                                      │   │
│    │    },                                                                                                                                                                       │   │
│    │    &quot;aggs&quot;: {                                                                                                                                                                │   │
│    │      &quot;by_source_type&quot;: {                                                                                                                                                    │   │
│    │        &quot;terms&quot;: {&quot;field&quot;: &quot;source_type&quot;}   ← Count hits per source_type                                                                                                    │   │
│    │      }                                                                                                                                                                      │   │
│    │    },                                                                                                                                                                       │   │
│    │    &quot;track_total_hits&quot;: true                ← Config: elasticsearch.track_total_hits: true                                                                                  │   │
│    │  }                                                                                                                                                                          │   │
│    └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                                                                                                      │
│    RETURNS: counts = (text_hits, table_hits, doc_count)                                                                                                                              │
│      • text_hits:  hits in source_types = {body, abstract, title, section_header, caption}                                                                                          │
│      • table_hits: hits in source_types = {table_header, table_row_header, table_data_cell}                                                                                         │
│      • doc_count:  unique documents containing the alias                                                                                                                             │
│                                                                                                                                                                                      │
│    Config: retrieval.alias_batch_size: 100   ← Batch size for msearch                                                                                                               │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 1: TABLE ARTIFACT BLACKLIST (is_table_artifact)                                                                                                                                │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: table_artifacts.blacklist (feature_extraction.yaml lines 265-287)                                                                                                          │
│  Config: table_artifacts.single_char_exceptions: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]                                                                                                                     │
│  Config: table_artifacts.max_dashes: 2                                                                                                                                               │
│                                                                                                                                                                                      │
│    BLACKLIST = [                                                                                                                                                                     │
│      &quot;|&quot;, &quot;||&quot;, &quot;|||&quot;,                          ← Table separators                                                                                                                   │
│      &quot;-&quot;, &quot;--&quot;, &quot;---&quot;,                          ← Row separators                                                                                                                     │
│      &quot;figure&quot;, &quot;table&quot;, &quot;fig&quot;, &quot;vid&quot;,           ← Table/figure labels                                                                                                                │
│      &quot;ci&quot;, &quot;%&quot;,                                 ← Statistical notation                                                                                                               │
│      &quot;n/a&quot;, &quot;na&quot;, &quot;null&quot;,                       ← Missing value indicators                                                                                                           │
│      &quot;confidence interval&quot;, &quot;ci %&quot;, &quot;% ci&quot;,     ← Statistical phrases                                                                                                                │
│      &quot;figure vid&quot;, &quot;vid figure&quot;, &quot;table vid&quot;    ← Document references                                                                                                                │
│    ]                                                                                                                                                                                 │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      if alias.lower().strip() in BLACKLIST:                                                                                                                                          │
│        → REJECT                                                                                                                                                                      │
│                                                                                                                                                                                      │
│      if len(alias) == 1:                                                                                                                                                             │
│        if alias.lower() not in single_char_exceptions:                                                                                                                               │
│          → REJECT   (single chars like &quot;1&quot;, &quot;x&quot;, &quot;%&quot; are artifacts)                                                                                                                  │
│                                                                                                                                                                                      │
│      if alias contains only dashes and count &gt; max_dashes (2):                                                                                                                       │
│        → REJECT   (&quot;---&quot; = artifact, &quot;-&quot; and &quot;--&quot; might be valid)                                                                                                                    │
│                                                                                                                                                                                      │
│    ✗ REJECT EXAMPLES: &quot;NaN&quot;, &quot;N/A&quot;, &quot;total&quot;, &quot;mean&quot;, &quot;sum&quot;, &quot;null&quot;, &quot;NA&quot;, &quot;p-value&quot;, &quot;---&quot;, &quot;|&quot;                                                                                      │
│    ✓ PASS EXAMPLES:   &quot;BMI&quot;, &quot;blood pressure&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;21001&quot;                                                                                                                │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 2: LENGTH LIMITS                                                                                                                                                               │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: quality.max_alias_length: 300                                                                                                                                               │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      if len(alias.strip()) &gt; 300:                                                                                                                                                    │
│        → REJECT                                                                                                                                                                      │
│                                                                                                                                                                                      │
│    ✗ REJECT EXAMPLES: &quot;This is an extremely long alias that exceeds 300 characters and would be rejected...&quot;                                                                        │
│    ✓ PASS EXAMPLES:   &quot;Body mass index (BMI)&quot;, &quot;Systolic blood pressure, automated reading&quot;, &quot;21001&quot;                                                                                 │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 3: ALPHANUMERIC RATIO                                                                                                                                                          │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: quality.min_alnum_ratio: 0.60                                                                                                                                               │
│                                                                                                                                                                                      │
│    FUNCTION: alnum_ratio(alias)                                                                                                                                                      │
│      = count(alphanumeric chars) / len(alias)                                                                                                                                        │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      if alnum_ratio(alias) &lt; 0.60:                                                                                                                                                   │
│        → REJECT                                                                                                                                                                      │
│                                                                                                                                                                                      │
│    EXAMPLES:                                                                                                                                                                         │
│      &quot;BMI&quot;             → 3/3 = 1.00   ✓ PASS                                                                                                                                         │
│      &quot;Body mass index&quot; → 13/15 = 0.87 ✓ PASS                                                                                                                                         │
│      &quot;(21001)&quot;         → 5/7 = 0.71   ✓ PASS                                                                                                                                         │
│      &quot;???&quot;             → 0/3 = 0.00   ✗ REJECT                                                                                                                                       │
│      &quot;---&quot;             → 0/3 = 0.00   ✗ REJECT                                                                                                                                       │
│      &quot;p&lt;0.05&quot;          → 4/6 = 0.67   ✓ PASS                                                                                                                                         │
│      &quot;***&quot;             → 0/3 = 0.00   ✗ REJECT                                                                                                                                       │
│      &quot;(n=50)&quot;          → 3/6 = 0.50   ✗ REJECT (&lt; 0.60)                                                                                                                              │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 4: MINIMUM CORPUS HITS                                                                                                                                                         │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: quality.min_alias_hits: 1                                                                                                                                                   │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      total_hits = text_hits + table_hits                                                                                                                                             │
│      if total_hits &lt; 1:                                                                                                                                                              │
│        → REJECT   (alias doesn&#39;t appear anywhere in corpus)                                                                                                                          │
│                                                                                                                                                                                      │
│    PURPOSE: Remove aliases that don&#39;t appear in any paper. They can&#39;t be matched anyway.                                                                                            │
│                                                                                                                                                                                      │
│    EXAMPLES (assuming corpus has 5M docs):                                                                                                                                           │
│      &quot;BMI&quot;             → 50,000 hits  ✓ PASS                                                                                                                                         │
│      &quot;field 21001&quot;     → 150 hits     ✓ PASS                                                                                                                                         │
│      &quot;xyzzy123abc&quot;     → 0 hits       ✗ REJECT (doesn&#39;t exist in corpus)                                                                                                             │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 5: STOPWORD FILTER (too common = semantically meaningless)                                                                                                                     │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: quality.max_doc_freq_fraction: 0.70                                                                                                                                         │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      if total_docs &gt; 0:                                                                                                                                                              │
│        doc_freq_ratio = doc_count / total_docs                                                                                                                                       │
│        if doc_freq_ratio &gt; 0.70:                                                                                                                                                     │
│          → REJECT   (appears in &gt;70% of documents = stopword)                                                                                                                        │
│                                                                                                                                                                                      │
│    PURPOSE: Words that appear in most documents have no discriminative power.                                                                                                        │
│             They&#39;re essentially stopwords for our feature extraction task.                                                                                                           │
│                                                                                                                                                                                      │
│    EXAMPLES (assuming 5000 papers, each with ~1000 ES docs, total_docs ≈ 5,000,000):                                                                                                 │
│      &quot;patient&quot;         → appears in 4,500,000 docs (90%)  ✗ REJECT (&gt; 70%)                                                                                                           │
│      &quot;study&quot;           → appears in 4,000,000 docs (80%)  ✗ REJECT (&gt; 70%)                                                                                                           │
│      &quot;data&quot;            → appears in 3,800,000 docs (76%)  ✗ REJECT (&gt; 70%)                                                                                                           │
│      &quot;analysis&quot;        → appears in 3,600,000 docs (72%)  ✗ REJECT (&gt; 70%)                                                                                                           │
│      &quot;BMI&quot;             → appears in   150,000 docs (3%)   ✓ PASS (&lt; 70%)                                                                                                             │
│      &quot;blood pressure&quot;  → appears in   200,000 docs (4%)   ✓ PASS (&lt; 70%)                                                                                                             │
│      &quot;field 21001&quot;     → appears in       100 docs (0%)   ✓ PASS (&lt; 70%)                                                                                                             │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 6: TABLE DOMINANCE FILTER                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: quality.max_table_dominance: 0.85                                                                                                                                           │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      if total_hits &gt; 0:                                                                                                                                                              │
│        table_dominance_ratio = table_hits / (text_hits + table_hits)                                                                                                                 │
│        if table_dominance_ratio &gt; 0.85:                                                                                                                                              │
│          → REJECT   (&gt;85% of occurrences are in tables = likely table artifact)                                                                                                      │
│                                                                                                                                                                                      │
│    PURPOSE: Terms that ONLY appear in tables are often table formatting artifacts                                                                                                    │
│             or column headers that aren&#39;t semantically meaningful as feature names.                                                                                                  │
│                                                                                                                                                                                      │
│    EXAMPLES:                                                                                                                                                                         │
│      &quot;n/a&quot;             → text=10, table=1000   → 1000/1010 = 99%   ✗ REJECT (&gt; 85%)                                                                                                  │
│      &quot;---&quot;             → text=0, table=500     → 500/500 = 100%    ✗ REJECT (&gt; 85%)                                                                                                  │
│      &quot;mean&quot;            → text=100, table=900   → 900/1000 = 90%    ✗ REJECT (&gt; 85%)                                                                                                  │
│      &quot;BMI&quot;             → text=40000, table=10000 → 10000/50000 = 20%  ✓ PASS (&lt; 85%)                                                                                                 │
│      &quot;blood pressure&quot;  → text=35000, table=5000  → 5000/40000 = 12%   ✓ PASS (&lt; 85%)                                                                                                 │
│      &quot;field 21001&quot;     → text=100, table=50      → 50/150 = 33%       ✓ PASS (&lt; 85%)                                                                                                 │
│                                                                                                                                                                                      │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│                                                                                                                                                                                      │
│  OUTPUT: clean_aliases = aliases that passed ALL 6 gates                                                                                                                             │
│          Example: [&quot;BMI&quot;, &quot;bmi&quot;, &quot;body mass index&quot;, &quot;Body mass index (BMI)&quot;, &quot;field 21001&quot;, ...]                                                                                     │
│                                                                                                                                                                                      │
│  FALLBACK: If no aliases pass, return first max_review_aliases (25) base aliases anyway                                                                                             │
│            Config: output.max_review_aliases: 25                                                                                                                                     │
│                                                                                                                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                                            │
                                                                                            ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                                                                      │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  STEP 3: COLLOCATE EXPANSION (extract_collocates + expand)                                                                                                                           │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│                                                                                                                                                                                      │
│  PURPOSE: Find words that frequently co-occur with clean_aliases, then create expanded aliases                                                                                       │
│           Example: &quot;BMI&quot; often co-occurs with &quot;mean&quot; → create &quot;mean BMI&quot; as new alias                                                                                                │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  STEP 3a: GATHER CONTEXTS FROM ELASTICSEARCH                                                                                                                                         │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: collocation.max_contexts_for_collocates: 500                                                                                                                                │
│  Config: collocation.max_aliases_for_context: 10                                                                                                                                     │
│                                                                                                                                                                                      │
│    Take first 10 clean_aliases (sorted by length, longest first)                                                                                                                     │
│    For each alias, search ES for contexts containing that alias                                                                                                                      │
│    Collect up to 500 total context documents                                                                                                                                         │
│                                                                                                                                                                                      │
│    CONTEXT STRUCTURE:                                                                                                                                                                │
│    ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│    │  {                                                                                                                                                                          │   │
│    │    &quot;text&quot;: &quot;The mean BMI was 25.3 kg/m2 at baseline assessment&quot;,                                                                                                            │   │
│    │    &quot;source_type&quot;: &quot;body&quot;                                                                                                                                                    │   │
│    │  }                                                                                                                                                                          │   │
│    └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  STEP 3b: BALANCE TEXT vs TABLE CONTEXTS                                                                                                                                             │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: sections.include_text: true → source_types = {body, abstract, title, section_header, caption}                                                                              │
│  Config: sections.include_table_headers: true → source_types += {table_header}                                                                                                       │
│  Config: sections.include_table_rows: true → source_types += {table_row_header}                                                                                                      │
│  Config: sections.include_table_body: false → table_data_cell NOT included (too noisy)                                                                                               │
│                                                                                                                                                                                      │
│    Split contexts by source_type:                                                                                                                                                    │
│      text_contexts = [c for c in contexts if c.source_type in {body, abstract, title, section_header, caption}]                                                                     │
│      table_contexts = [c for c in contexts if c.source_type in {table_header, table_row_header, table_data_cell}]                                                                   │
│                                                                                                                                                                                      │
│    Balance to avoid table/text bias:                                                                                                                                                 │
│      k = min(len(text_contexts), len(table_contexts))                                                                                                                                │
│      balanced_contexts = text_contexts[:k] + table_contexts[:k]   if k &gt; 0 else contexts                                                                                             │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  STEP 3c: COMPUTE COLLOCATE LIFT SCORES                                                                                                                                              │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: collocation.window_size: 5                                                                                                                                                  │
│  Config: collocation.min_count: 25                                                                                                                                                   │
│  Config: tokenizer.spacy_model: &quot;en_core_web_sm&quot;                                                                                                                                     │
│                                                                                                                                                                                      │
│    ALGORITHM (Lift Score):                                                                                                                                                           │
│                                                                                                                                                                                      │
│      foreground_freq = {}  # Words within ±5 words of alias                                                                                                                          │
│      background_freq = {}  # All words in all contexts                                                                                                                               │
│                                                                                                                                                                                      │
│      for each context:                                                                                                                                                               │
│        tokens = tokenize(context.text)                    ← spaCy tokenization, lowercase                                                                                            │
│                                                                                                                                                                                      │
│        # Find alias position in tokens                                                                                                                                               │
│        for i, token in enumerate(tokens):                                                                                                                                            │
│          if token matches any alias (case-insensitive):                                                                                                                              │
│            # Extract window around alias                                                                                                                                             │
│            start = max(0, i - window_size)    # i - 5                                                                                                                                │
│            end = min(len(tokens), i + len(alias_tokens) + window_size)   # i + alias_len + 5                                                                                         │
│            window_tokens = tokens[start:end]                                                                                                                                         │
│                                                                                                                                                                                      │
│            # Count foreground (near alias)                                                                                                                                           │
│            for word in window_tokens:                                                                                                                                                │
│              if word not in stopwords and word not in aliases:                                                                                                                       │
│                foreground_freq[word] += 1                                                                                                                                            │
│                                                                                                                                                                                      │
│        # Count background (all words)                                                                                                                                                │
│        for word in tokens:                                                                                                                                                           │
│          if word not in stopwords:                                                                                                                                                   │
│            background_freq[word] += 1                                                                                                                                                │
│                                                                                                                                                                                      │
│      # Calculate lift score for each word                                                                                                                                            │
│      for word in foreground_freq:                                                                                                                                                    │
│        if foreground_freq[word] &gt;= min_count (25):     ← Must appear at least 25 times near aliases                                                                                  │
│          lift_score = foreground_freq[word] / max(background_freq[word], 1)                                                                                                          │
│                                                                                                                                                                                      │
│    EXAMPLE OUTPUT (sorted by lift score, top 30):                                                                                                                                    │
│    ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│    │  WORD          │  FG_FREQ  │  BG_FREQ  │  LIFT_SCORE  │  NOTES                                                                                                              │   │
│    │  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────  │   │
│    │  mean          │  450      │  2000     │  0.225       │  Often: &quot;mean BMI&quot;                                                                                                  │   │
│    │  baseline      │  380      │  1500     │  0.253       │  Often: &quot;baseline BMI&quot;                                                                                              │   │
│    │  calculated    │  200      │  600      │  0.333       │  Often: &quot;BMI calculated&quot;                                                                                            │   │
│    │  measured      │  180      │  500      │  0.360       │  Often: &quot;BMI measured&quot;                                                                                              │   │
│    │  higher        │  150      │  800      │  0.188       │  Often: &quot;higher BMI&quot;                                                                                                │   │
│    │  lower         │  140      │  750      │  0.187       │  Often: &quot;lower BMI&quot;                                                                                                 │   │
│    │  obesity       │  120      │  200      │  0.600       │  Often: &quot;BMI obesity&quot;                                                                                               │   │
│    │  ...           │  ...      │  ...      │  ...         │                                                                                                                     │   │
│    └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  STEP 3d: EXPAND ALIASES USING TOP COLLOCATES                                                                                                                                        │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: collocation.top_collocates_to_check: 30                                                                                                                                     │
│  Config: output.max_proposed_aliases: 50                                                                                                                                             │
│  Config: quality.min_alias_length: 3                                                                                                                                                 │
│  Config: embedding_thresholds.expanded_alias_title_sim: 0.50                                                                                                                         │
│  Config: embedding_thresholds.expanded_alias_base_sim: 0.60                                                                                                                          │
│  Config: embedding_thresholds.top_base_aliases_for_validation: 5                                                                                                                     │
│                                                                                                                                                                                      │
│    ALGORITHM:                                                                                                                                                                        │
│                                                                                                                                                                                      │
│      for each word in top_30_collocates:                                                                                                                                             │
│        if word already in clean_aliases or len(word) &lt; 3:                                                                                                                            │
│          skip                                                                                                                                                                        │
│                                                                                                                                                                                      │
│        for each base_alias in clean_aliases:                                                                                                                                         │
│          # Try both orderings                                                                                                                                                        │
│          candidates = [f&quot;{word} {base_alias}&quot;, f&quot;{base_alias} {word}&quot;]                                                                                                               │
│                                                                                                                                                                                      │
│          for candidate in candidates:                                                                                                                                                │
│            # CHECK 1: Does candidate exist in corpus?                                                                                                                                │
│            ca_counts = query_es_for_counts(candidate.lower())                                                                                                                        │
│            if ca_counts.total_hits == 0:                                                                                                                                             │
│              skip   # Doesn&#39;t exist, can&#39;t match                                                                                                                                     │
│                                                                                                                                                                                      │
│            # CHECK 2: Is candidate count &lt;= base alias count?                                                                                                                        │
│            if ca_counts.total_hits &gt; base_alias_counts.total_hits:                                                                                                                   │
│              skip   # More general than base = wrong direction                                                                                                                       │
│                                                                                                                                                                                      │
│            # CHECK 3: Does candidate pass is_clean_alias (all 6 gates)?                                                                                                              │
│            if not is_clean_alias(candidate, title, ca_counts, total_docs, config):                                                                                                   │
│              skip                                                                                                                                                                    │
│                                                                                                                                                                                      │
│            # CHECK 4: validate_expanded_alias (semantic similarity check)                                                                                                            │
│            if not validate_expanded_alias(candidate, title, clean_aliases, embedder, config, units):                                                                                 │
│              skip                                                                                                                                                                    │
│                                                                                                                                                                                      │
│            # All checks passed - add to expanded set                                                                                                                                 │
│            expanded_aliases.add(candidate)                                                                                                                                           │
│                                                                                                                                                                                      │
│            # Stop if we have enough                                                                                                                                                  │
│            if len(clean_aliases) + len(expanded_aliases) &gt;= max_proposed_aliases (50):                                                                                               │
│              break                                                                                                                                                                   │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  STEP 3e: VALIDATE EXPANDED ALIAS (validate_expanded_alias)                                                                                                                          │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: embedder.model_name: &quot;cambridgeltl/SapBERT-from-PubMedBERT-fulltext&quot;                                                                                                        │
│  Config: embedding_thresholds.expanded_alias_title_sim: 0.50                                                                                                                         │
│  Config: embedding_thresholds.expanded_alias_base_sim: 0.60                                                                                                                          │
│  Config: embedding_thresholds.top_base_aliases_for_validation: 5                                                                                                                     │
│  Config: generic_terms.base: [&quot;mean&quot;, &quot;level&quot;, &quot;value&quot;, &quot;measurement&quot;, &quot;test&quot;, &quot;total&quot;]                                                                                              │
│  Config: generic_terms.with_units: [&quot;concentration&quot;, &quot;amount&quot;, &quot;quantity&quot;]                                                                                                           │
│                                                                                                                                                                                      │
│    VALIDATION LOGIC:                                                                                                                                                                 │
│                                                                                                                                                                                      │
│      # Reject if ALL words are generic terms                                                                                                                                         │
│      words = candidate_alias.lower().split()                                                                                                                                         │
│      generic_base = {&quot;mean&quot;, &quot;level&quot;, &quot;value&quot;, &quot;measurement&quot;, &quot;test&quot;, &quot;total&quot;}                                                                                                       │
│      generic_units = {&quot;concentration&quot;, &quot;amount&quot;, &quot;quantity&quot;}                                                                                                                         │
│                                                                                                                                                                                      │
│      if all(word in generic_base for word in words):                                                                                                                                 │
│        → REJECT   (&quot;mean level&quot; = meaningless)                                                                                                                                       │
│                                                                                                                                                                                      │
│      if units and all(word in generic_units for word in words):                                                                                                                      │
│        → REJECT   (&quot;concentration amount&quot; = meaningless when feature has units)                                                                                                      │
│                                                                                                                                                                                      │
│      # Semantic similarity checks using SapBERT embeddings                                                                                                                           │
│      candidate_embedding = embedder.encode(candidate_alias)                                                                                                                          │
│      title_embedding = embedder.encode(feature_title)                                                                                                                                │
│                                                                                                                                                                                      │
│      # CHECK: Similarity to title                                                                                                                                                    │
│      title_sim = cosine_similarity(candidate_embedding, title_embedding)                                                                                                             │
│      if title_sim &lt; 0.50:                                                                                                                                                            │
│        → REJECT   (not semantically related to feature)                                                                                                                              │
│                                                                                                                                                                                      │
│      # CHECK: Similarity to top base aliases                                                                                                                                         │
│      top_bases = base_aliases[:5]                                                                                                                                                    │
│      base_embeddings = [embedder.encode(b) for b in top_bases]                                                                                                                       │
│      base_sims = [cosine_similarity(candidate_embedding, be) for be in base_embeddings]                                                                                              │
│      max_base_sim = max(base_sims)                                                                                                                                                   │
│                                                                                                                                                                                      │
│      if max_base_sim &lt; 0.60:                                                                                                                                                         │
│        → REJECT   (not similar enough to existing aliases)                                                                                                                           │
│                                                                                                                                                                                      │
│      → ACCEPT                                                                                                                                                                        │
│                                                                                                                                                                                      │
│    EXAMPLES:                                                                                                                                                                         │
│      &quot;mean BMI&quot;        + title=&quot;Body mass index&quot; → title_sim=0.72 ✓, base_sim=0.85 ✓ → ACCEPT                                                                                        │
│      &quot;baseline BMI&quot;    + title=&quot;Body mass index&quot; → title_sim=0.68 ✓, base_sim=0.82 ✓ → ACCEPT                                                                                        │
│      &quot;mean level&quot;      + title=&quot;Body mass index&quot; → generic terms only → REJECT                                                                                                       │
│      &quot;obesity BMI&quot;     + title=&quot;Body mass index&quot; → title_sim=0.55 ✓, base_sim=0.75 ✓ → ACCEPT                                                                                        │
│      &quot;cancer BMI&quot;      + title=&quot;Body mass index&quot; → title_sim=0.32 ✗ → REJECT (unrelated)                                                                                             │
│                                                                                                                                                                                      │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│                                                                                                                                                                                      │
│  FINAL OUTPUT: feature_alias_map.json                                                                                                                                                │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: output.directory: &quot;/app/output&quot;                                                                                                                                             │
│  Config: output.feature_alias_map_file: &quot;feature_alias_map.json&quot;                                                                                                                     │
│  Config: output.max_proposed_aliases: 50                                                                                                                                             │
│                                                                                                                                                                                      │
│    {                                                                                                                                                                                 │
│      &quot;21001&quot;: [                                                                                                                                                                      │
│        &quot;body mass index (bmi)&quot;,           ← From title                                                                                                                               │
│        &quot;Body mass index (BMI)&quot;,           ← From title (original case)                                                                                                               │
│        &quot;body mass index&quot;,                 ← Lemmatized title                                                                                                                         │
│        &quot;BMI&quot;,                             ← From acr_abb_1                                                                                                                           │
│        &quot;bmi&quot;,                             ← Lowercase curated acronym                                                                                                                │
│        &quot;mean BMI&quot;,                        ← Expanded (collocate &quot;mean&quot; + &quot;BMI&quot;)                                                                                                      │
│        &quot;baseline BMI&quot;,                    ← Expanded (collocate &quot;baseline&quot; + &quot;BMI&quot;)                                                                                                  │
│        &quot;BMI calculated&quot;,                  ← Expanded (collocate &quot;calculated&quot; + &quot;BMI&quot;)                                                                                                │
│        &quot;higher BMI&quot;,                      ← Expanded                                                                                                                                 │
│        &quot;lower BMI&quot;,                       ← Expanded                                                                                                                                 │
│        &quot;field 21001&quot;,                     ← Field ID pattern (HIGH TRUST)                                                                                                            │
│        &quot;ukb 21001&quot;,                       ← Field ID pattern                                                                                                                         │
│        &quot;#21001&quot;,                          ← Field ID pattern                                                                                                                         │
│        &quot;f21001&quot;,                          ← Field ID pattern                                                                                                                         │
│        ...                                ← Up to 50 total                                                                                                                           │
│      ],                                                                                                                                                                              │
│      &quot;21002&quot;: [...],                                                                                                                                                                 │
│      &quot;21003&quot;: [...],                                                                                                                                                                 │
│      ...                                                                                                                                                                             │
│    }                                                                                                                                                                                 │
│                                                                                                                                                                                      │
│    TOTAL: ~6000 features × up to 50 aliases each = up to 300,000 alias entries                                                                                                       │
│                                                                                                                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                              COMPLETE HYPERPARAMETER REFERENCE                                                                                        ║
╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  QUALITY THRESHOLDS (feature_extraction.yaml)              │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  quality.min_alias_hits                                    │  1        │  Minimum ES hits to consider alias valid                                                              │  ║
║  │  quality.min_alias_length                                  │  3        │  Minimum characters for expanded aliases                                                              │  ║
║  │  quality.max_alias_length                                  │  300      │  Maximum characters before rejection                                                                  │  ║
║  │  quality.min_word_count                                    │  1        │  Minimum words in lemmatized title alias                                                              │  ║
║  │  quality.min_alnum_ratio                                   │  0.60     │  Minimum alphanumeric/total char ratio                                                                │  ║
║  │  quality.max_doc_freq_fraction                             │  0.70     │  Maximum doc frequency (&gt;70% = stopword)                                                              │  ║
║  │  quality.max_table_dominance                               │  0.85     │  Maximum table hit ratio (&gt;85% = artifact)                                                            │  ║
║  │  quality.max_title_anchors                                 │  8        │  Cap on title anchor words for lemmatization                                                          │  ║
║  │  quality.numeric_context_threshold                         │  0.20     │  Threshold for numeric context detection                                                              │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  COLLOCATION PARAMETERS (feature_extraction.yaml)          │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  collocation.window_size                                   │  5        │  Words left/right of alias to check for collocates                                                    │  ║
║  │  collocation.min_count                                     │  25       │  Minimum foreground frequency for collocate                                                           │  ║
║  │  collocation.top_collocates_to_check                       │  30       │  How many top collocates to try expanding                                                             │  ║
║  │  collocation.max_contexts_for_collocates                   │  500      │  Maximum contexts to gather for collocation analysis                                                  │  ║
║  │  collocation.max_aliases_for_context                       │  10       │  Max aliases to search when gathering contexts                                                        │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  EMBEDDING THRESHOLDS (feature_extraction.yaml)            │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  embedding_thresholds.base_threshold                       │  0.60     │  Default similarity threshold                                                                         │  ║
║  │  embedding_thresholds.acronym_1_2_char                     │  0.80     │  Threshold for 1-2 char acronyms (very strict)                                                        │  ║
║  │  embedding_thresholds.acronym_3_char                       │  0.65     │  Threshold for 3 char acronyms (moderately strict)                                                    │  ║
║  │  embedding_thresholds.acronym_4plus_char                   │  0.60     │  Threshold for 4+ char acronyms (normal)                                                              │  ║
║  │  embedding_thresholds.field_id_pattern                     │  0.40     │  Threshold for field ID patterns (high trust)                                                         │  ║
║  │  embedding_thresholds.expanded_alias_title_sim             │  0.50     │  Min similarity to title for expanded alias                                                           │  ║
║  │  embedding_thresholds.expanded_alias_base_sim              │  0.60     │  Min similarity to base aliases for expansion                                                         │  ║
║  │  embedding_thresholds.top_base_aliases_for_validation      │  5        │  How many base aliases to compare against                                                             │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  OUTPUT LIMITS (feature_extraction.yaml)                   │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  output.max_proposed_aliases                               │  50       │  Maximum aliases per feature in final map                                                             │  ║
║  │  output.max_review_aliases                                 │  25       │  Fallback alias count if no clean aliases pass                                                        │  ║
║  │  output.max_review_samples                                 │  30       │  Sample contexts for manual review                                                                    │  ║
║  │  output.directory                                          │  /app/output │  Where to save output files                                                                       │  ║
║  │  output.feature_alias_map_file                             │  feature_alias_map.json │  Alias map filename                                                                     │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  TABLE ARTIFACT BLACKLIST (feature_extraction.yaml)        │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  table_artifacts.blacklist                                 │  [&quot;|&quot;, &quot;||&quot;, &quot;|||&quot;, &quot;-&quot;, &quot;--&quot;, &quot;---&quot;, &quot;figure&quot;, &quot;table&quot;, &quot;fig&quot;, &quot;vid&quot;, &quot;ci&quot;, &quot;%&quot;, &quot;n/a&quot;, &quot;na&quot;, &quot;null&quot;,           │  ║
║  │                                                            │   &quot;confidence interval&quot;, &quot;ci %&quot;, &quot;% ci&quot;, &quot;figure vid&quot;, &quot;vid figure&quot;, &quot;table vid&quot;]                                 │  ║
║  │  table_artifacts.single_char_exceptions                    │  [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]                                                                                                  │  ║
║  │  table_artifacts.max_dashes                                │  2        │  Dashes beyond this count = artifact                                                                  │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  GENERIC TERMS (feature_extraction.yaml)                   │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  generic_terms.base                                        │  [&quot;mean&quot;, &quot;level&quot;, &quot;value&quot;, &quot;measurement&quot;, &quot;test&quot;, &quot;total&quot;]                                                       │  ║
║  │  generic_terms.with_units                                  │  [&quot;concentration&quot;, &quot;amount&quot;, &quot;quantity&quot;]                                                                          │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  SAMPLING THRESHOLDS (feature_extraction.yaml)             │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  sampling.high_threshold                                   │  0.80     │  Score &gt;= 0.80 = HIGH confidence                                                                      │  ║
║  │  sampling.mid_threshold                                    │  0.60     │  Score &gt;= 0.60 = MEDIUM confidence                                                                    │  ║
║  │  sampling.low_threshold                                    │  0.40     │  Score &gt;= 0.40 = LOW confidence (minimum to include)                                                  │  ║
║  │  sampling.high_count                                       │  15       │  Samples from HIGH bucket                                                                             │  ║
║  │  sampling.mid_count                                        │  10       │  Samples from MEDIUM bucket                                                                           │  ║
║  │  sampling.low_count                                        │  5        │  Samples from LOW bucket                                                                              │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
╔══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                         STAGE 1: ALIAS DISCOVERY — COMPLETE HYPERPARAMETER REFERENCE                                                             ║
║                                                                    (01_mine_aliases.py)                                                                                           ║
║                                                                                                                                                                                   ║
║  CONFIG FILES:                                                                                                                                                                    ║
║    • feature_extraction.yaml — ALL quality, embedding, collocation, and output parameters                                                                                        ║
║    • paper_extract_es.yaml   — Extraction zone definitions (source_type values)                                                                                                  ║
║    • resources.yaml          — Elasticsearch connection and indexing settings                                                                                                    ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                                                                      │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  STEP 1: GENERATE BASE ALIASES (generate_base_aliases)                                                                                                                               │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│                                                                                                                                                                                      │
│  INPUT: feature from ukb_fields table                                                                                                                                                │
│    ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐                   │
│    │  field_id:       "21001"                                                                                                                                    │                   │
│    │  title:          "Body mass index (BMI)"                                                                                                                    │                   │
│    │  units:          "kg/m2"                                                                                                                                    │                   │
│    │  acr_abb_1:      "BMI"                                                                                                                                      │                   │
│    │  acr_abb_2:      "body mass index"                                                                                                                          │                   │
│    │  acr_abb_3..15:  (additional curated acronyms/abbreviations if any)                                                                                         │                   │
│    │  category_title: "Physical measures"                                                                                                                        │                   │
│    │  notes:          "Calculated as weight/height^2..."                                                                                                         │                   │
│    └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘                   │
│                                                                                                                                                                                      │
│  ALIAS GENERATION SOURCES:                                                                                                                                                           │
│                                                                                                                                                                                      │
│    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│    │  SOURCE 1: Field ID Patterns (HIGH TRUST)                                                                                                                                    │ │
│    │  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── │ │
│    │  Config: field_id_patterns.templates (feature_extraction.yaml lines 321-371)                                                                                                │ │
│    │  Config: field_id_patterns.generate_lowercase_variants: true                                                                                                                 │ │
│    │                                                                                                                                                                              │ │
│    │  For field_id = "21001", generates ~70 patterns:                                                                                                                             │ │
│    │                                                                                                                                                                              │ │
│    │    TEMPLATE                          │  GENERATED ALIAS             │  NOTES                                                                                                │ │
│    │    ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────                             │ │
│    │    "field \textbraceleft{\textbraceright{}id\textbraceright{}"                      │  "field 21001"               │  Standard reference                                                                                   │ │
│    │    "feature \textbraceleft{\textbraceright{}id\textbraceright{}"                    │  "feature 21001"             │  Alternative reference                                                                                │ │
│    │    "field id \textbraceleft{\textbraceright{}id\textbraceright{}"                   │  "field id 21001"            │  Explicit ID reference                                                                                │ │
│    │    "id \textbraceleft{\textbraceright{}id\textbraceright{}"                         │  "id 21001"                  │  Short form                                                                                           │ │
│    │    "field_id \textbraceleft{\textbraceright{}id\textbraceright{}"                   │  "field_id 21001"            │  Underscore variant                                                                                   │ │
│    │    "biomarker \textbraceleft{\textbraceright{}id\textbraceright{}"                  │  "biomarker 21001"           │  UKB-specific                                                                                         │ │
│    │    "phenotype \textbraceleft{\textbraceright{}id\textbraceright{}"                  │  "phenotype 21001"           │  UKB-specific                                                                                         │ │
│    │    "data-field \textbraceleft{\textbraceright{}id\textbraceright{}"                 │  "data-field 21001"          │  UKB-specific                                                                                         │ │
│    │    "ukb \textbraceleft{\textbraceright{}id\textbraceright{}"                        │  "ukb 21001"                 │  UK Biobank prefix                                                                                    │ │
│    │    "ukb:\textbraceleft{\textbraceright{}id\textbraceright{}"                        │  "ukb:21001"                 │  Colon separator                                                                                      │ │
│    │    "ukb-\textbraceleft{\textbraceright{}id\textbraceright{}"                        │  "ukb-21001"                 │  Dash separator                                                                                       │ │
│    │    "ukb_\textbraceleft{\textbraceright{}id\textbraceright{}"                        │  "ukb_21001"                 │  Underscore separator                                                                                 │ │
│    │    "ukb.\textbraceleft{\textbraceright{}id\textbraceright{}"                        │  "ukb.21001"                 │  Dot separator                                                                                        │ │
│    │    "f.\textbraceleft{\textbraceright{}id\textbraceright{}"                          │  "f.21001"                   │  Short prefix                                                                                         │ │
│    │    "f\textbraceleft{\textbraceright{}id\textbraceright{}"                           │  "f21001"                    │  Compact prefix                                                                                       │ │
│    │    "F\textbraceleft{\textbraceright{}id\textbraceright{}"                           │  "F21001"                    │  Uppercase compact                                                                                    │ │
│    │    "variable \textbraceleft{\textbraceright{}id\textbraceright{}"                   │  "variable 21001"            │  Data reference                                                                                       │ │
│    │    "var \textbraceleft{\textbraceright{}id\textbraceright{}"                        │  "var 21001"                 │  Short data reference                                                                                 │ │
│    │    "code \textbraceleft{\textbraceright{}id\textbraceright{}"                       │  "code 21001"                │  Code reference                                                                                       │ │
│    │    "data code \textbraceleft{\textbraceright{}id\textbraceright{}"                  │  "data code 21001"           │  Explicit code reference                                                                              │ │
│    │    "measure \textbraceleft{\textbraceright{}id\textbraceright{}"                    │  "measure 21001"             │  Measurement reference                                                                                │ │
│    │    "metric \textbraceleft{\textbraceright{}id\textbraceright{}"                     │  "metric 21001"              │  Metric reference                                                                                     │ │
│    │    "item \textbraceleft{\textbraceright{}id\textbraceright{}"                       │  "item 21001"                │  Item reference                                                                                       │ │
│    │    "col \textbraceleft{\textbraceright{}id\textbraceright{}"                        │  "col 21001"                 │  Column reference                                                                                     │ │
│    │    "column \textbraceleft{\textbraceright{}id\textbraceright{}"                     │  "column 21001"              │  Full column reference                                                                                │ │
│    │    "number \textbraceleft{\textbraceright{}id\textbraceright{}"                     │  "number 21001"              │  Number reference                                                                                     │ │
│    │    "field:\textbraceleft{\textbraceright{}id\textbraceright{}"                      │  "field:21001"               │  Colon variant                                                                                        │ │
│    │    "(\textbraceleft{\textbraceright{}id\textbraceright{})"                          │  "(21001)"                   │  Parenthesized                                                                                        │ │
│    │    "[\textbraceleft{\textbraceright{}id\textbraceright{}]"                          │  "[21001]"                   │  Bracketed                                                                                            │ │
│    │    "#\textbraceleft{\textbraceright{}id\textbraceright{}"                           │  "#21001"                    │  Hash prefix                                                                                          │ │
│    │    '"\textbraceleft{\textbraceright{}id\textbraceright{}"'                          │  '"21001"'                   │  Double-quoted                                                                                        │ │
│    │    "'\textbraceleft{\textbraceright{}id\textbraceright{}'"                          │  "'21001'"                   │  Single-quoted                                                                                        │ │
│    │                                                                                                                                                                              │ │
│    │  PLUS additional_variants (not case-duplicated):                                                                                                                             │ │
│    │    "field-\textbraceleft{\textbraceright{}id\textbraceright{}"   →  "field-21001"                                                                                                                                           │ │
│    │    "field_\textbraceleft{\textbraceright{}id\textbraceright{}"   →  "field_21001"                                                                                                                                           │ │
│    │    "feature-\textbraceleft{\textbraceright{}id\textbraceright{}" →  "feature-21001"                                                                                                                                         │ │
│    │    "feature_\textbraceleft{\textbraceright{}id\textbraceright{}" →  "feature_21001"                                                                                                                                         │ │
│    │                                                                                                                                                                              │ │
│    │  PLUS lowercase variants if generate_lowercase_variants: true                                                                                                                │ │
│    │    Each template generates BOTH: "Field 21001" AND "field 21001"                                                                                                             │ │
│    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                                                      │
│    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│    │  SOURCE 2: Title Variations                                                                                                                                                  │ │
│    │  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── │ │
│    │  Config: quality.min_word_count: 1                                                                                                                                           │ │
│    │  Config: tokenizer.spacy_model: "en_core_web_sm"                                                                                                                             │ │
│    │                                                                                                                                                                              │ │
│    │  title = "Body mass index (BMI)"                                                                                                                                             │ │
│    │                                                                                                                                                                              │ │
│    │  GENERATED ALIASES:                                                                                                                                                          │ │
│    │    • "Body mass index (BMI)"        ← Original title (exact case)                                                                                                            │ │
│    │    • "body mass index (bmi)"        ← Lowercase version                                                                                                                      │ │
│    │    • "body mass index"              ← Lemmatized (spaCy), stopwords removed                                                                                                  │ │
│    │                                         Only if result has >= min_word_count (1) words                                                                                       │ │
│    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                                                      │
│    ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│    │  SOURCE 3: Curated Acronyms (from DuckDB acr_abb_1..15 columns)                                                                                                              │ │
│    │  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── │ │
│    │                                                                                                                                                                              │ │
│    │  For each acr_abb_N column (N = 1 to 15):                                                                                                                                    │ │
│    │    if acr_abb_N is not null/empty:                                                                                                                                           │ │
│    │      add to aliases: acr_abb_N                                                                                                                                               │ │
│    │      add to aliases: acr_abb_N.lower()                                                                                                                                       │ │
│    │      mark as CURATED_ACRONYM (gets special threshold treatment in Stage 2)                                                                                                  │ │
│    │                                                                                                                                                                              │ │
│    │  Example for field 21001:                                                                                                                                                    │ │
│    │    acr_abb_1 = "BMI"           →  adds "BMI", "bmi"  (both marked as curated)                                                                                                │ │
│    │    acr_abb_2 = "body mass index" →  adds "body mass index" (marked as curated)                                                                                               │ │
│    │                                                                                                                                                                              │ │
│    │  CURATED ACRONYMS get special treatment:                                                                                                                                     │ │
│    │    • BYPASS some quality filters (trusted source)                                                                                                                            │ │
│    │    • Use length-based thresholds in Stage 2 scoring                                                                                                                          │ │
│    └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                                                      │
│  OUTPUT: base_aliases = ["21001", "field 21001", "Field 21001", "feature 21001", ..., "Body mass index (BMI)", "body mass index (bmi)", "BMI", "bmi", ...]                           │
│          curated_acronyms = \textbraceleft{\textbraceright{}"BMI", "bmi", "body mass index"\textbraceright{}  ← These get special threshold treatment                                                                               │
│                                                                                                                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                                            │
                                                                                            ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                                                                      │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  STEP 2: QUALITY FILTER (is_clean_alias)                                                                                                                                             │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│                                                                                                                                                                                      │
│  For each base_alias, query Elasticsearch for document counts:                                                                                                                       │
│                                                                                                                                                                                      │
│    ES QUERY (batch via msearch):                                                                                                                                                     │
│    ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│    │  \textbraceleft{\textbraceright{}                                                                                                                                                                          │   │
│    │    "query": \textbraceleft{\textbraceright{}                                                                                                                                                               │   │
│    │      "bool": \textbraceleft{\textbraceright{}                                                                                                                                                              │   │
│    │        "must": [                                                                                                                                                            │   │
│    │          \textbraceleft{\textbraceright{}"match_phrase": \textbraceleft{\textbraceright{}"text_lower": "bmi"\textbraceright{}\textbraceright{}   ← Case-insensitive phrase match                                                                                          │   │
│    │        ]                                                                                                                                                                    │   │
│    │      \textbraceright{}                                                                                                                                                                      │   │
│    │    \textbraceright{},                                                                                                                                                                       │   │
│    │    "aggs": \textbraceleft{\textbraceright{}                                                                                                                                                                │   │
│    │      "by_source_type": \textbraceleft{\textbraceright{}                                                                                                                                                    │   │
│    │        "terms": \textbraceleft{\textbraceright{}"field": "source_type"\textbraceright{}   ← Count hits per source_type                                                                                                    │   │
│    │      \textbraceright{}                                                                                                                                                                      │   │
│    │    \textbraceright{},                                                                                                                                                                       │   │
│    │    "track_total_hits": true                ← Config: elasticsearch.track_total_hits: true                                                                                  │   │
│    │  \textbraceright{}                                                                                                                                                                          │   │
│    └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                                                                                                      │
│    RETURNS: counts = (text_hits, table_hits, doc_count)                                                                                                                              │
│      • text_hits:  hits in source_types = \textbraceleft{\textbraceright{}body, abstract, title, section_header, caption\textbraceright{}                                                                                          │
│      • table_hits: hits in source_types = \textbraceleft{\textbraceright{}table_header, table_row_header, table_data_cell\textbraceright{}                                                                                         │
│      • doc_count:  unique documents containing the alias                                                                                                                             │
│                                                                                                                                                                                      │
│    Config: retrieval.alias_batch_size: 100   ← Batch size for msearch                                                                                                               │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 1: TABLE ARTIFACT BLACKLIST (is_table_artifact)                                                                                                                                │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: table_artifacts.blacklist (feature_extraction.yaml lines 265-287)                                                                                                          │
│  Config: table_artifacts.single_char_exceptions: ["a", "b", "c"]                                                                                                                     │
│  Config: table_artifacts.max_dashes: 2                                                                                                                                               │
│                                                                                                                                                                                      │
│    BLACKLIST = [                                                                                                                                                                     │
│      "|", "||", "|||",                          ← Table separators                                                                                                                   │
│      "-", "--", "---",                          ← Row separators                                                                                                                     │
│      "figure", "table", "fig", "vid",           ← Table/figure labels                                                                                                                │
│      "ci", "%",                                 ← Statistical notation                                                                                                               │
│      "n/a", "na", "null",                       ← Missing value indicators                                                                                                           │
│      "confidence interval", "ci %", "% ci",     ← Statistical phrases                                                                                                                │
│      "figure vid", "vid figure", "table vid"    ← Document references                                                                                                                │
│    ]                                                                                                                                                                                 │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      if alias.lower().strip() in BLACKLIST:                                                                                                                                          │
│        → REJECT                                                                                                                                                                      │
│                                                                                                                                                                                      │
│      if len(alias) == 1:                                                                                                                                                             │
│        if alias.lower() not in single_char_exceptions:                                                                                                                               │
│          → REJECT   (single chars like "1", "x", "%" are artifacts)                                                                                                                  │
│                                                                                                                                                                                      │
│      if alias contains only dashes and count > max_dashes (2):                                                                                                                       │
│        → REJECT   ("---" = artifact, "-" and "--" might be valid)                                                                                                                    │
│                                                                                                                                                                                      │
│    ✗ REJECT EXAMPLES: "NaN", "N/A", "total", "mean", "sum", "null", "NA", "p-value", "---", "|"                                                                                      │
│    ✓ PASS EXAMPLES:   "BMI", "blood pressure", "a", "b", "c", "21001"                                                                                                                │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 2: LENGTH LIMITS                                                                                                                                                               │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: quality.max_alias_length: 300                                                                                                                                               │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      if len(alias.strip()) > 300:                                                                                                                                                    │
│        → REJECT                                                                                                                                                                      │
│                                                                                                                                                                                      │
│    ✗ REJECT EXAMPLES: "This is an extremely long alias that exceeds 300 characters and would be rejected..."                                                                        │
│    ✓ PASS EXAMPLES:   "Body mass index (BMI)", "Systolic blood pressure, automated reading", "21001"                                                                                 │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 3: ALPHANUMERIC RATIO                                                                                                                                                          │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: quality.min_alnum_ratio: 0.60                                                                                                                                               │
│                                                                                                                                                                                      │
│    FUNCTION: alnum_ratio(alias)                                                                                                                                                      │
│      = count(alphanumeric chars) / len(alias)                                                                                                                                        │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      if alnum_ratio(alias) < 0.60:                                                                                                                                                   │
│        → REJECT                                                                                                                                                                      │
│                                                                                                                                                                                      │
│    EXAMPLES:                                                                                                                                                                         │
│      "BMI"             → 3/3 = 1.00   ✓ PASS                                                                                                                                         │
│      "Body mass index" → 13/15 = 0.87 ✓ PASS                                                                                                                                         │
│      "(21001)"         → 5/7 = 0.71   ✓ PASS                                                                                                                                         │
│      "???"             → 0/3 = 0.00   ✗ REJECT                                                                                                                                       │
│      "---"             → 0/3 = 0.00   ✗ REJECT                                                                                                                                       │
│      "p<0.05"          → 4/6 = 0.67   ✓ PASS                                                                                                                                         │
│      "***"             → 0/3 = 0.00   ✗ REJECT                                                                                                                                       │
│      "(n=50)"          → 3/6 = 0.50   ✗ REJECT (< 0.60)                                                                                                                              │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 4: MINIMUM CORPUS HITS                                                                                                                                                         │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: quality.min_alias_hits: 1                                                                                                                                                   │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      total_hits = text_hits + table_hits                                                                                                                                             │
│      if total_hits < 1:                                                                                                                                                              │
│        → REJECT   (alias doesn't appear anywhere in corpus)                                                                                                                          │
│                                                                                                                                                                                      │
│    PURPOSE: Remove aliases that don't appear in any paper. They can't be matched anyway.                                                                                            │
│                                                                                                                                                                                      │
│    EXAMPLES (assuming corpus has 5M docs):                                                                                                                                           │
│      "BMI"             → 50,000 hits  ✓ PASS                                                                                                                                         │
│      "field 21001"     → 150 hits     ✓ PASS                                                                                                                                         │
│      "xyzzy123abc"     → 0 hits       ✗ REJECT (doesn't exist in corpus)                                                                                                             │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 5: STOPWORD FILTER (too common = semantically meaningless)                                                                                                                     │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: quality.max_doc_freq_fraction: 0.70                                                                                                                                         │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      if total_docs > 0:                                                                                                                                                              │
│        doc_freq_ratio = doc_count / total_docs                                                                                                                                       │
│        if doc_freq_ratio > 0.70:                                                                                                                                                     │
│          → REJECT   (appears in >70% of documents = stopword)                                                                                                                        │
│                                                                                                                                                                                      │
│    PURPOSE: Words that appear in most documents have no discriminative power.                                                                                                        │
│             They're essentially stopwords for our feature extraction task.                                                                                                           │
│                                                                                                                                                                                      │
│    EXAMPLES (assuming 5000 papers, each with ~1000 ES docs, total_docs ≈ 5,000,000):                                                                                                 │
│      "patient"         → appears in 4,500,000 docs (90%)  ✗ REJECT (> 70%)                                                                                                           │
│      "study"           → appears in 4,000,000 docs (80%)  ✗ REJECT (> 70%)                                                                                                           │
│      "data"            → appears in 3,800,000 docs (76%)  ✗ REJECT (> 70%)                                                                                                           │
│      "analysis"        → appears in 3,600,000 docs (72%)  ✗ REJECT (> 70%)                                                                                                           │
│      "BMI"             → appears in   150,000 docs (3%)   ✓ PASS (< 70%)                                                                                                             │
│      "blood pressure"  → appears in   200,000 docs (4%)   ✓ PASS (< 70%)                                                                                                             │
│      "field 21001"     → appears in       100 docs (0%)   ✓ PASS (< 70%)                                                                                                             │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  GATE 6: TABLE DOMINANCE FILTER                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: quality.max_table_dominance: 0.85                                                                                                                                           │
│                                                                                                                                                                                      │
│    LOGIC:                                                                                                                                                                            │
│      if total_hits > 0:                                                                                                                                                              │
│        table_dominance_ratio = table_hits / (text_hits + table_hits)                                                                                                                 │
│        if table_dominance_ratio > 0.85:                                                                                                                                              │
│          → REJECT   (>85% of occurrences are in tables = likely table artifact)                                                                                                      │
│                                                                                                                                                                                      │
│    PURPOSE: Terms that ONLY appear in tables are often table formatting artifacts                                                                                                    │
│             or column headers that aren't semantically meaningful as feature names.                                                                                                  │
│                                                                                                                                                                                      │
│    EXAMPLES:                                                                                                                                                                         │
│      "n/a"             → text=10, table=1000   → 1000/1010 = 99%   ✗ REJECT (> 85%)                                                                                                  │
│      "---"             → text=0, table=500     → 500/500 = 100%    ✗ REJECT (> 85%)                                                                                                  │
│      "mean"            → text=100, table=900   → 900/1000 = 90%    ✗ REJECT (> 85%)                                                                                                  │
│      "BMI"             → text=40000, table=10000 → 10000/50000 = 20%  ✓ PASS (< 85%)                                                                                                 │
│      "blood pressure"  → text=35000, table=5000  → 5000/40000 = 12%   ✓ PASS (< 85%)                                                                                                 │
│      "field 21001"     → text=100, table=50      → 50/150 = 33%       ✓ PASS (< 85%)                                                                                                 │
│                                                                                                                                                                                      │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│                                                                                                                                                                                      │
│  OUTPUT: clean_aliases = aliases that passed ALL 6 gates                                                                                                                             │
│          Example: ["BMI", "bmi", "body mass index", "Body mass index (BMI)", "field 21001", ...]                                                                                     │
│                                                                                                                                                                                      │
│  FALLBACK: If no aliases pass, return first max_review_aliases (25) base aliases anyway                                                                                             │
│            Config: output.max_review_aliases: 25                                                                                                                                     │
│                                                                                                                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                                            │
                                                                                            ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                                                                      │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  STEP 3: COLLOCATE EXPANSION (extract_collocates + expand)                                                                                                                           │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│                                                                                                                                                                                      │
│  PURPOSE: Find words that frequently co-occur with clean_aliases, then create expanded aliases                                                                                       │
│           Example: "BMI" often co-occurs with "mean" → create "mean BMI" as new alias                                                                                                │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  STEP 3a: GATHER CONTEXTS FROM ELASTICSEARCH                                                                                                                                         │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: collocation.max_contexts_for_collocates: 500                                                                                                                                │
│  Config: collocation.max_aliases_for_context: 10                                                                                                                                     │
│                                                                                                                                                                                      │
│    Take first 10 clean_aliases (sorted by length, longest first)                                                                                                                     │
│    For each alias, search ES for contexts containing that alias                                                                                                                      │
│    Collect up to 500 total context documents                                                                                                                                         │
│                                                                                                                                                                                      │
│    CONTEXT STRUCTURE:                                                                                                                                                                │
│    ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│    │  \textbraceleft{\textbraceright{}                                                                                                                                                                          │   │
│    │    "text": "The mean BMI was 25.3 kg/m2 at baseline assessment",                                                                                                            │   │
│    │    "source_type": "body"                                                                                                                                                    │   │
│    │  \textbraceright{}                                                                                                                                                                          │   │
│    └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  STEP 3b: BALANCE TEXT vs TABLE CONTEXTS                                                                                                                                             │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: sections.include_text: true → source_types = \textbraceleft{\textbraceright{}body, abstract, title, section_header, caption\textbraceright{}                                                                              │
│  Config: sections.include_table_headers: true → source_types += \textbraceleft{\textbraceright{}table_header\textbraceright{}                                                                                                       │
│  Config: sections.include_table_rows: true → source_types += \textbraceleft{\textbraceright{}table_row_header\textbraceright{}                                                                                                      │
│  Config: sections.include_table_body: false → table_data_cell NOT included (too noisy)                                                                                               │
│                                                                                                                                                                                      │
│    Split contexts by source_type:                                                                                                                                                    │
│      text_contexts = [c for c in contexts if c.source_type in \textbraceleft{\textbraceright{}body, abstract, title, section_header, caption\textbraceright{}]                                                                     │
│      table_contexts = [c for c in contexts if c.source_type in \textbraceleft{\textbraceright{}table_header, table_row_header, table_data_cell\textbraceright{}]                                                                   │
│                                                                                                                                                                                      │
│    Balance to avoid table/text bias:                                                                                                                                                 │
│      k = min(len(text_contexts), len(table_contexts))                                                                                                                                │
│      balanced_contexts = text_contexts[:k] + table_contexts[:k]   if k > 0 else contexts                                                                                             │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  STEP 3c: COMPUTE COLLOCATE LIFT SCORES                                                                                                                                              │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: collocation.window_size: 5                                                                                                                                                  │
│  Config: collocation.min_count: 25                                                                                                                                                   │
│  Config: tokenizer.spacy_model: "en_core_web_sm"                                                                                                                                     │
│                                                                                                                                                                                      │
│    ALGORITHM (Lift Score):                                                                                                                                                           │
│                                                                                                                                                                                      │
│      foreground_freq = \textbraceleft{\textbraceright{}\textbraceright{}  # Words within ±5 words of alias                                                                                                                          │
│      background_freq = \textbraceleft{\textbraceright{}\textbraceright{}  # All words in all contexts                                                                                                                               │
│                                                                                                                                                                                      │
│      for each context:                                                                                                                                                               │
│        tokens = tokenize(context.text)                    ← spaCy tokenization, lowercase                                                                                            │
│                                                                                                                                                                                      │
│        # Find alias position in tokens                                                                                                                                               │
│        for i, token in enumerate(tokens):                                                                                                                                            │
│          if token matches any alias (case-insensitive):                                                                                                                              │
│            # Extract window around alias                                                                                                                                             │
│            start = max(0, i - window_size)    # i - 5                                                                                                                                │
│            end = min(len(tokens), i + len(alias_tokens) + window_size)   # i + alias_len + 5                                                                                         │
│            window_tokens = tokens[start:end]                                                                                                                                         │
│                                                                                                                                                                                      │
│            # Count foreground (near alias)                                                                                                                                           │
│            for word in window_tokens:                                                                                                                                                │
│              if word not in stopwords and word not in aliases:                                                                                                                       │
│                foreground_freq[word] += 1                                                                                                                                            │
│                                                                                                                                                                                      │
│        # Count background (all words)                                                                                                                                                │
│        for word in tokens:                                                                                                                                                           │
│          if word not in stopwords:                                                                                                                                                   │
│            background_freq[word] += 1                                                                                                                                                │
│                                                                                                                                                                                      │
│      # Calculate lift score for each word                                                                                                                                            │
│      for word in foreground_freq:                                                                                                                                                    │
│        if foreground_freq[word] >= min_count (25):     ← Must appear at least 25 times near aliases                                                                                  │
│          lift_score = foreground_freq[word] / max(background_freq[word], 1)                                                                                                          │
│                                                                                                                                                                                      │
│    EXAMPLE OUTPUT (sorted by lift score, top 30):                                                                                                                                    │
│    ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │
│    │  WORD          │  FG_FREQ  │  BG_FREQ  │  LIFT_SCORE  │  NOTES                                                                                                              │   │
│    │  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────  │   │
│    │  mean          │  450      │  2000     │  0.225       │  Often: "mean BMI"                                                                                                  │   │
│    │  baseline      │  380      │  1500     │  0.253       │  Often: "baseline BMI"                                                                                              │   │
│    │  calculated    │  200      │  600      │  0.333       │  Often: "BMI calculated"                                                                                            │   │
│    │  measured      │  180      │  500      │  0.360       │  Often: "BMI measured"                                                                                              │   │
│    │  higher        │  150      │  800      │  0.188       │  Often: "higher BMI"                                                                                                │   │
│    │  lower         │  140      │  750      │  0.187       │  Often: "lower BMI"                                                                                                 │   │
│    │  obesity       │  120      │  200      │  0.600       │  Often: "BMI obesity"                                                                                               │   │
│    │  ...           │  ...      │  ...      │  ...         │                                                                                                                     │   │
│    └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  STEP 3d: EXPAND ALIASES USING TOP COLLOCATES                                                                                                                                        │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: collocation.top_collocates_to_check: 30                                                                                                                                     │
│  Config: output.max_proposed_aliases: 50                                                                                                                                             │
│  Config: quality.min_alias_length: 3                                                                                                                                                 │
│  Config: embedding_thresholds.expanded_alias_title_sim: 0.50                                                                                                                         │
│  Config: embedding_thresholds.expanded_alias_base_sim: 0.60                                                                                                                          │
│  Config: embedding_thresholds.top_base_aliases_for_validation: 5                                                                                                                     │
│                                                                                                                                                                                      │
│    ALGORITHM:                                                                                                                                                                        │
│                                                                                                                                                                                      │
│      for each word in top_30_collocates:                                                                                                                                             │
│        if word already in clean_aliases or len(word) < 3:                                                                                                                            │
│          skip                                                                                                                                                                        │
│                                                                                                                                                                                      │
│        for each base_alias in clean_aliases:                                                                                                                                         │
│          # Try both orderings                                                                                                                                                        │
│          candidates = [f"\textbraceleft{\textbraceright{}word\textbraceright{} \textbraceleft{\textbraceright{}base_alias\textbraceright{}", f"\textbraceleft{\textbraceright{}base_alias\textbraceright{} \textbraceleft{\textbraceright{}word\textbraceright{}"]                                                                                                               │
│                                                                                                                                                                                      │
│          for candidate in candidates:                                                                                                                                                │
│            # CHECK 1: Does candidate exist in corpus?                                                                                                                                │
│            ca_counts = query_es_for_counts(candidate.lower())                                                                                                                        │
│            if ca_counts.total_hits == 0:                                                                                                                                             │
│              skip   # Doesn't exist, can't match                                                                                                                                     │
│                                                                                                                                                                                      │
│            # CHECK 2: Is candidate count <= base alias count?                                                                                                                        │
│            if ca_counts.total_hits > base_alias_counts.total_hits:                                                                                                                   │
│              skip   # More general than base = wrong direction                                                                                                                       │
│                                                                                                                                                                                      │
│            # CHECK 3: Does candidate pass is_clean_alias (all 6 gates)?                                                                                                              │
│            if not is_clean_alias(candidate, title, ca_counts, total_docs, config):                                                                                                   │
│              skip                                                                                                                                                                    │
│                                                                                                                                                                                      │
│            # CHECK 4: validate_expanded_alias (semantic similarity check)                                                                                                            │
│            if not validate_expanded_alias(candidate, title, clean_aliases, embedder, config, units):                                                                                 │
│              skip                                                                                                                                                                    │
│                                                                                                                                                                                      │
│            # All checks passed - add to expanded set                                                                                                                                 │
│            expanded_aliases.add(candidate)                                                                                                                                           │
│                                                                                                                                                                                      │
│            # Stop if we have enough                                                                                                                                                  │
│            if len(clean_aliases) + len(expanded_aliases) >= max_proposed_aliases (50):                                                                                               │
│              break                                                                                                                                                                   │
│                                                                                                                                                                                      │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│                                                                                                                                                                                      │
│  STEP 3e: VALIDATE EXPANDED ALIAS (validate_expanded_alias)                                                                                                                          │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: embedder.model_name: "cambridgeltl/SapBERT-from-PubMedBERT-fulltext"                                                                                                        │
│  Config: embedding_thresholds.expanded_alias_title_sim: 0.50                                                                                                                         │
│  Config: embedding_thresholds.expanded_alias_base_sim: 0.60                                                                                                                          │
│  Config: embedding_thresholds.top_base_aliases_for_validation: 5                                                                                                                     │
│  Config: generic_terms.base: ["mean", "level", "value", "measurement", "test", "total"]                                                                                              │
│  Config: generic_terms.with_units: ["concentration", "amount", "quantity"]                                                                                                           │
│                                                                                                                                                                                      │
│    VALIDATION LOGIC:                                                                                                                                                                 │
│                                                                                                                                                                                      │
│      # Reject if ALL words are generic terms                                                                                                                                         │
│      words = candidate_alias.lower().split()                                                                                                                                         │
│      generic_base = \textbraceleft{\textbraceright{}"mean", "level", "value", "measurement", "test", "total"\textbraceright{}                                                                                                       │
│      generic_units = \textbraceleft{\textbraceright{}"concentration", "amount", "quantity"\textbraceright{}                                                                                                                         │
│                                                                                                                                                                                      │
│      if all(word in generic_base for word in words):                                                                                                                                 │
│        → REJECT   ("mean level" = meaningless)                                                                                                                                       │
│                                                                                                                                                                                      │
│      if units and all(word in generic_units for word in words):                                                                                                                      │
│        → REJECT   ("concentration amount" = meaningless when feature has units)                                                                                                      │
│                                                                                                                                                                                      │
│      # Semantic similarity checks using SapBERT embeddings                                                                                                                           │
│      candidate_embedding = embedder.encode(candidate_alias)                                                                                                                          │
│      title_embedding = embedder.encode(feature_title)                                                                                                                                │
│                                                                                                                                                                                      │
│      # CHECK: Similarity to title                                                                                                                                                    │
│      title_sim = cosine_similarity(candidate_embedding, title_embedding)                                                                                                             │
│      if title_sim < 0.50:                                                                                                                                                            │
│        → REJECT   (not semantically related to feature)                                                                                                                              │
│                                                                                                                                                                                      │
│      # CHECK: Similarity to top base aliases                                                                                                                                         │
│      top_bases = base_aliases[:5]                                                                                                                                                    │
│      base_embeddings = [embedder.encode(b) for b in top_bases]                                                                                                                       │
│      base_sims = [cosine_similarity(candidate_embedding, be) for be in base_embeddings]                                                                                              │
│      max_base_sim = max(base_sims)                                                                                                                                                   │
│                                                                                                                                                                                      │
│      if max_base_sim < 0.60:                                                                                                                                                         │
│        → REJECT   (not similar enough to existing aliases)                                                                                                                           │
│                                                                                                                                                                                      │
│      → ACCEPT                                                                                                                                                                        │
│                                                                                                                                                                                      │
│    EXAMPLES:                                                                                                                                                                         │
│      "mean BMI"        + title="Body mass index" → title_sim=0.72 ✓, base_sim=0.85 ✓ → ACCEPT                                                                                        │
│      "baseline BMI"    + title="Body mass index" → title_sim=0.68 ✓, base_sim=0.82 ✓ → ACCEPT                                                                                        │
│      "mean level"      + title="Body mass index" → generic terms only → REJECT                                                                                                       │
│      "obesity BMI"     + title="Body mass index" → title_sim=0.55 ✓, base_sim=0.75 ✓ → ACCEPT                                                                                        │
│      "cancer BMI"      + title="Body mass index" → title_sim=0.32 ✗ → REJECT (unrelated)                                                                                             │
│                                                                                                                                                                                      │
│  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│                                                                                                                                                                                      │
│  FINAL OUTPUT: feature_alias_map.json                                                                                                                                                │
│  ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────│
│  Config: output.directory: "/app/output"                                                                                                                                             │
│  Config: output.feature_alias_map_file: "feature_alias_map.json"                                                                                                                     │
│  Config: output.max_proposed_aliases: 50                                                                                                                                             │
│                                                                                                                                                                                      │
│    \textbraceleft{\textbraceright{}                                                                                                                                                                                 │
│      "21001": [                                                                                                                                                                      │
│        "body mass index (bmi)",           ← From title                                                                                                                               │
│        "Body mass index (BMI)",           ← From title (original case)                                                                                                               │
│        "body mass index",                 ← Lemmatized title                                                                                                                         │
│        "BMI",                             ← From acr_abb_1                                                                                                                           │
│        "bmi",                             ← Lowercase curated acronym                                                                                                                │
│        "mean BMI",                        ← Expanded (collocate "mean" + "BMI")                                                                                                      │
│        "baseline BMI",                    ← Expanded (collocate "baseline" + "BMI")                                                                                                  │
│        "BMI calculated",                  ← Expanded (collocate "calculated" + "BMI")                                                                                                │
│        "higher BMI",                      ← Expanded                                                                                                                                 │
│        "lower BMI",                       ← Expanded                                                                                                                                 │
│        "field 21001",                     ← Field ID pattern (HIGH TRUST)                                                                                                            │
│        "ukb 21001",                       ← Field ID pattern                                                                                                                         │
│        "#21001",                          ← Field ID pattern                                                                                                                         │
│        "f21001",                          ← Field ID pattern                                                                                                                         │
│        ...                                ← Up to 50 total                                                                                                                           │
│      ],                                                                                                                                                                              │
│      "21002": [...],                                                                                                                                                                 │
│      "21003": [...],                                                                                                                                                                 │
│      ...                                                                                                                                                                             │
│    \textbraceright{}                                                                                                                                                                                 │
│                                                                                                                                                                                      │
│    TOTAL: ~6000 features × up to 50 aliases each = up to 300,000 alias entries                                                                                                       │
│                                                                                                                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                              COMPLETE HYPERPARAMETER REFERENCE                                                                                        ║
╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  QUALITY THRESHOLDS (feature_extraction.yaml)              │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  quality.min_alias_hits                                    │  1        │  Minimum ES hits to consider alias valid                                                              │  ║
║  │  quality.min_alias_length                                  │  3        │  Minimum characters for expanded aliases                                                              │  ║
║  │  quality.max_alias_length                                  │  300      │  Maximum characters before rejection                                                                  │  ║
║  │  quality.min_word_count                                    │  1        │  Minimum words in lemmatized title alias                                                              │  ║
║  │  quality.min_alnum_ratio                                   │  0.60     │  Minimum alphanumeric/total char ratio                                                                │  ║
║  │  quality.max_doc_freq_fraction                             │  0.70     │  Maximum doc frequency (>70% = stopword)                                                              │  ║
║  │  quality.max_table_dominance                               │  0.85     │  Maximum table hit ratio (>85% = artifact)                                                            │  ║
║  │  quality.max_title_anchors                                 │  8        │  Cap on title anchor words for lemmatization                                                          │  ║
║  │  quality.numeric_context_threshold                         │  0.20     │  Threshold for numeric context detection                                                              │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  COLLOCATION PARAMETERS (feature_extraction.yaml)          │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  collocation.window_size                                   │  5        │  Words left/right of alias to check for collocates                                                    │  ║
║  │  collocation.min_count                                     │  25       │  Minimum foreground frequency for collocate                                                           │  ║
║  │  collocation.top_collocates_to_check                       │  30       │  How many top collocates to try expanding                                                             │  ║
║  │  collocation.max_contexts_for_collocates                   │  500      │  Maximum contexts to gather for collocation analysis                                                  │  ║
║  │  collocation.max_aliases_for_context                       │  10       │  Max aliases to search when gathering contexts                                                        │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  EMBEDDING THRESHOLDS (feature_extraction.yaml)            │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  embedding_thresholds.base_threshold                       │  0.60     │  Default similarity threshold                                                                         │  ║
║  │  embedding_thresholds.acronym_1_2_char                     │  0.80     │  Threshold for 1-2 char acronyms (very strict)                                                        │  ║
║  │  embedding_thresholds.acronym_3_char                       │  0.65     │  Threshold for 3 char acronyms (moderately strict)                                                    │  ║
║  │  embedding_thresholds.acronym_4plus_char                   │  0.60     │  Threshold for 4+ char acronyms (normal)                                                              │  ║
║  │  embedding_thresholds.field_id_pattern                     │  0.40     │  Threshold for field ID patterns (high trust)                                                         │  ║
║  │  embedding_thresholds.expanded_alias_title_sim             │  0.50     │  Min similarity to title for expanded alias                                                           │  ║
║  │  embedding_thresholds.expanded_alias_base_sim              │  0.60     │  Min similarity to base aliases for expansion                                                         │  ║
║  │  embedding_thresholds.top_base_aliases_for_validation      │  5        │  How many base aliases to compare against                                                             │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  OUTPUT LIMITS (feature_extraction.yaml)                   │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  output.max_proposed_aliases                               │  50       │  Maximum aliases per feature in final map                                                             │  ║
║  │  output.max_review_aliases                                 │  25       │  Fallback alias count if no clean aliases pass                                                        │  ║
║  │  output.max_review_samples                                 │  30       │  Sample contexts for manual review                                                                    │  ║
║  │  output.directory                                          │  /app/output │  Where to save output files                                                                       │  ║
║  │  output.feature_alias_map_file                             │  feature_alias_map.json │  Alias map filename                                                                     │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  TABLE ARTIFACT BLACKLIST (feature_extraction.yaml)        │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  table_artifacts.blacklist                                 │  ["|", "||", "|||", "-", "--", "---", "figure", "table", "fig", "vid", "ci", "%", "n/a", "na", "null",           │  ║
║  │                                                            │   "confidence interval", "ci %", "% ci", "figure vid", "vid figure", "table vid"]                                 │  ║
║  │  table_artifacts.single_char_exceptions                    │  ["a", "b", "c"]                                                                                                  │  ║
║  │  table_artifacts.max_dashes                                │  2        │  Dashes beyond this count = artifact                                                                  │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  GENERIC TERMS (feature_extraction.yaml)                   │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  generic_terms.base                                        │  ["mean", "level", "value", "measurement", "test", "total"]                                                       │  ║
║  │  generic_terms.with_units                                  │  ["concentration", "amount", "quantity"]                                                                          │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  SAMPLING THRESHOLDS (feature_extraction.yaml)             │  VALUE    │  PURPOSE                                                                                              │  ║
║  ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  sampling.high_threshold                                   │  0.80     │  Score >= 0.80 = HIGH confidence                                                                      │  ║
║  │  sampling.mid_threshold                                    │  0.60     │  Score >= 0.60 = MEDIUM confidence                                                                    │  ║
║  │  sampling.low_threshold                                    │  0.40     │  Score >= 0.40 = LOW confidence (minimum to include)                                                  │  ║
║  │  sampling.high_count                                       │  15       │  Samples from HIGH bucket                                                                             │  ║
║  │  sampling.mid_count                                        │  10       │  Samples from MEDIUM bucket                                                                           │  ║
║  │  sampling.low_count                                        │  5        │  Samples from LOW bucket                                                                              │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                                                                                                       ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝
\end{Verbatim}
~~~



