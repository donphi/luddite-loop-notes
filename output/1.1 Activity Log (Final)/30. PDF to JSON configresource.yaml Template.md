# PDF to JSON: config/resource.yaml Template


## Content


## Document Processing Pipeline - Stage Reference


Version: 0.1 (Skeleton)



Last Updated: [DATE]



Purpose: Scientific documentation of the PDF-to-structured-data pipeline architecture.



---


## Pipeline Overview




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐
│   G0    │──►│   G1    │──►│   G2    │──►│   G3    │──►│   G4    │
│ Orch.   │   │Preflight│   │  Spine  │   │ Engines │   │Metadata │
└─────────┘   └─────────┘   └─────────┘   └─────────┘   └─────────┘
                                                              │
┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐         │
│   G9    │◄──│   G8    │◄──│   G7    │◄──│   G6    │◄──┬─────┘
│   QC    │   │ Export  │   │ Tables  │   │Structure│   │
└─────────┘   └─────────┘   └─────────┘   └─────────┘   │
                                                        │
                                              ┌─────────┴─────────┐
                                              │        G5         │
                                              │    Alignment      │
                                              └───────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐
│   G0    │──►│   G1    │──►│   G2    │──►│   G3    │──►│   G4    │
│ Orch.   │   │Preflight│   │  Spine  │   │ Engines │   │Metadata │
└─────────┘   └─────────┘   └─────────┘   └─────────┘   └─────────┘
                                                              │
┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐         │
│   G9    │◄──│   G8    │◄──│   G7    │◄──│   G6    │◄──┬─────┘
│   QC    │   │ Export  │   │ Tables  │   │Structure│   │
└─────────┘   └─────────┘   └─────────┘   └─────────┘   │
                                                        │
                                              ┌─────────┴─────────┐
                                              │        G5         │
                                              │    Alignment      │
                                              └───────────────────┘

\end{Verbatim}
~~~




### Stage Type Legend



<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Scripts</th>
      <th>Invocation</th>
      <th>Parallelism</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>CPU</strong></td>
      <td>Single script</td>
      <td>Per-document subprocess</td>
      <td><code>parallel_map()</code></td>
    </tr>
    <tr>
      <td><strong>CPU HEAVY</strong></td>
      <td>Single script</td>
      <td>Per-document subprocess</td>
      <td>High worker count</td>
    </tr>
    <tr>
      <td><strong>GPU</strong></td>
      <td>Dispatch + Worker pair</td>
      <td>Persistent daemon</td>
      <td>Queue-based</td>
    </tr>
  </tbody>
</table>



---


# G0: Orchestrator


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────┐
│                    ORCHESTRATOR (core.py)                   │
│                                                             │
│  1. [Step 1: G0_00 - G0_0X]                                 │
│  2. [Step 2: G1_00 - G1_0X]                                 │
│  3. [Step 3: G2_00 - G2_0X]                                 |               
|   ...                                                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    [Downstream stages]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────┐
│                    ORCHESTRATOR (core.py)                   │
│                                                             │
│  1. [Step 1: G0_00 - G0_0X]                                 │
│  2. [Step 2: G1_00 - G1_0X]                                 │
│  3. [Step 3: G2_00 - G2_0X]                                 |               
|   ...                                                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    [Downstream stages]

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>max_parallel_documents</code></td>
      <td><code>2-50</code></td>
      <td>Set documents per orchestration container</td>
    </tr>
    <tr>
      <td><code>pdf_job_queue</code></td>
      <td><code>&quot;pdf_job_queue&quot;</code></td>
      <td>Each job queue neeeds a name</td>
    </tr>
  </tbody>
</table>



---


# G1: Preflight


## Purpose

- Initial document preparation: rasterization, orientation detection, routing decisions

## Stages



<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Name</th>
      <th>Type</th>
      <th>Enabled</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>G1_01</td>
      <td>PDF → PNG</td>
      <td>CPU HEAVY</td>
      <td>✓</td>
      <td>[Rasterize PDF pages to images]</td>
    </tr>
    <tr>
      <td>G1_02</td>
      <td>Detect Orientation</td>
      <td>GPU</td>
      <td>✓</td>
      <td>[Determine page rotation needs]</td>
    </tr>
    <tr>
      <td>G1_03</td>
      <td>Apply Rotation</td>
      <td>CPU</td>
      <td>✓</td>
      <td>[Correct page orientation]</td>
    </tr>
    <tr>
      <td>G1_04</td>
      <td>Probe and Route</td>
      <td>CPU</td>
      <td>✓</td>
      <td>[Analyze PDF structure, decide OCR path]</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
    </tr>
  </tbody>
</table>



---


## G1_01: PDF → PNG


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────┐
│                    PDF SOURCE                               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    G1_01 (CPU HEAVY)                        │
│                                                             │
│  1. [method 1]                                              │
│  2. [method 2]                                              |
|  3. ...                                                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    PNG OUTPUT                               │
│                    {doc_id}/png/*.png                       │
└─────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────┐
│                    PDF SOURCE                               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    G1_01 (CPU HEAVY)                        │
│                                                             │
│  1. [method 1]                                              │
│  2. [method 2]                                              |
|  3. ...                                                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    PNG OUTPUT                               │
│                    \textbraceleft{\textbraceright{}doc_id\textbraceright{}/png/*.png                       │
└─────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>workers</code></td>
      <td><code>cpu_workers_heavy</code></td>
      <td>Sets the amount of workers for the CPU process</td>
    </tr>
    <tr>
      <td><code>dpi</code></td>
      <td><code>350</code></td>
      <td>This is the <code>dots per inch</code> or scan quality of each <code>*.png</code></td>
    </tr>
  </tbody>
</table>



---


## G1_02: Detect Orientation


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────┐
│                    G1_02_dispatch.py                        │
│                                                             │
│  1. [method 1]                                              │
│  2. [method 2]                                              |
|  3. ...                                                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    G1_02_worker.py [Docker Container]       │
│                                                             │
│  [Model loading and inference]                              │
└─────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────┐
│                    G1_02_dispatch.py                        │
│                                                             │
│  1. [method 1]                                              │
│  2. [method 2]                                              |
|  3. ...                                                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    G1_02_worker.py [Docker Container]       │
│                                                             │
│  [Model loading and inference]                              │
└─────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>workers</code></td>
      <td><code>gpu_workers</code></td>
      <td>Sets the amount of wokers for the GPU process</td>
    </tr>
    <tr>
      <td><code>margin_crop_percent</code></td>
      <td><code>0.15</code></td>
      <td>Sets the percentage of cropping around the page boundry</td>
    </tr>
    <tr>
      <td><code>tesseract_osd_config</code></td>
      <td><code>&quot;--psm 0&quot;</code></td>
      <td>model parameter to prevent OCR ccanning</td>
    </tr>
  </tbody>
</table>



---


## G1_03: Apply Rotation


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder]

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>workers</code></td>
      <td><code>cpu_workers_light</code></td>
      <td>[Description]</td>
    </tr>
  </tbody>
</table>



---


## G1_04: Probe and Route


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder]

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>hard_page_ratio_threshold</code></td>
      <td><code>0.0</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>geom_avg_width_threshold_pt</code></td>
      <td><code>4.5</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>char_span_threshold_avg_len</code></td>
      <td><code>1.5</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>word_span_threshold_ratio</code></td>
      <td><code>2.0</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>bbox_min_words_for_geom_test</code></td>
      <td><code>50</code></td>
      <td>[Description]</td>
    </tr>
  </tbody>
</table>



### Routing Logic




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Decision tree placeholder]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Decision tree placeholder]

\end{Verbatim}
~~~




---


# G2: Token Spine


## Purpose


[OCR processing and token extraction to build the authoritative text spine]



## Stages



<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Name</th>
      <th>Type</th>
      <th>Enabled</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>G2_05</td>
      <td>OCR</td>
      <td>GPU</td>
      <td>✓</td>
      <td>[PaddleOCR text extraction]</td>
    </tr>
    <tr>
      <td>G2_06</td>
      <td>Build Line Tokens</td>
      <td>CPU</td>
      <td>✓</td>
      <td>[Assemble line-level tokens]</td>
    </tr>
    <tr>
      <td>G2_07</td>
      <td>Build Word Tokens</td>
      <td>CPU</td>
      <td>✓</td>
      <td>[Assemble word-level tokens]</td>
    </tr>
    <tr>
      <td>G2_08</td>
      <td>Spine QC Line</td>
      <td>CPU</td>
      <td>✓</td>
      <td>[Quality check line tokens]</td>
    </tr>
    <tr>
      <td>G2_09</td>
      <td>Spine QC Word</td>
      <td>CPU</td>
      <td>✓</td>
      <td>[Quality check word tokens]</td>
    </tr>
  </tbody>
</table>



---


## G2_05: OCR


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────┐
│                    G2_05_dispatch.py                        │
│                                                             │
│  1. Load contract                                           │
│  2. Publish job to RabbitMQ (queue: ocr_jobs)               │
│  3. Wait for sentinel (.ocr_done)                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    G2_05_worker.py [DAEMON]                 │
│                                                             │
│  STARTUP: Load PaddleOCR models                             │
│  LOOP: Process jobs, write ALTO XML + sentinels             │
└─────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────┐
│                    G2_05_dispatch.py                        │
│                                                             │
│  1. Load contract                                           │
│  2. Publish job to RabbitMQ (queue: ocr_jobs)               │
│  3. Wait for sentinel (.ocr_done)                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    G2_05_worker.py [DAEMON]                 │
│                                                             │
│  STARTUP: Load PaddleOCR models                             │
│  LOOP: Process jobs, write ALTO XML + sentinels             │
└─────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>workers</code></td>
      <td><code>gpu_workers</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>batch_size</code></td>
      <td><code>batch_size</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>device</code></td>
      <td><code>&quot;cuda:0&quot;</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>job_queue</code></td>
      <td><code>&quot;ocr_jobs&quot;</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>result_sentinel_suffix</code></td>
      <td><code>&quot;.ocr_done&quot;</code></td>
      <td>[Description]</td>
    </tr>
  </tbody>
</table>



### Critical Matching




~~~{=html}
<pre class="notion-ascii-diagram"><code>resources.yaml          worker.py               docker-compose.yaml
      │                      │                         │
      │  job_queue           │  JOB_QUEUE              │  container_name
      │  &quot;ocr_jobs&quot; ─────────┼─► &quot;ocr_jobs&quot;            │
      │                      │                         │
      │                      │  WORKER_NAME ───────────┼─► ocr-worker
      │                      │  &quot;ocr-worker&quot;           │
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
resources.yaml          worker.py               docker-compose.yaml
      │                      │                         │
      │  job_queue           │  JOB_QUEUE              │  container_name
      │  "ocr_jobs" ─────────┼─► "ocr_jobs"            │
      │                      │                         │
      │                      │  WORKER_NAME ───────────┼─► ocr-worker
      │                      │  "ocr-worker"           │

\end{Verbatim}
~~~




---


## G2_06: Build Line Tokens


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder]

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>workers</code></td>
      <td><code>cpu_workers_light</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>layout_provider</code></td>
      <td><code>&quot;pp_structure&quot;</code></td>
      <td>[Description]</td>
    </tr>
  </tbody>
</table>



---


## G2_07: Build Word Tokens


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder]

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>workers</code></td>
      <td><code>cpu_workers_light</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>word_text_key</code></td>
      <td><code>&quot;text_word&quot;</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>bbox_mode</code></td>
      <td><code>&quot;poly&quot;</code></td>
      <td>[Description]</td>
    </tr>
  </tbody>
</table>



---


## G2_08: Spine QC Line


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder]

\end{Verbatim}
~~~




---


## G2_09: Spine QC Word


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder]

\end{Verbatim}
~~~




---


# G3: Text Engines


## Purpose


[Alternative text extraction engines for cross-validation and enrichment]



## Stages



<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Name</th>
      <th>Type</th>
      <th>Enabled</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>G3_10</td>
      <td>Marker</td>
      <td>GPU</td>
      <td>✓</td>
      <td>[Marker PDF extraction]</td>
    </tr>
    <tr>
      <td>G3_11</td>
      <td>Docling</td>
      <td>GPU</td>
      <td>✓</td>
      <td>[Docling PDF extraction]</td>
    </tr>
  </tbody>
</table>



---


## G3_10: Marker


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────┐
│                    G3_10_dispatch.py                        │
│                                                             │
│  Queue: marker_jobs                                         │
│  Sentinel: .marker_done                                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    G3_10_worker.py [DAEMON]                 │
│                                                             │
│  [Marker model inference]                                   │
└─────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────┐
│                    G3_10_dispatch.py                        │
│                                                             │
│  Queue: marker_jobs                                         │
│  Sentinel: .marker_done                                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    G3_10_worker.py [DAEMON]                 │
│                                                             │
│  [Marker model inference]                                   │
└─────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>job_queue</code></td>
      <td><code>&quot;marker_jobs&quot;</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>result_sentinel_suffix</code></td>
      <td><code>&quot;.marker_done&quot;</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>max_wait_seconds</code></td>
      <td><code>1800</code></td>
      <td>[Description]</td>
    </tr>
  </tbody>
</table>



---


## G3_11: Docling


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────┐
│                    G3_11_dispatch.py                        │
│                                                             │
│  Queue: docling_jobs                                        │
│  Sentinel: .docling_done                                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    G3_11_worker.py [DAEMON]                 │
│                                                             │
│  [Docling model inference]                                  │
└─────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────┐
│                    G3_11_dispatch.py                        │
│                                                             │
│  Queue: docling_jobs                                        │
│  Sentinel: .docling_done                                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    G3_11_worker.py [DAEMON]                 │
│                                                             │
│  [Docling model inference]                                  │
└─────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>job_queue</code></td>
      <td><code>&quot;docling_jobs&quot;</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>do_ocr</code></td>
      <td><code>false</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>ocr_engine</code></td>
      <td><code>&quot;tesseract&quot;</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>do_table_structure</code></td>
      <td><code>true</code></td>
      <td>[Description]</td>
    </tr>
  </tbody>
</table>



---


# G4: Metadata


## Purpose


[Bibliographic metadata extraction and normalization]



## Stages



<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Name</th>
      <th>Type</th>
      <th>Enabled</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>G4_12</td>
      <td>GROBID</td>
      <td>CPU</td>
      <td>✓</td>
      <td>[Scholarly metadata extraction]</td>
    </tr>
    <tr>
      <td>G4_13</td>
      <td>Meta Normalize</td>
      <td>CPU</td>
      <td>✓</td>
      <td>[Metadata standardization]</td>
    </tr>
  </tbody>
</table>



---


## G4_12: GROBID


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────┐
│                    G4_12.py                                 │
│                                                             │
│  1. Send PDF to GROBID server                               │
│  2. Receive TEI XML response                                │
│  3. Parse bibliographic fields                              │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    GROBID SERVER                            │
│                    http://grobid:8070                       │
└─────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────┐
│                    G4_12.py                                 │
│                                                             │
│  1. Send PDF to GROBID server                               │
│  2. Receive TEI XML response                                │
│  3. Parse bibliographic fields                              │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    GROBID SERVER                            │
│                    http://grobid:8070                       │
└─────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>base_url</code></td>
      <td><code>&quot;http://grobid:8070&quot;</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>endpoint</code></td>
      <td><code>&quot;/api/processFulltextDocument&quot;</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>consolidate_header</code></td>
      <td><code>&quot;1&quot;</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>consolidate_citations</code></td>
      <td><code>&quot;1&quot;</code></td>
      <td>[Description]</td>
    </tr>
  </tbody>
</table>



---


## G4_13: Meta Normalize


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder]

\end{Verbatim}
~~~




---


# G5: Alignment


## Purpose


[Cross-engine text alignment and coverage analysis]



## Stages



<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Name</th>
      <th>Type</th>
      <th>Enabled</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>G5_14</td>
      <td>Align Variants</td>
      <td>CPU HEAVY</td>
      <td>✓</td>
      <td>[Align text from multiple engines to spine]</td>
    </tr>
    <tr>
      <td>G5_15</td>
      <td>Unmapped Report</td>
      <td>CPU</td>
      <td>✓</td>
      <td>[Report unaligned content]</td>
    </tr>
  </tbody>
</table>



---


## G5_14: Align Variants


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────┐
│                    SPINE (G2)                               │
│                    [Authoritative tokens]                   │
└─────────────────────────────────────────────────────────────┘
        │                    │                    │
        ▼                    ▼                    ▼
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│   Marker    │      │   Docling   │      │   GROBID    │
│   (G3_10)   │      │   (G3_11)   │      │   (G4_12)   │
└─────────────┘      └─────────────┘      └─────────────┘
        │                    │                    │
        └────────────────────┼────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                    G5_14: Align Variants                    │
│                                                             │
│  [Containment scoring and alignment]                        │
└─────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────┐
│                    SPINE (G2)                               │
│                    [Authoritative tokens]                   │
└─────────────────────────────────────────────────────────────┘
        │                    │                    │
        ▼                    ▼                    ▼
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│   Marker    │      │   Docling   │      │   GROBID    │
│   (G3_10)   │      │   (G3_11)   │      │   (G4_12)   │
└─────────────┘      └─────────────┘      └─────────────┘
        │                    │                    │
        └────────────────────┼────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                    G5_14: Align Variants                    │
│                                                             │
│  [Containment scoring and alignment]                        │
└─────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>min_containment_score</code></td>
      <td><code>90.0</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>min_score_margin</code></td>
      <td><code>5.0</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>page_radius</code></td>
      <td><code>1</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>layout_provider</code></td>
      <td><code>&quot;pp_structure&quot;</code></td>
      <td>[Description]</td>
    </tr>
  </tbody>
</table>



---


## G5_15: Unmapped Report


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder]

\end{Verbatim}
~~~




### Key Parameters



<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>char_coverage_warn</code></td>
      <td><code>0.97</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>char_coverage_error</code></td>
      <td><code>0.90</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>orphan_rate_warn</code></td>
      <td><code>0.03</code></td>
      <td>[Description]</td>
    </tr>
    <tr>
      <td><code>orphan_rate_error</code></td>
      <td><code>0.10</code></td>
      <td>[Description]</td>
    </tr>
  </tbody>
</table>



---


# G6: Structure


## Purpose


[Document structure detection and tree building]



## Stages



<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Name</th>
      <th>Type</th>
      <th>Enabled</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>G6_14</td>
      <td>Label Blocks</td>
      <td>GPU</td>
      <td>✗</td>
      <td>[Classify document regions]</td>
    </tr>
    <tr>
      <td>G6_15</td>
      <td>Build Tree</td>
      <td>CPU</td>
      <td>✗</td>
      <td>[Construct document hierarchy]</td>
    </tr>
    <tr>
      <td>G6_16</td>
      <td>Structure QC</td>
      <td>CPU</td>
      <td>✗</td>
      <td>[Quality check structure]</td>
    </tr>
  </tbody>
</table>



---


## G6_14: Label Blocks


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder - Stage disabled]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder - Stage disabled]

\end{Verbatim}
~~~




---


## G6_15: Build Tree


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder - Stage disabled]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder - Stage disabled]

\end{Verbatim}
~~~




---


## G6_16: Structure QC


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder - Stage disabled]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder - Stage disabled]

\end{Verbatim}
~~~




---


# G7: Tables


## Purpose


[Table detection and cell extraction]



## Stages



<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Name</th>
      <th>Type</th>
      <th>Enabled</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>G7_17</td>
      <td>TATR Detect</td>
      <td>GPU</td>
      <td>✗</td>
      <td>[Table detection with TATR]</td>
    </tr>
    <tr>
      <td>G7_18</td>
      <td>Fill Cells</td>
      <td>CPU</td>
      <td>✗</td>
      <td>[Extract cell contents]</td>
    </tr>
  </tbody>
</table>



---


## G7_17: TATR Detect


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder - Stage disabled]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder - Stage disabled]

\end{Verbatim}
~~~




---


## G7_18: Fill Cells


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder - Stage disabled]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder - Stage disabled]

\end{Verbatim}
~~~




---


# G8: Export


## Purpose


[Final output generation and packaging]



## Stages



<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Name</th>
      <th>Type</th>
      <th>Enabled</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>G8_19</td>
      <td>Export</td>
      <td>CPU</td>
      <td>✗</td>
      <td>[Generate output formats]</td>
    </tr>
    <tr>
      <td>G8_20</td>
      <td>Provenance Pack</td>
      <td>CPU</td>
      <td>✗</td>
      <td>[Package provenance data]</td>
    </tr>
    <tr>
      <td>G8_21</td>
      <td>Validation Report</td>
      <td>CPU</td>
      <td>✗</td>
      <td>[Generate validation report]</td>
    </tr>
  </tbody>
</table>



---


## G8_19: Export


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder - Stage disabled]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder - Stage disabled]

\end{Verbatim}
~~~




---


## G8_20: Provenance Pack


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder - Stage disabled]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder - Stage disabled]

\end{Verbatim}
~~~




---


## G8_21: Validation Report


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder - Stage disabled]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder - Stage disabled]

\end{Verbatim}
~~~




---


# G9: Quality Control


## Purpose


[Pipeline-wide quality metrics and visual overlays]



## Stages



<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Name</th>
      <th>Type</th>
      <th>Enabled</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>G9_22</td>
      <td>QC Metrics</td>
      <td>CPU</td>
      <td>✗</td>
      <td>[Compute quality metrics]</td>
    </tr>
    <tr>
      <td>G9_23</td>
      <td>QC Overlays</td>
      <td>CPU HEAVY</td>
      <td>✗</td>
      <td>[Generate visual QC overlays]</td>
    </tr>
  </tbody>
</table>



---


## G9_22: QC Metrics


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder - Stage disabled]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder - Stage disabled]

\end{Verbatim}
~~~




---


## G9_23: QC Overlays


### Flow Diagram




~~~{=html}
<pre class="notion-ascii-diagram"><code>[Placeholder - Stage disabled]
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
[Placeholder - Stage disabled]

\end{Verbatim}
~~~




---


# Appendix A: Hardware Profiles


## Profile: rtx6000_1gpu



<table>
  <thead>
    <tr>
      <th>Resource</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GPUs</td>
      <td>1</td>
    </tr>
    <tr>
      <td>CPU Cores</td>
      <td>24</td>
    </tr>
    <tr>
      <td>GPU Memory</td>
      <td>96 GiB</td>
    </tr>
    <tr>
      <td>cpu_workers_light</td>
      <td>8</td>
    </tr>
    <tr>
      <td>cpu_workers_heavy</td>
      <td>11</td>
    </tr>
    <tr>
      <td>gpu_workers</td>
      <td>4</td>
    </tr>
    <tr>
      <td>batch_size</td>
      <td>8</td>
    </tr>
  </tbody>
</table>



## Profile: dgx_b200_8gpu



<table>
  <thead>
    <tr>
      <th>Resource</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GPUs</td>
      <td>1 (per container)</td>
    </tr>
    <tr>
      <td>CPU Cores</td>
      <td>48 (per container)</td>
    </tr>
    <tr>
      <td>GPU Memory</td>
      <td>192 GiB</td>
    </tr>
    <tr>
      <td>cpu_workers_light</td>
      <td>16</td>
    </tr>
    <tr>
      <td>cpu_workers_heavy</td>
      <td>46</td>
    </tr>
    <tr>
      <td>gpu_workers</td>
      <td>8</td>
    </tr>
    <tr>
      <td>batch_size</td>
      <td>16</td>
    </tr>
  </tbody>
</table>



---


# Appendix B: Contract System


### Data Flow (Golden Rule)




~~~{=html}
<pre class="notion-ascii-diagram"><code>resources.yaml          contract.py              core.py
      │                      │                      │
      │  (param values)      │  (input/output defs) │
      └──────────────────────┴──────────────────────┘
                             │
                             ▼
                ┌────────────────────────┐
                │     CONTRACT JSON      │
                │  ─────────────────────  │
                │  doc_id: &quot;paper_001&quot;   │
                │  inputs: {paths...}    │
                │  outputs: {paths...}   │
                │  params: {values...}   │
                └────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
resources.yaml          contract.py              core.py
      │                      │                      │
      │  (param values)      │  (input/output defs) │
      └──────────────────────┴──────────────────────┘
                             │
                             ▼
                ┌────────────────────────┐
                │     CONTRACT JSON      │
                │  ─────────────────────  │
                │  doc_id: "paper_001"   │
                │  inputs: \textbraceleft{\textbraceright{}paths...\textbraceright{}    │
                │  outputs: \textbraceleft{\textbraceright{}paths...\textbraceright{}   │
                │  params: \textbraceleft{\textbraceright{}values...\textbraceright{}   │
                └────────────────────────┘

\end{Verbatim}
~~~




### Cardinal Rules

- ❌ NEVER import `lib/config.py` directly in stage scripts
- ❌ NEVER read `resources.yaml` directly in stage scripts
- ✅ ALL params from `contract["params"]`
- ✅ ALL paths from `contract["inputs"]` / `contract["outputs"]`

---


# Appendix C: GPU Stage Pattern


### Why Dispatch/Worker?




~~~{=html}
<pre class="notion-ascii-diagram"><code>WITHOUT dispatch/worker:
  Doc 1: [====Load Model 45s====][Process 10s]
  Doc 2: [====Load Model 45s====][Process 10s]
  Doc 3: [====Load Model 45s====][Process 10s]
  Total: 165 seconds

WITH dispatch/worker:
  Worker startup: [====Load Model 45s====]
  Doc 1: [Process 10s]
  Doc 2: [Process 10s]
  Doc 3: [Process 10s]
  Total: 75 seconds
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
WITHOUT dispatch/worker:
  Doc 1: [====Load Model 45s====][Process 10s]
  Doc 2: [====Load Model 45s====][Process 10s]
  Doc 3: [====Load Model 45s====][Process 10s]
  Total: 165 seconds

WITH dispatch/worker:
  Worker startup: [====Load Model 45s====]
  Doc 1: [Process 10s]
  Doc 2: [Process 10s]
  Doc 3: [Process 10s]
  Total: 75 seconds

\end{Verbatim}
~~~




### Critical Matching Requirements




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────┐
│  resources.yaml                                             │
│  ─────────────────                                          │
│  pipelines:                                                 │
│    GX_YY:                                                   │
│      job_queue: &quot;gx_yy_jobs&quot;  ◄───┐                         │
│      sentinel_suffix: &quot;.done&quot;     │                         │
└───────────────────────────────────│─────────────────────────┘
                                    │
                                    │ MUST MATCH
                                    │
┌───────────────────────────────────│─────────────────────────┐
│  GX_YY_worker.py                  │                         │
│  ───────────────────              │                         │
│  WORKER_NAME = &quot;gx_yy-worker&quot; ◄───│───┐                     │
│  JOB_QUEUE = &quot;gx_yy_jobs&quot;  ◄──────┘   │                     │
└───────────────────────────────────────│─────────────────────┘
                                        │
                                        │ MUST MATCH
                                        │
┌───────────────────────────────────────│─────────────────────┐
│  docker-compose.yaml                  │                     │
│  ───────────────────                  │                     │
│  gx-yy-worker:                        │                     │
│    container_name: gx_yy-worker  ◄────┘                     │
│    entrypoint: [&quot;python3&quot;, &quot;GX_YY_worker.py&quot;]               │
└─────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────┐
│  resources.yaml                                             │
│  ─────────────────                                          │
│  pipelines:                                                 │
│    GX_YY:                                                   │
│      job_queue: "gx_yy_jobs"  ◄───┐                         │
│      sentinel_suffix: ".done"     │                         │
└───────────────────────────────────│─────────────────────────┘
                                    │
                                    │ MUST MATCH
                                    │
┌───────────────────────────────────│─────────────────────────┐
│  GX_YY_worker.py                  │                         │
│  ───────────────────              │                         │
│  WORKER_NAME = "gx_yy-worker" ◄───│───┐                     │
│  JOB_QUEUE = "gx_yy_jobs"  ◄──────┘   │                     │
└───────────────────────────────────────│─────────────────────┘
                                        │
                                        │ MUST MATCH
                                        │
┌───────────────────────────────────────│─────────────────────┐
│  docker-compose.yaml                  │                     │
│  ───────────────────                  │                     │
│  gx-yy-worker:                        │                     │
│    container_name: gx_yy-worker  ◄────┘                     │
│    entrypoint: ["python3", "GX_YY_worker.py"]               │
└─────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




---


# Appendix D: Stage Dependencies




~~~{=html}
<pre class="notion-ascii-diagram"><code>                              ┌─────────┐
                              │  G0_00  │
                              │  Orch   │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G1_01  │
                              │PDF→PNG  │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G1_02  │
                              │Orient.  │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G1_03  │
                              │Rotation │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G1_04  │
                              │ Route   │
                              └────┬────┘
                                   │
              ┌────────────────────┼────────────────────┐
              │                    │                    │
         ┌────▼────┐          ┌────▼────┐         ┌────▼────┐
         │  G2_05  │          │  G3_10  │         │  G3_11  │
         │  OCR    │          │ Marker  │         │ Docling │
         └────┬────┘          └────┬────┘         └────┬────┘
              │                    │                    │
         ┌────▼────┐               │                    │
         │G2_06-09 │               │                    │
         │ Tokens  │               │                    │
         └────┬────┘               │                    │
              │                    │                    │
              └────────────────────┼────────────────────┘
                                   │
                              ┌────▼────┐
                              │  G4_12  │
                              │ GROBID  │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G4_13  │
                              │MetaNorm │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G5_14  │
                              │ Align   │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G5_15  │
                              │Unmapped │
                              └─────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
                              ┌─────────┐
                              │  G0_00  │
                              │  Orch   │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G1_01  │
                              │PDF→PNG  │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G1_02  │
                              │Orient.  │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G1_03  │
                              │Rotation │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G1_04  │
                              │ Route   │
                              └────┬────┘
                                   │
              ┌────────────────────┼────────────────────┐
              │                    │                    │
         ┌────▼────┐          ┌────▼────┐         ┌────▼────┐
         │  G2_05  │          │  G3_10  │         │  G3_11  │
         │  OCR    │          │ Marker  │         │ Docling │
         └────┬────┘          └────┬────┘         └────┬────┘
              │                    │                    │
         ┌────▼────┐               │                    │
         │G2_06-09 │               │                    │
         │ Tokens  │               │                    │
         └────┬────┘               │                    │
              │                    │                    │
              └────────────────────┼────────────────────┘
                                   │
                              ┌────▼────┐
                              │  G4_12  │
                              │ GROBID  │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G4_13  │
                              │MetaNorm │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G5_14  │
                              │ Align   │
                              └────┬────┘
                                   │
                              ┌────▼────┐
                              │  G5_15  │
                              │Unmapped │
                              └─────────┘

\end{Verbatim}
~~~




---


END OF SKELETON






