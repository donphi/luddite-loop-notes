# Token ID: Tiered Architecture & Tagging


## Content


## 1. Objective and Scope


Following the initial identifier refactoring (compact L*/W*/T*/F* prefixes), this work addressed a more fundamental architectural question:







❓ How do we durably associate semantic information with tokens without carrying geometry through the entire pipeline?







The answer required extending the identification schema to encompass seven tiers of document structure, from page-level containers down to individual word tokens. This document describes the complete identifier architecture, its collision-avoidance guarantees, and the strategic decision to use token tagging as the primary substrate for downstream filtering.







Problem statement: PDF processing pipelines typically produce geometric bounding boxes from multiple models (OCR, layout detection, table recognition). These boxes serve debugging and alignment purposes, but carrying them downstream creates:


1. **Storage overhead:** Thousands of coordinate arrays per document
2. **Model coupling:** Downstream stages depend on specific detector outputs
3. **Brittleness:** Geometry changes when models are updated or retrained

Solution: Assign deterministic identifiers at every level of document structure, then tag tokens with these identifiers. Downstream stages filter by ID prefix rather than geometric containment.







---


## 2. Methods and Process


### 2.1 Tiered Identifier Design


The schema organises all document entities into seven tiers, from largest to smallest:




<table>
  <thead>
    <tr>
      <th><strong>Tier</strong></th>
      <th><strong>Level</strong></th>
      <th><strong>Entities Examples</strong></th>
      <th><strong>Prefix Pattern Examples</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Document &amp; Page</td>
      <td>Document ID, Page renders</td>
      <td><code>doc_id</code>, <code>page_N.png</code></td>
    </tr>
    <tr>
      <td>2</td>
      <td>Document Structure</td>
      <td>Title, Abstract, Authors, References</td>
      <td><code>TI</code>, <code>AB</code>, <code>AU*</code>, <code>B*</code></td>
    </tr>
    <tr>
      <td>3A</td>
      <td>Layout Blocks (PP)</td>
      <td>Text regions, Figures, Tables</td>
      <td><code>PP_TXT*</code>, <code>PP_FIG*</code></td>
    </tr>
    <tr>
      <td>3B</td>
      <td>Layout Blocks (Surya)</td>
      <td>Section headers, Captions, Pictures</td>
      <td><code>SL_SH*</code>, <code>SL_CAP*</code></td>
    </tr>
    <tr>
      <td>4</td>
      <td>Table Structure</td>
      <td>Tables, Cells, Row Headers</td>
      <td><code>T*</code>, <code>T*_R*C*</code>, <code>T*_RH*</code></td>
    </tr>
    <tr>
      <td>5</td>
      <td>Formulas</td>
      <td>Inline and display formulas</td>
      <td><code>F*</code></td>
    </tr>
    <tr>
      <td>6</td>
      <td>Token Level</td>
      <td>Lines, Words</td>
      <td><code>L*</code>, <code>W*</code></td>
    </tr>
  </tbody>
</table>



### 2.2 Collision Avoidance Strategy


A critical design requirement: no prefix may be reused across tiers. This enables O(1) type discrimination and prevents ambiguity when tokens are tagged with multiple identifiers.




<table>
  <thead>
    <tr>
      <th><strong>Priority</strong></th>
      <th><strong>Reserved Prefix</strong></th>
      <th><strong>Tier</strong></th>
      <th><strong>Entity</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>⭐⭐⭐⭐⭐</td>
      <td><code>L*</code></td>
      <td>6</td>
      <td>Line tokens only</td>
    </tr>
    <tr>
      <td>⭐⭐⭐⭐</td>
      <td><code>W*</code></td>
      <td>6</td>
      <td>Word tokens only</td>
    </tr>
    <tr>
      <td>⭐⭐⭐</td>
      <td><code>T*</code></td>
      <td>4</td>
      <td>TATR table structures only</td>
    </tr>
    <tr>
      <td>⭐</td>
      <td><code>F*</code></td>
      <td>5</td>
      <td>Formula OCR outputs only</td>
    </tr>
    <tr>
      <td>⭐⭐⭐⭐</td>
      <td><code>PP_*</code></td>
      <td>3A</td>
      <td>PP-Structure layout blocks</td>
    </tr>
    <tr>
      <td>⭐</td>
      <td><code>SL_*</code></td>
      <td>3B</td>
      <td>Surya layout blocks</td>
    </tr>
  </tbody>
</table>



Collision example avoided: Surya's layout detector outputs both "Table" and "Formula" labels. Without collision avoidance, these would generate T* and F* identifiers, conflicting with TATR tables and formula OCR. The schema uses SL_TAB* and SL_FML* instead, preserving namespace separation.



### 2.3 Deterministic Ordering


All identifiers must be assigned from stable sort keys, never from model iteration order. This ensures:


- **Reproducibility:** Same PDF → same identifiers across pipeline runs
- **Diffability:** Changes between runs indicate genuine extraction differences
- **Scalability:** Consistent behaviour across thousands of documents

Sort keys used:


- **Tokens:** Document-global counter based on page order, then reading order
- **Layout blocks:** Page number, then normalised centroid position (top-to-bottom, left-to-right)
- **Table cells:** Row index, then column index





---


## 3. Key Technical Outcomes


### 3.1 Architecture Overview


The final pipeline stage produces tokens tagged with all relevant identifiers:





~~~{=html}
<pre class="notion-ascii-diagram"><code><strong>Line token L42:</strong>
  - In layout region: PP_TXT3_5
  - In Surya block: SL_TXT3_2
  - Artifact label: (none)
  - In table: (none)

<strong>Line token L98:</strong>
  - In layout region: PP_HD4_0
  - In Surya block: SL_PHD4_0
  - Artifact label: &quot;header&quot;
  - In table: (none)

<strong>Word token W500:</strong>
  - In line: L150
  - In layout region: PP_T6_0
  - In Surya block: SL_TAB6_0
  - In table cell: T1_R3C2
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
\textbf{Line token L42:}
  - In layout region: PP_TXT3_5
  - In Surya block: SL_TXT3_2
  - Artifact label: (none)
  - In table: (none)

\textbf{Line token L98:}
  - In layout region: PP_HD4_0
  - In Surya block: SL_PHD4_0
  - Artifact label: "header"
  - In table: (none)

\textbf{Word token W500:}
  - In line: L150
  - In layout region: PP_T6_0
  - In Surya block: SL_TAB6_0
  - In table cell: T1_R3C2

\end{Verbatim}
~~~




### 3.2 Three Tagging Substrates



<table>
  <thead>
    <tr>
      <th><strong>Substrate</strong></th>
      <th><strong>Purpose</strong></th>
      <th><strong>Join Key</strong></th>
      <th><strong>Content</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>artifact_map.jsonl</code></td>
      <td>Drop-off zone filtering</td>
      <td><code>token_id (L*)</code></td>
      <td><code>[&quot;header&quot;, &quot;footer&quot;, &quot;page_number&quot;]</code></td>
    </tr>
    <tr>
      <td><code>surya_layout_token_tags.jsonl</code></td>
      <td>Surya layout associations</td>
      <td><code>token_id (L*/W*)</code></td>
      <td><code>[&quot;SL_TXT3_5&quot;, &quot;SL_SH2_0&quot;]</code></td>
    </tr>
    <tr>
      <td><code>pp_token_tags.jsonl</code></td>
      <td>PP-Structure associations</td>
      <td><code>token_id (L*/W*)</code></td>
      <td><code>[&quot;PP_TXT3_5&quot;, &quot;PP_FIG4_0&quot;]</code></td>
    </tr>
  </tbody>
</table>



### 3.3 Benefits of Tag-Based Filtering


Before (geometry-dependent):





~~~{=html}
<pre class="notion-ascii-diagram"><code>#!/usr/bin/env python3

<strong># Filter tokens in header regions
</strong>for token in tokens:
    for region in header_regions:
        if bbox_contains(region.bbox, token.bbox):
            exclude(token)</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
#!/usr/bin/env python3

\textbf{# Filter tokens in header regions
}for token in tokens:
    for region in header_regions:
        if bbox_contains(region.bbox, token.bbox):
            exclude(token)
\end{Verbatim}
~~~




After (tag-based):





~~~{=html}
<pre class="notion-ascii-diagram"><code>#!/usr/bin/env python3

<strong># Filter tokens with header artifact label</strong>
for token in tokens:
    if &quot;header&quot; in token.artifact_labels:
        exclude(token)
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
#!/usr/bin/env python3

\textbf{# Filter tokens with header artifact label}
for token in tokens:
    if "header" in token.artifact_labels:
        exclude(token)

\end{Verbatim}
~~~




The tag-based approach:


1. **Eliminates geometry dependencies:** No bounding box computations downstream
2. **Enables simple SQL queries:** `WHERE 'header' = ANY(labels)`
3. **Reduces storage:** Token IDs are 3–10 characters vs 16+ bytes per coordinate
4. **Decouples models:** Surya layout blocks and PP-Structure regions coexist as independent tagging layers

---


## 4. Technical Scope and Structure 


### 4.0 Scope & Ordering Rules


Scope definitions


- **document-scoped**: unique within one `doc_id`
- **page-scoped**: unique within a document (because `page_num` is embedded), but indices reset per page
- **page-local**: unique only within a page (rare; avoid unless `page_num` is guaranteed elsewhere)
- 

Deterministic ordering



All {idx} values derive from a stable sort key (e.g., reading order, geometric position), never from model iteration order.







---


### 4.1 Tier 1 — Document & Page Anchors



<table>
  <thead>
    <tr>
      <th>Entity</th>
      <th>Format</th>
      <th>Example</th>
      <th>Scope</th>
      <th>Producer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Document ID</td>
      <td><code>{doc_id}</code></td>
      <td><code>101002alz...</code></td>
      <td>—</td>
      <td>orchestrator</td>
    </tr>
    <tr>
      <td>Page image</td>
      <td><code>page_{page_num}.png</code></td>
      <td><code>page_3.png</code></td>
      <td>document</td>
      <td>G1_00</td>
    </tr>
    <tr>
      <td>Page number</td>
      <td><code>page_num</code> (int)</td>
      <td><code>3</code></td>
      <td>document</td>
      <td>multiple</td>
    </tr>
  </tbody>
</table>



---


### 4.2 Tier 2 — Document Structure (GROBID)



<table>
  <thead>
    <tr>
      <th>Prefix</th>
      <th>Entity</th>
      <th>Format</th>
      <th>Example</th>
      <th>Scope</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>TI</code></td>
      <td>Document title</td>
      <td><code>TI</code></td>
      <td><code>TI</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>AB</code></td>
      <td>Abstract</td>
      <td><code>AB</code></td>
      <td><code>AB</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>AU</code></td>
      <td>Author</td>
      <td><code>AU{idx}</code></td>
      <td><code>AU3</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>AF</code></td>
      <td>Affiliation</td>
      <td><code>AF{idx}</code></td>
      <td><code>AF2</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>KW</code></td>
      <td>Keyword</td>
      <td><code>KW{idx}</code></td>
      <td><code>KW5</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>SH</code></td>
      <td>Section header</td>
      <td><code>SH{idx}</code></td>
      <td><code>SH3</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>ACK</code></td>
      <td>Acknowledgements</td>
      <td><code>ACK</code></td>
      <td><code>ACK</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>B</code></td>
      <td>Bibliography entry</td>
      <td><code>B{idx}</code></td>
      <td><code>B23</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>CM</code></td>
      <td>Citation marker</td>
      <td><code>CM{idx}</code></td>
      <td><code>CM5</code></td>
      <td>document</td>
    </tr>
  </tbody>
</table>



Producer: G4_02







---


### 4.3 Tier 3A — Layout Blocks (PP-Structure)



<table>
  <thead>
    <tr>
      <th>Prefix</th>
      <th>Entity</th>
      <th>Format</th>
      <th>Example</th>
      <th>Scope</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>PP_TI</code></td>
      <td>Document title</td>
      <td><code>PP_TI{page}</code></td>
      <td><code>PP_TI1</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>PP_AB</code></td>
      <td>Abstract</td>
      <td><code>PP_AB{page}</code></td>
      <td><code>PP_AB1</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>PP_PT</code></td>
      <td>Paragraph title</td>
      <td><code>PP_PT{page}_{idx}</code></td>
      <td><code>PP_PT2_3</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_TXT</code></td>
      <td>Text block</td>
      <td><code>PP_TXT{page}_{idx}</code></td>
      <td><code>PP_TXT3_5</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_NUM</code></td>
      <td>Page number</td>
      <td><code>PP_NUM{page}</code></td>
      <td><code>PP_NUM3</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_IMG</code></td>
      <td>Image</td>
      <td><code>PP_IMG{page}_{idx}</code></td>
      <td><code>PP_IMG4_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_FIG</code></td>
      <td>Figure</td>
      <td><code>PP_FIG{page}_{idx}</code></td>
      <td><code>PP_FIG4_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_FIGCAP</code></td>
      <td>Figure caption</td>
      <td><code>PP_FIGCAP{page}_{idx}</code></td>
      <td><code>PP_FIGCAP4_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_T</code></td>
      <td>Table</td>
      <td><code>PP_T{page}_{idx}</code></td>
      <td><code>PP_T5_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_TCAP</code></td>
      <td>Table caption</td>
      <td><code>PP_TCAP{page}_{idx}</code></td>
      <td><code>PP_TCAP5_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_FTCT</code></td>
      <td>Fig/Table/Chart title</td>
      <td><code>PP_FTCT{page}_{idx}</code></td>
      <td><code>PP_FTCT4_1</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_F</code></td>
      <td>Formula</td>
      <td><code>PP_F{page}_{idx}</code></td>
      <td><code>PP_F3_2</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_ALG</code></td>
      <td>Algorithm</td>
      <td><code>PP_ALG{page}_{idx}</code></td>
      <td><code>PP_ALG6_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_TOC</code></td>
      <td>Table of contents</td>
      <td><code>PP_TOC{page}_{idx}</code></td>
      <td><code>PP_TOC1_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_REF</code></td>
      <td>Reference block</td>
      <td><code>PP_REF{page}_{idx}</code></td>
      <td><code>PP_REF12_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_REFC</code></td>
      <td>Reference content</td>
      <td><code>PP_REFC{page}_{idx}</code></td>
      <td><code>PP_REFC12_5</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_HD</code></td>
      <td>Header</td>
      <td><code>PP_HD{page}</code></td>
      <td><code>PP_HD3</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_FT</code></td>
      <td>Footer</td>
      <td><code>PP_FT{page}</code></td>
      <td><code>PP_FT3</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_FN</code></td>
      <td>Footnote</td>
      <td><code>PP_FN{page}_{idx}</code></td>
      <td><code>PP_FN7_1</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_SEAL</code></td>
      <td>Seal</td>
      <td><code>PP_SEAL{page}_{idx}</code></td>
      <td><code>PP_SEAL1_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>PP_UNK</code></td>
      <td>Unknown</td>
      <td><code>PP_UNK_{idx}</code></td>
      <td><code>PP_UNK_5</code></td>
      <td>page</td>
    </tr>
  </tbody>
</table>



Producer: G6_02







---


### 4.4 Tier 3B — Layout Blocks (Surya)


### 4.4.1 Block types



<table>
  <thead>
    <tr>
      <th>Prefix</th>
      <th>Entity</th>
      <th>Format</th>
      <th>Example</th>
      <th>Scope</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>SL_SH</code></td>
      <td>Section header</td>
      <td><code>SL_SH{page}_{idx}</code></td>
      <td><code>SL_SH2_3</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_TXT</code></td>
      <td>Text</td>
      <td><code>SL_TXT{page}_{idx}</code></td>
      <td><code>SL_TXT3_5</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_LI</code></td>
      <td>List item</td>
      <td><code>SL_LI{page}_{idx}</code></td>
      <td><code>SL_LI2_4</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_IM</code></td>
      <td>Inline math</td>
      <td><code>SL_IM{page}_{idx}</code></td>
      <td><code>SL_IM3_2</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_FIG</code></td>
      <td>Figure</td>
      <td><code>SL_FIG{page}_{idx}</code></td>
      <td><code>SL_FIG4_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_PIC</code></td>
      <td>Picture</td>
      <td><code>SL_PIC{page}_{idx}</code></td>
      <td><code>SL_PIC4_1</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_CAP</code></td>
      <td>Caption</td>
      <td><code>SL_CAP{page}_{idx}</code></td>
      <td><code>SL_CAP3_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_FORM</code></td>
      <td>Form</td>
      <td><code>SL_FORM{page}_{idx}</code></td>
      <td><code>SL_FORM1_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_TOC</code></td>
      <td>Table of contents</td>
      <td><code>SL_TOC{page}_{idx}</code></td>
      <td><code>SL_TOC1_0</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_PHD</code></td>
      <td>Page header</td>
      <td><code>SL_PHD{page}</code></td>
      <td><code>SL_PHD3</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_PFT</code></td>
      <td>Page footer</td>
      <td><code>SL_PFT{page}</code></td>
      <td><code>SL_PFT3</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_FN</code></td>
      <td>Footnote</td>
      <td><code>SL_FN{page}_{idx}</code></td>
      <td><code>SL_FN5_2</code></td>
      <td>page</td>
    </tr>
    <tr>
      <td><code>SL_HW</code></td>
      <td>Handwriting</td>
      <td><code>SL_HW{page}_{idx}</code></td>
      <td><code>SL_HW6_0</code></td>
      <td>page</td>
    </tr>
  </tbody>
</table>



Producer: G2_08



### 4.4.2 Artifact labels


Line-level artifact annotations are stored as structured labels rather than prefixed IDs:









~~~{=html}
<pre class="notion-ascii-diagram"><code>{&quot;line_index&quot;: 2, &quot;labels&quot;: [&quot;header&quot;]}</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
\textbraceleft{\textbraceright{}"line_index": 2, "labels": ["header"]\textbraceright{}
\end{Verbatim}
~~~




---


### 4.5 Tier 4 — Table Structure (TATR)



<table>
  <thead>
    <tr>
      <th>Prefix</th>
      <th>Entity</th>
      <th>Format</th>
      <th>Example</th>
      <th>Scope</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>T</code></td>
      <td>Table</td>
      <td><code>T{counter}</code></td>
      <td><code>T1</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>TE</code></td>
      <td>Table (debug)</td>
      <td><code>TE{counter}</code></td>
      <td><code>TE1</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>TCell</code></td>
      <td>Cell</td>
      <td><code>T{t}_R{r}C{c}</code></td>
      <td><code>T1_R0C0</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>TH</code></td>
      <td>Column header</td>
      <td><code>header_idx: {idx}</code></td>
      <td><code>header_idx: 0</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>TRH</code></td>
      <td>Projected row header</td>
      <td><code>T{t}_RH{idx}</code></td>
      <td><code>T1_RH0</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>TSC</code></td>
      <td>Spanning cell</td>
      <td><code>T{t}_SC{idx}</code></td>
      <td><code>T2_SC0</code></td>
      <td>document</td>
    </tr>
    <tr>
      <td><code>TCAP</code></td>
      <td>Table caption</td>
      <td><code>PP_TCAP{page}_{idx}</code></td>
      <td><code>PP_TCAP6_0</code></td>
      <td>document</td>
    </tr>
  </tbody>
</table>



Producer: G5_01







---


### 4.6 Tier 5 — Formulas



<table>
  <thead>
    <tr>
      <th>Prefix</th>
      <th>Entity</th>
      <th>Format</th>
      <th>Example</th>
      <th>Scope</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>F</code></td>
      <td>Formula</td>
      <td><code>F{counter}</code></td>
      <td><code>F73</code></td>
      <td>document</td>
    </tr>
  </tbody>
</table>



Includes both inline and display math. Counter increments across pages.



Producer: G2_00







---


### 4.7 Tier 6 — Token Level (Surya Spine)



<table>
  <thead>
    <tr>
      <th>Prefix</th>
      <th>Entity</th>
      <th>Format</th>
      <th>Example</th>
      <th>Stored in</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>L</code></td>
      <td>Line token</td>
      <td><code>L{counter}</code></td>
      <td><code>L456</code></td>
      <td><code>spine/*/line_tokens.jsonl</code></td>
    </tr>
    <tr>
      <td><code>W</code></td>
      <td>Word token</td>
      <td><code>W{counter}</code></td>
      <td><code>W2345</code></td>
      <td><code>spine/*/word_tokens.jsonl</code></td>
    </tr>
    <tr>
      <td>—</td>
      <td>Canonical line identity</td>
      <td><code>{page_num}_{line_index}</code></td>
      <td><code>3_12</code></td>
      <td><code>spine/*/line_tokens.jsonl</code></td>
    </tr>
  </tbody>
</table>



Producer: G2_01 (lines), G2_02 (words)







---


### 4.8 Reading Order


Reading order is not assigned explicit identifiers. It is represented as ordered line_index lists per page, with the line spine (Tier 6) serving as the join substrate.







---


## 5. Critical Reflection


### 5.1 Strengths


The tiered architecture achieves three design goals simultaneously:


1. **Determinism:** Identical PDFs produce identical identifier sets across runs
2. **Collision-proofing:** Prefix namespaces prevent cross-tier ambiguity
3. **Geometry independence:** Downstream filtering operates on tags, not coordinates





### 5.2 Path to Scaffold Simplification


The tagging architecture enables a future simplification:



Current state: scaffold.json contains bounding boxes for all regions, tables, and cells, very useful for debugging but heavyweight for production.



Future state: scaffold_cleaned.json retains only:


- Token IDs (`L*`, `W*`)
- Token tags (region associations, artifact labels)
- Reading order (line index sequences)

All geometric data can be regenerated from source if needed, but production downstream stages require only the tagged tokens.







### 5.3 Human-in-the-Loop Verification


The expanded prefix system maintains the readability principles established in the initial refactoring:


- **Visual distinguishability:** `SL_PHD3_0` (page header) vs `SL_SH3_0` (section header)
- **Semantic encoding:** Prefix communicates type without metadata lookup
- **Debugging efficiency:** Filter by prefix in logs, queries, or visual inspection





---


## 6. Next Steps

1. **Regenerate layout outputs:** Execute G2_00 to propagate corrected SL_* prefix mappings
2. **Validate artifact labels:** Confirm G2_07 correctly tags headers/footers using new SL_PHD/SL_PFT identifiers
3. **Implement scaffold cleaning:** Create G7_03 stage to produce geometry-free `scaffold_cleaned.json`
4. **Document tagging substrate joins:** Publish data dictionary for all token tag files
