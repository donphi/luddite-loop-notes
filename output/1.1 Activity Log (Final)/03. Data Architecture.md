# Data Architecture


## Content


# UK Biobank Data Architecture Diagram


Complete Schema Relationships and Data Flow



---


## 1. Source File Relationships (UK Biobank Showcase)


The UK Biobank Showcase provides 11 interconnected data files. This diagram shows how they relate via foreign keys.





~~~{=html}
<pre class="notion-ascii-diagram"><code>╔═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                UK BIOBANK SHOWCASE RAW DATA SCHEMA                                            ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                               ║
║  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                                         <strong>FIELD.TXT (10,489 rows) </strong>                                        │  ║
║  │                                         ═══════════════════════                                         │  ║
║  │  <strong>Primary Key:</strong> field_id                                                                                  │  ║
║  │                                                                                                         │  ║
║  │  ┌─────────────┬────────────────────────────────────┬───────────┬─────────────┲━━━━━━━━━━━━━━━━━━━━┓    │  ║
║  │  │  <strong>field_id   │  title                             │  units    │ main_cat.   ┃  encoding_id   </strong>    ┃    │  ║
║  │  ├─────────────┼────────────────────────────────────┼───────────┼─────────────╂────────────────────┨    │  ║
║  │  │  21001      │  &quot;Body mass index (BMI)&quot;           │  kg/m²    │  100010     ┃  0 (not encoded)   ┃    │  ║
║  │  │  4080       │  &quot;Systolic blood pressure...&quot;      │  mmHg     │  100011     ┃  0                 ┃    │  ║
║  │  │  20002      │  &quot;Non-cancer illness code...&quot;      │  -        │  100074     ┃  6                 ┃    │  ║
║  │  │  40001      │  &quot;Underlying (primary) cause...&quot;   │  -        │  2000       ┃  19                ┃    │  ║
║  │  │  ...        │  ...                               │  ...      │  ...        ┃  ...               ┃    │  ║
║  │  └─────────────┴────────────────────────────────────┴───────────┴──────┬──────┺━━━━━━━━━━━━━━┳━━━━━┛    │  ║
║  │                                                                        │                     ┃          │  ║
║  └────────────────────────────────────────────────────────────────────────┼─────────────────────╂──────────┘  ║
║                                                                           │                     ┃             ║
║                                  ┌────────────────────────────────────────┘                     ┃             ║
║                                  │                                                              ┃             ║
║                                  ▼                                                              ┃             ║
║  ┌───────────────────────────────────────────────────────────────────┐                          ┃             ║
║  │                    <strong>CATEGORY.TXT (381 rows)</strong>                        │                          ┃             ║
║  │                    ═══════════════════════                        │                          ┃             ║
║  │  <strong>Primary Key:</strong> category_id                                         │                          ┃             ║
║  │                                                                   │                          ┃             ║
║  │  ┌──────────────┬─────────────────────────────────────┬─────────┐ │                          ┃             ║
║  │  │<strong> category_id  │  title                              │ notes </strong>  │ │                          ┃             ║
║  │  ├──────────────┼─────────────────────────────────────┼─────────┤ │                          ┃             ║ 
║  │  │  100010      │  &quot;Body size measures&quot;               │  ...    │ │                          ┗━━━━━━┓      ║
║  │  │  100011      │  &quot;Blood pressure&quot;                   │  ...    │ │                                 ┃      ║
║  │  │  100074      │  &quot;Medical conditions&quot;               │  ...    │ │                                 ┃      ║
║  │  │  2000        │  &quot;Hospital inpatient&quot;               │  ...    │ │                                 ┃      ║
║  │  │  ...         │  ...                                │  ...    │ │                                 ┃      ║
║  │  └──────────────┴─────────────────────────────────────┴─────────┘ │                                 ┃      ║
║  └───────────────────────────────────────────────────────────────────┘                                 ┃      ║
║                                                                                                        ┃      ║
║                                                                                                        ┃      ║
║                                                                                                        ┃      ║
║                                                                                                        ┃      ║
║  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐       ┃      ║
║  │                                   <strong> ENCODING.TXT (847 rows) </strong>                                 │       ┃      ║
║  │                                   ════════════════════════                                  │       ┃      ║
║  │  <strong>Primary Key:</strong> encoding_id                                                                   │       ┃      ║
║  │                                                                                             │       ┃      ║
║  │  ┏━━━━━━━━━━━━━━┱────────────────────────────────────────┬────────────┬──────────────┐      │       ┃      ║
║  │  ┃ <strong>encoding_id  ┃  title                                 │ structure  │ num_members </strong> │      │       ┃      ║
║  │  ┠──────────────╂────────────────────────────────────────┼────────────┼──────────────┤      │       ┃      ║
║  │  ┃  0           ┃  &quot;NOT-ENCODED&quot;                         │  -         │  -           │      │       ┃      ║
║  │  ┃  6           ┃  &quot;Non-cancer Illness&quot;                  │  simple    │  474         │      │       ┃      ║
║  │  ┃  19          ┃  &quot;ICD10&quot;                               │  hierarchy │  19,190      │      │       ┃      ║
║  │  ┃  3           ┃  &quot;Cancer&quot;                              │  simple    │  89          │      │       ┃      ║
║  │  ┃  4           ┃  &quot;Treatments&quot;                          │  simple    │  6,745       │      │       ┃      ║
║  │  ┃       ...    ┃        ...                             │    ...     │     ...      │      │       ┃      ║
║  │  ┗━━━━━━━┳━━━━━━┹────────────────────────────────────────┴────────────┴──────────────┘      │       ┃      ║
║  │          ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┿━━━━━━━┫      ║
║  └─────────────────────────────────────────────────────────────────────────────────────────────┘       ┃      ║
║                                                                                                        ┃      ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                        <strong>   DICTIONARY TABLES   </strong>                                         ┃      ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                        ┃      ║
║      <strong> SIMPLE ENCODINGS (flat lookup tables)                    HIERARCHICAL ENCODINGS (tree) </strong>          ┃      ║
║       ════════════════════════════════════                     ══════════════════════════════          ┗━━┓   ║
║                                                                                                           ┃   ║
║  ┌─────────────────────────────────────────────┐    ┌──────────────────────────────────────────────────┐  ┃   ║
║  │      <strong>   ESIMPSTRING.TXT (439,346 rows)      │    │          EHIERSTRING.TXT (46,928 rows)  </strong>         │  ┃   ║
║  │        ═══════════════════════════════      │    │          ═════════════════════════════           │  ┃   ║  
║  │  <strong>Foreign Key:</strong> encoding_id                   │    │  <strong>Foreign Key:</strong> encoding_id                        │  ┃   ║  
║  │                                             │    │                                                  │  ┃   ║  
║  │  ┏━━━━━━━━━━━━┱────────┬──────────────────┐ │    │  ┏━━━━━━━━━━━━━┱────────┬─────────┬───────────┐  │  ┃   ║  
║  │  ┃<strong>encoding_id ┃ coding │ meaning  </strong>        │ │    │  ┃ <strong>encoding_id ┃ coding │ meaning │ parent_id</strong> │  │  ┃   ║
║  │  ┠────────────╂────────┼──────────────────┤ │    │  ┠─────────────╂────────┼─────────┼───────────┤  │  ┃   ║
║  │  ┃ 6          ┃ 1065   │ &quot;Hypertension&quot;   │ │    │  ┃             ┃        │         │           │  │  ┃   ║
║  │  ┃ 6          ┃ 1473   │ &quot;Type 2 diabetes&quot;│ │    │  ┃ 19          ┃ I10    │ &quot;Ess.   │ NULL      │  │  ┃   ║
║  │  ┃ 3          ┃ 1002   │ &quot;Breast cancer&quot;  │ │    │  ┃             ┃        │  hyper.&quot;│           │  │  ┃   ║
║  │  ┃ 4          ┃ 1140   │ &quot;Metformin&quot;      │ │    │  ┃             ┃        │         │           │  │  ┃   ║
║  │  ┃ ...        ┃ ...    │ ...              │ │    │  ┃ 19          ┃ I25.1  │ &quot;Athero.│ I25       │  │  ┃   ║
║  │  ┗━━━━━━┳━━━━━┹────────┴──────────────────┘ │    │  ┃             ┃        │  heart&quot; │           │  │  ┃   ║ 
║  └─────────╂───────────────────────────────────┘    │  ┃ ...         ┃   ...  │   ...   │   ...     │  │  ┃   ║
║            ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │  ┗━━━━━━━┳━━━━━┹────────┴─────────┴───────────┘  │  ┃   ║
║  ┌─────────────────────────────────────────────┐  ┃ └──────────╂───────────────────────────────────────┘  ┃   ║
║  │          <strong>ESIMPINT.TXT (17,861 rows)</strong>         │  ┗━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫   ║
║  │          ══════════════════════════         │    ┌──────────────────────────────────────────────────┐  ┃   ║
║  │  <strong>Foreign Key:</strong> encoding_id                   │    │            <strong>EHIERINT.TXT (28,901 rows) </strong>           │  ┃   ║
║  │                                             │    │            ══════════════════════════            │  ┃   ║
║  │  ┏━━━━━━━━━━━━┱────────┬──────────────────┐ │    │  <strong>Foreign Key:</strong> encoding_id                        │  ┃   ║
║  │  ┃<strong>encoding_id ┃ coding │ meaning </strong>         │ │    │                                                  │  ┃   ║
║  │  ┠────────────╂────────┼──────────────────┤ │    │  ┏━━━━━━━━━━━━━┱────────┬─────────┬───────────┐  │  ┃   ║
║  │  ┃ 7          ┃ 1      │ &quot;Yes&quot;            │ │    │  ┃ <strong>encoding_id ┃ coding │ meaning │ parent_id</strong> │  │  ┃   ║
║  │  ┃ 7          ┃ 0      │ &quot;No&quot;             │ │    │  ┠─────────────╂────────┼─────────┼───────────┤  │  ┃   ║
║  │  ┃ 9          ┃ 1      │ &quot;Male&quot;           │ │    │  ┃ 2           ┃ 5111   │&quot;Farmers&quot;│ 511       │  │  ┃   ║ 
║  │  ┃ 9          ┃ 0      │ &quot;Female&quot;         │ │    │  ┃ 3           ┃ 1011   │&quot;cancer&quot; │ 0         │  │  ┃   ║
║  │  ┃ ...        ┃ ...    │ ...              │ │    │  ┃ ...         ┃ ...    │ ...     │ ...       │  │  ┃   ║
║  │  ┗━━━━━┳━━━━━━┹────────┴──────────────────┘ │    │  ┗━━━━━━┳━━━━━━┹────────┴─────────┴───────────┘  │  ┃   ║
║  └────────╂────────────────────────────────────┘    └─────────╂────────────────────────────────────────┘  ┃   ║
║           ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛   ║ 
║  ┌─────────────────────────────────────────────┐                                                              ║
║  │          <strong>ESIMPREAL.TXT (18 rows)</strong>            │   (Tiny tables, rarely used)                                 ║
║  │         ═════════════════════════           │                                                              ║
║  │  ┌────────────┬────────┬──────────────────┐ │                                                              ║
║  │  │<strong>encoding_id │ coding │ meaning </strong>         │ │                                                              ║
║  │  └────────────┴────────┴──────────────────┘ │                                                              ║
║  └─────────────────────────────────────────────┘                                                              ║
║                                                                                                               ║
║  ┌─────────────────────────────────────────────┐                                                              ║
║  │         <strong> ESIMPTIME.TXT (4 rows) </strong>            │                                                              ║
║  │          ══════════════════════             │                                                              ║
║  │  ┌────────────┬────────┬──────────────────┐ │                                                              ║
║  │  │<strong>encoding_id │ coding │ meaning  </strong>        │ │                                                              ║
║  │  └────────────┴────────┴──────────────────┘ │                                                              ║
║  └─────────────────────────────────────────────┘                                                              ║
║                                                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╝                         </code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
╔═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                UK BIOBANK SHOWCASE RAW DATA SCHEMA                                            ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                               ║
║  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                                         \textbf{FIELD.TXT (10,489 rows) }                                        │  ║
║  │                                         ═══════════════════════                                         │  ║
║  │  \textbf{Primary Key:} field_id                                                                                  │  ║
║  │                                                                                                         │  ║
║  │  ┌─────────────┬────────────────────────────────────┬───────────┬─────────────┲━━━━━━━━━━━━━━━━━━━━┓    │  ║
║  │  │  \textbf{field_id   │  title                             │  units    │ main_cat.   ┃  encoding_id   }    ┃    │  ║
║  │  ├─────────────┼────────────────────────────────────┼───────────┼─────────────╂────────────────────┨    │  ║
║  │  │  21001      │  "Body mass index (BMI)"           │  kg/m²    │  100010     ┃  0 (not encoded)   ┃    │  ║
║  │  │  4080       │  "Systolic blood pressure..."      │  mmHg     │  100011     ┃  0                 ┃    │  ║
║  │  │  20002      │  "Non-cancer illness code..."      │  -        │  100074     ┃  6                 ┃    │  ║
║  │  │  40001      │  "Underlying (primary) cause..."   │  -        │  2000       ┃  19                ┃    │  ║
║  │  │  ...        │  ...                               │  ...      │  ...        ┃  ...               ┃    │  ║
║  │  └─────────────┴────────────────────────────────────┴───────────┴──────┬──────┺━━━━━━━━━━━━━━┳━━━━━┛    │  ║
║  │                                                                        │                     ┃          │  ║
║  └────────────────────────────────────────────────────────────────────────┼─────────────────────╂──────────┘  ║
║                                                                           │                     ┃             ║
║                                  ┌────────────────────────────────────────┘                     ┃             ║
║                                  │                                                              ┃             ║
║                                  ▼                                                              ┃             ║
║  ┌───────────────────────────────────────────────────────────────────┐                          ┃             ║
║  │                    \textbf{CATEGORY.TXT (381 rows)}                        │                          ┃             ║
║  │                    ═══════════════════════                        │                          ┃             ║
║  │  \textbf{Primary Key:} category_id                                         │                          ┃             ║
║  │                                                                   │                          ┃             ║
║  │  ┌──────────────┬─────────────────────────────────────┬─────────┐ │                          ┃             ║
║  │  │\textbf{ category_id  │  title                              │ notes }  │ │                          ┃             ║
║  │  ├──────────────┼─────────────────────────────────────┼─────────┤ │                          ┃             ║ 
║  │  │  100010      │  "Body size measures"               │  ...    │ │                          ┗━━━━━━┓      ║
║  │  │  100011      │  "Blood pressure"                   │  ...    │ │                                 ┃      ║
║  │  │  100074      │  "Medical conditions"               │  ...    │ │                                 ┃      ║
║  │  │  2000        │  "Hospital inpatient"               │  ...    │ │                                 ┃      ║
║  │  │  ...         │  ...                                │  ...    │ │                                 ┃      ║
║  │  └──────────────┴─────────────────────────────────────┴─────────┘ │                                 ┃      ║
║  └───────────────────────────────────────────────────────────────────┘                                 ┃      ║
║                                                                                                        ┃      ║
║                                                                                                        ┃      ║
║                                                                                                        ┃      ║
║                                                                                                        ┃      ║
║  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐       ┃      ║
║  │                                   \textbf{ ENCODING.TXT (847 rows) }                                 │       ┃      ║
║  │                                   ════════════════════════                                  │       ┃      ║
║  │  \textbf{Primary Key:} encoding_id                                                                   │       ┃      ║
║  │                                                                                             │       ┃      ║
║  │  ┏━━━━━━━━━━━━━━┱────────────────────────────────────────┬────────────┬──────────────┐      │       ┃      ║
║  │  ┃ \textbf{encoding_id  ┃  title                                 │ structure  │ num_members } │      │       ┃      ║
║  │  ┠──────────────╂────────────────────────────────────────┼────────────┼──────────────┤      │       ┃      ║
║  │  ┃  0           ┃  "NOT-ENCODED"                         │  -         │  -           │      │       ┃      ║
║  │  ┃  6           ┃  "Non-cancer Illness"                  │  simple    │  474         │      │       ┃      ║
║  │  ┃  19          ┃  "ICD10"                               │  hierarchy │  19,190      │      │       ┃      ║
║  │  ┃  3           ┃  "Cancer"                              │  simple    │  89          │      │       ┃      ║
║  │  ┃  4           ┃  "Treatments"                          │  simple    │  6,745       │      │       ┃      ║
║  │  ┃       ...    ┃        ...                             │    ...     │     ...      │      │       ┃      ║
║  │  ┗━━━━━━━┳━━━━━━┹────────────────────────────────────────┴────────────┴──────────────┘      │       ┃      ║
║  │          ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┿━━━━━━━┫      ║
║  └─────────────────────────────────────────────────────────────────────────────────────────────┘       ┃      ║
║                                                                                                        ┃      ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                        \textbf{   DICTIONARY TABLES   }                                         ┃      ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                        ┃      ║
║      \textbf{ SIMPLE ENCODINGS (flat lookup tables)                    HIERARCHICAL ENCODINGS (tree) }          ┃      ║
║       ════════════════════════════════════                     ══════════════════════════════          ┗━━┓   ║
║                                                                                                           ┃   ║
║  ┌─────────────────────────────────────────────┐    ┌──────────────────────────────────────────────────┐  ┃   ║
║  │      \textbf{   ESIMPSTRING.TXT (439,346 rows)      │    │          EHIERSTRING.TXT (46,928 rows)  }         │  ┃   ║
║  │        ═══════════════════════════════      │    │          ═════════════════════════════           │  ┃   ║  
║  │  \textbf{Foreign Key:} encoding_id                   │    │  \textbf{Foreign Key:} encoding_id                        │  ┃   ║  
║  │                                             │    │                                                  │  ┃   ║  
║  │  ┏━━━━━━━━━━━━┱────────┬──────────────────┐ │    │  ┏━━━━━━━━━━━━━┱────────┬─────────┬───────────┐  │  ┃   ║  
║  │  ┃\textbf{encoding_id ┃ coding │ meaning  }        │ │    │  ┃ \textbf{encoding_id ┃ coding │ meaning │ parent_id} │  │  ┃   ║
║  │  ┠────────────╂────────┼──────────────────┤ │    │  ┠─────────────╂────────┼─────────┼───────────┤  │  ┃   ║
║  │  ┃ 6          ┃ 1065   │ "Hypertension"   │ │    │  ┃             ┃        │         │           │  │  ┃   ║
║  │  ┃ 6          ┃ 1473   │ "Type 2 diabetes"│ │    │  ┃ 19          ┃ I10    │ "Ess.   │ NULL      │  │  ┃   ║
║  │  ┃ 3          ┃ 1002   │ "Breast cancer"  │ │    │  ┃             ┃        │  hyper."│           │  │  ┃   ║
║  │  ┃ 4          ┃ 1140   │ "Metformin"      │ │    │  ┃             ┃        │         │           │  │  ┃   ║
║  │  ┃ ...        ┃ ...    │ ...              │ │    │  ┃ 19          ┃ I25.1  │ "Athero.│ I25       │  │  ┃   ║
║  │  ┗━━━━━━┳━━━━━┹────────┴──────────────────┘ │    │  ┃             ┃        │  heart" │           │  │  ┃   ║ 
║  └─────────╂───────────────────────────────────┘    │  ┃ ...         ┃   ...  │   ...   │   ...     │  │  ┃   ║
║            ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │  ┗━━━━━━━┳━━━━━┹────────┴─────────┴───────────┘  │  ┃   ║
║  ┌─────────────────────────────────────────────┐  ┃ └──────────╂───────────────────────────────────────┘  ┃   ║
║  │          \textbf{ESIMPINT.TXT (17,861 rows)}         │  ┗━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫   ║
║  │          ══════════════════════════         │    ┌──────────────────────────────────────────────────┐  ┃   ║
║  │  \textbf{Foreign Key:} encoding_id                   │    │            \textbf{EHIERINT.TXT (28,901 rows) }           │  ┃   ║
║  │                                             │    │            ══════════════════════════            │  ┃   ║
║  │  ┏━━━━━━━━━━━━┱────────┬──────────────────┐ │    │  \textbf{Foreign Key:} encoding_id                        │  ┃   ║
║  │  ┃\textbf{encoding_id ┃ coding │ meaning }         │ │    │                                                  │  ┃   ║
║  │  ┠────────────╂────────┼──────────────────┤ │    │  ┏━━━━━━━━━━━━━┱────────┬─────────┬───────────┐  │  ┃   ║
║  │  ┃ 7          ┃ 1      │ "Yes"            │ │    │  ┃ \textbf{encoding_id ┃ coding │ meaning │ parent_id} │  │  ┃   ║
║  │  ┃ 7          ┃ 0      │ "No"             │ │    │  ┠─────────────╂────────┼─────────┼───────────┤  │  ┃   ║
║  │  ┃ 9          ┃ 1      │ "Male"           │ │    │  ┃ 2           ┃ 5111   │"Farmers"│ 511       │  │  ┃   ║ 
║  │  ┃ 9          ┃ 0      │ "Female"         │ │    │  ┃ 3           ┃ 1011   │"cancer" │ 0         │  │  ┃   ║
║  │  ┃ ...        ┃ ...    │ ...              │ │    │  ┃ ...         ┃ ...    │ ...     │ ...       │  │  ┃   ║
║  │  ┗━━━━━┳━━━━━━┹────────┴──────────────────┘ │    │  ┗━━━━━━┳━━━━━━┹────────┴─────────┴───────────┘  │  ┃   ║
║  └────────╂────────────────────────────────────┘    └─────────╂────────────────────────────────────────┘  ┃   ║
║           ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛   ║ 
║  ┌─────────────────────────────────────────────┐                                                              ║
║  │          \textbf{ESIMPREAL.TXT (18 rows)}            │   (Tiny tables, rarely used)                                 ║
║  │         ═════════════════════════           │                                                              ║
║  │  ┌────────────┬────────┬──────────────────┐ │                                                              ║
║  │  │\textbf{encoding_id │ coding │ meaning }         │ │                                                              ║
║  │  └────────────┴────────┴──────────────────┘ │                                                              ║
║  └─────────────────────────────────────────────┘                                                              ║
║                                                                                                               ║
║  ┌─────────────────────────────────────────────┐                                                              ║
║  │         \textbf{ ESIMPTIME.TXT (4 rows) }            │                                                              ║
║  │          ══════════════════════             │                                                              ║
║  │  ┌────────────┬────────┬──────────────────┐ │                                                              ║
║  │  │\textbf{encoding_id │ coding │ meaning  }        │ │                                                              ║
║  │  └────────────┴────────┴──────────────────┘ │                                                              ║
║  └─────────────────────────────────────────────┘                                                              ║
║                                                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╝                         
\end{Verbatim}
~~~




---


## 2. Standalone Reference Tables


These tables are not linked via foreign keys but provide supplementary data:





~~~{=html}
<pre class="notion-ascii-diagram"><code>╔══════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                  <strong>       STANDALONE REFERENCE TABLES     </strong>                                     ║
╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                              ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                                     <strong>PUBLICATIONS.TXT (8,553 rows)   </strong>                                   │  ║
║  │                                     ═════════════════════════                                          │  ║
║  │  <strong>Purpose:</strong> Registry of all papers that have used UK Biobank data                                        │  ║
║  │  <strong>Link to fields:</strong> None (papers reference fields by name, not ID)                                        │  ║
║  │                                                                                                        │  ║
║  │  ┌────────────────────┬────────────────────┬─────────────────────┬────────────┬──────┬─────────────┐   │  ║
║  │  │  <strong>DOI (unique)      │ title              │ abstract            │ journal    │ year │ citations </strong>  │   │  ║
║  │  ├────────────────────┼────────────────────┼─────────────────────┼────────────┼──────┼─────────────┤   │  ║
║  │  │  10.1038/ng.3768   │ &quot;Genome-wide...&quot;   │ &quot;Mark Caulfield...&quot; │ Nat Genet  │ 2017 │ 498         │   │  ║
║  │  │  10.1016/j.jamda...│ &quot;BMI- and age...&quot;  │ &quot;Low fat-free...&quot;   │ JAMDA      │ 2014 │ 111         │   │  ║
║  │  │  ...               │ ...                │ ...                 │ ...        │ ...  │ ...         │   │  ║
║  │  └────────────────────┴────────────────────┴─────────────────────┴────────────┴──────┴─────────────┘   │  ║
║  │                                                                                                        │  ║
║  │  ★ <strong>CRITICAL:</strong> DOIs are used to download PDFs for NER processing                                         │  ║
║  │                                                                                                        │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                              ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                            <strong>  METAINVENTORY_VERSION1.0.0.CSV (405,543 rows)  </strong>                           │  ║
║  │                             ═══════════════════════════════════════════════                            │  ║
║  │  <strong>Source:</strong> Columbia University (external to UK Biobank)                                                  │  ║
║  │  <strong>Purpose:</strong> Medical abbreviation disambiguation                                                          │  ║
║  │                                                                                                        │  ║
║  │  ┌──────────────────┬─────────────────────────────┬─────────────────────┬───────────────────────────┐  │  ║
║  │  │<strong>  SF (short form) │ LF (long form)              │ NormLF              │ Source     </strong>               │  │  ║
║  │  ├──────────────────┼─────────────────────────────┼─────────────────────┼───────────────────────────┤  │  ║
║  │  │  BMI             │ &quot;body mass index&quot;           │ &quot;bodymassindex&quot;     │ UMLS                      │  │  ║
║  │  │  T2DM            │ &quot;type 2 diabetes mellitus&quot;  │ &quot;type2diabetes...&quot;  │ ADAM                      │  │  ║
║  │  │  CS              │ &quot;circumferential strain&quot;    │ &quot;circumferential.&quot;  │ UMLS                      │  │  ║
║  │  │  CS              │ &quot;cigarette smoking&quot;         │ &quot;cigarettesmoking&quot;  │ UMLS                      │  │  ║
║  │  │  ...             │ ...                         │ ...                 │ ...                       │  │  ║
║  │  └──────────────────┴─────────────────────────────┴─────────────────────┴───────────────────────────┘  │  ║
║  │                                                                                                        │  ║
║  │  ★ Used by SapBERT embeddings to select correct abbreviation meaning                                   │  ║
║  │                                                                                                        │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════════════╝
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
╔══════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                  \textbf{       STANDALONE REFERENCE TABLES     }                                     ║
╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                              ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                                     \textbf{PUBLICATIONS.TXT (8,553 rows)   }                                   │  ║
║  │                                     ═════════════════════════                                          │  ║
║  │  \textbf{Purpose:} Registry of all papers that have used UK Biobank data                                        │  ║
║  │  \textbf{Link to fields:} None (papers reference fields by name, not ID)                                        │  ║
║  │                                                                                                        │  ║
║  │  ┌────────────────────┬────────────────────┬─────────────────────┬────────────┬──────┬─────────────┐   │  ║
║  │  │  \textbf{DOI (unique)      │ title              │ abstract            │ journal    │ year │ citations }  │   │  ║
║  │  ├────────────────────┼────────────────────┼─────────────────────┼────────────┼──────┼─────────────┤   │  ║
║  │  │  10.1038/ng.3768   │ "Genome-wide..."   │ "Mark Caulfield..." │ Nat Genet  │ 2017 │ 498         │   │  ║
║  │  │  10.1016/j.jamda...│ "BMI- and age..."  │ "Low fat-free..."   │ JAMDA      │ 2014 │ 111         │   │  ║
║  │  │  ...               │ ...                │ ...                 │ ...        │ ...  │ ...         │   │  ║
║  │  └────────────────────┴────────────────────┴─────────────────────┴────────────┴──────┴─────────────┘   │  ║
║  │                                                                                                        │  ║
║  │  ★ \textbf{CRITICAL:} DOIs are used to download PDFs for NER processing                                         │  ║
║  │                                                                                                        │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                              ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                            \textbf{  METAINVENTORY_VERSION1.0.0.CSV (405,543 rows)  }                           │  ║
║  │                             ═══════════════════════════════════════════════                            │  ║
║  │  \textbf{Source:} Columbia University (external to UK Biobank)                                                  │  ║
║  │  \textbf{Purpose:} Medical abbreviation disambiguation                                                          │  ║
║  │                                                                                                        │  ║
║  │  ┌──────────────────┬─────────────────────────────┬─────────────────────┬───────────────────────────┐  │  ║
║  │  │\textbf{  SF (short form) │ LF (long form)              │ NormLF              │ Source     }               │  │  ║
║  │  ├──────────────────┼─────────────────────────────┼─────────────────────┼───────────────────────────┤  │  ║
║  │  │  BMI             │ "body mass index"           │ "bodymassindex"     │ UMLS                      │  │  ║
║  │  │  T2DM            │ "type 2 diabetes mellitus"  │ "type2diabetes..."  │ ADAM                      │  │  ║
║  │  │  CS              │ "circumferential strain"    │ "circumferential."  │ UMLS                      │  │  ║
║  │  │  CS              │ "cigarette smoking"         │ "cigarettesmoking"  │ UMLS                      │  │  ║
║  │  │  ...             │ ...                         │ ...                 │ ...                       │  │  ║
║  │  └──────────────────┴─────────────────────────────┴─────────────────────┴───────────────────────────┘  │  ║
║  │                                                                                                        │  ║
║  │  ★ Used by SapBERT embeddings to select correct abbreviation meaning                                   │  ║
║  │                                                                                                        │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

\end{Verbatim}
~~~




---


## 3. Complete Data Flow: From Raw Files to Pipeline Outputs




~~~{=html}
<pre class="notion-ascii-diagram"><code>╔═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    <strong>    COMPLETE DATA TRANSFORMATION PIPELINE   </strong>                                       ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                                       ║
║   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ ║
║   │                                <strong>     STAGE 1: RAW DATA INGESTION (01.01)          </strong>                               │ ║
║   │                                     ═══════════════════════════════════                                         │ ║
║   │                                                                                                                 │ ║
║   │   <strong>INPUT:</strong> UK Biobank Showcase website + Columbia Meta-Inventory                                                  │ ║
║   │                                                                                                                 │ ║
║   │   ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ ┌────────────────────────────────┐│ ║
║   │   │ <strong> field.txt     │ │ category.txt   │ │ encoding.txt   │ │ </strong><strong>publications</strong><strong>   │ │ Metainventory_Version1.0.0.csv</strong> ││ ║
║   │   │  (10,489)      │ │ (381)          │ │ (847)          │ │ .txt (8,553)   │ │ (405,543)                      ││ ║
║   │   └───────┬────────┘ └───────┬────────┘ └───────┬────────┘ └────────────────┘ └──────────────┬─────────────────┘│ ║
║   │           │                  │                  │                                            │                  │ ║
║   │           │                  │                  │                                            │                  │ ║
║   │   ┌───────┴──────────────────┴──────────────────┴───────┐                                    │                  │ ║
║   │   │ <strong>esimpstring.txt </strong>(439,346) │ <strong>ehierstring.txt</strong> (46,928)│                                    │                  │ ║
║   │   │ <strong>esimpint.txt</strong> (17,861)     │ <strong>ehierint.txt </strong>(28,901)   │                                    │                  │ ║
║   │   │ <strong>esimpreal.txt</strong> (18)        │ <strong>esimptime.txt</strong> (4)       │                                    │                  │ ║
║   │   └───────┬─────────────────────────────────────────────┘                                    │                  │ ║
║   │           │                                                                                  │                  │ ║
║   └───────────┼──────────────────────────────────────────────────────────────────────────────────┼──────────────────┘ ║
║               │                                                                                  │                    ║
║               ▼                                                                                  ▼                    ║
║   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ ║
║   │                                   <strong>STAGE 2: ABBREVIATION RESOLUTION (01.02a) </strong>                                    │ ║
║   │                                   ═════════════════════════════════════════                                     │ ║
║   │                                                                                                                 │ ║
║   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                        <strong>SAPBERT EMBEDDING ENGINE </strong>                                        │   │ ║
║   │   │                                        ════════════════════════                                         │   │ ║
║   │   │                                                                                                         │   │ ║
║   │   │    <strong>field.title:</strong> &quot;LV circumferential strain AHA 1&quot;                                                       │   │ ║
║   │   │         │                                                                                               │   │ ║
║   │   │         ▼                                                                                               │   │ ║
║   │   │   ┌─────────────────┐        ┌──────────────────────────────────────────────────────────┐               │   │ ║
║   │   │   │ SapBERT Encode  │───────►│ Embedding: [0.23, -0.45, 0.12, ..., 0.87] (768 dims)     │               │   │ ║
║   │   │   └─────────────────┘        └───────────────────────────────────┬──────────────────────┘               │   │ ║
║   │   │                                                                  │                                      │   │ ║
║   │   │   Meta-Inventory candidates for &quot;circumferential strain&quot;:        ▼                                      │   │ ║
║   │   │   ┌────────────────────────────────────────────────────────────────────────────────┐                    │   │ ║
║   │   │   │  &quot;CS&quot; = &quot;circumferential strain&quot; ───► embed ───► cosine_sim = 0.87 ✓ <strong>SELECTED</strong>  │                    │   │ ║
║   │   │   │  &quot;CS&quot; = &quot;cigarette smoking&quot;      ───► embed ───► cosine_sim = 0.23 ✗ REJECTED  │                    │   │ ║
║   │   │   │  &quot;CS&quot; = &quot;chronic sinusitis&quot;      ───► embed ───► cosine_sim = 0.19 ✗ REJECTED  │                    │   │ ║
║   │   │   └────────────────────────────────────────────────────────────────────────────────┘                    │   │ ║
║   │   │                                                                                                         │   │ ║
║   │   └───────────────────────────────────────────────────┬─────────────────────────────────────────────────────┘   │ ║
║   │                                                       │                                                         │ ║
║   │   <strong>OUTPUT:</strong>                                             ▼                                                         │ ║
║   │   ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ ║
║   │   │                              <strong>acronym_candidates.parquet (7,314 rows)  </strong>                                    │ │ ║
║   │   │                              ═══════════════════════════════════════                                      │ │ ║
║   │   │                                                                                                           │ │ ║
║   │   │  <strong>field_id │ original_phrase       │ selected_abbrev │ similarity │ source </strong>                                │ │ ║
║   │   │  ─────────┼───────────────────────┼─────────────────┼────────────┼───────                                 │ │ ║
║   │   │  21001    │ &quot;body mass index&quot;     │ &quot;BMI&quot;           │ 0.94       │ UMLS                                   │ │ ║
║   │   │  4080     │ &quot;systolic blood pres.&quot;│ &quot;SBP&quot;           │ 0.91       │ UMLS                                   │ │ ║
║   │   │  ...      │ ...                   │ ...             │ ...        │ ...                                    │ │ ║
║   │   └───────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ ║
║   │                                                                                                                 │ ║
║   └────────────────────────────────────────────────────────┬────────────────────────────────────────────────────────┘ ║
║                                                            │                                                          ║
║                                                            ▼                                                          ║
║   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ ║
║   │                                    <strong>STAGE 3: CODEBOOK CONSTRUCTION (01.02b) </strong>                                     │ ║
║   │                                    ═══════════════════════════════════════                                      │ ║
║   │                                                                                                                 │ ║
║   │                                                 <strong>JOIN CASCADE </strong>                                                   │ ║
║   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                                                         │   │ ║
║   │   │   <strong>field.txt</strong> ──┬──► <strong>LEFT JOIN</strong> category.txt ON main_category = category_id ─────────────────┐             │   │ ║
║   │   │               │                                                                           │             │   │ ║
║   │   │               └──► <strong>LEFT JOIN</strong> encoding.txt ON encoding_id = encoding_id ───────────────────┤             │   │ ║
║   │   │                                                                                           │             │   │ ║
║   │   │   <strong>acronym_candidates</strong> ──► <strong>LEFT JOIN</strong> ON field_id ───────────────────────────────────────────┤             │   │ ║
║   │   │                                                                                           │             │   │ ║
║   │   │                                                                                           ▼             │   │ ║
║   │   │                                                                              ┌────────────────────────┐ │   │ ║
║   │   │                                                                              │   <strong>UNIFIED FIELD VIEW</strong>   │ │   │ ║
║   │   │                                                                              │      (10,489 rows)     │ │   │ ║
║   │   │                                                                              └────────────┬───────────┘ │   │ ║
║   │   │                                                                                           │             │   │ ║
║   │   └───────────────────────────────────────────────────────────────────────────────────────────┼─────────────┘   │ ║
║   │                                                                                               │                 │ ║
║   │   ┌───────────────────────────────────────────────────────────────────────────────────────────┼─────────────┐   │ ║
║   │   │                                                                                           │             │   │ ║
║   │   │   esimpstrin + esimpint + ehierstring + ehierint + esimpreal + esimptime                  │             │   │ ║
║   │   │           │                                                                               │             │   │ ║
║   │   │           └──► <strong>UNION ALL</strong> ─────────────────────────────────────────────────────────────────┤             │   │ ║
║   │   │                                                                                           ▼             │   │ ║
║   │   │                                                                              ┌────────────────────────┐ │   │ ║
║   │   │                                                                              │  <strong>FLATTENED DICTIONARY</strong>  │ │   │ ║
║   │   │                                                                              │     (533,056 rows)     │ │   │ ║
║   │   │                                                                              └────────────┬───────────┘ │   │ ║
║   │   │                                                                                           │             │   │ ║
║   │   └───────────────────────────────────────────────────────────────────────────────────────────┼─────────────┘   │ ║
║   │                                                                                               │                 │ ║
║   └───────────────────────────────────────────────────────────────────────────────────────────────┼─────────────────┘ ║
║                                                                                                   │                   ║
║                                                                                                   ▼                   ║
║   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ ║
║   │                                         <strong>   FINAL OUTPUTS (01.02)  </strong>                                              │ ║
║   │                                            ═════════════════════                                                │ ║
║   │                                                                                                                 │ ║
║   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                                                         │   │ ║
║   │   │  <strong> ukb_fields.parquet                  ukb_field_codebook.parquet          acronym_candidates.parquet</strong>    │   │ ║
║   │   │   ══════════════════                  ══════════════════════════          ══════════════════════════    │   │ ║
║   │   │   10,489 rows                         533,056 rows                        7,314 rows                    │   │ ║
║   │   │                                                                                                         │   │ ║
║   │   │   ┌──────────────────────┐             ┌──────────────────────┐            ┌──────────────────────┐     │   │ ║
║   │   │   │ field_id             │             │ encoding_id          │            │ field_id             │     │   │ ║
║   │   │   │ title                │             │ encoding_title       │            │ original_phrase      │     │   │ ║
║   │   │   │ acr_abb_1..6         │             │ encoding_system      │            │ selected_abbrev      │     │   │ ║
║   │   │   │ category_id          │             │ coding               │            │ similarity_score     │     │   │ ║
║   │   │   │ category_title       │             │ meaning              │            │ source               │     │   │ ║
║   │   │   │ encoding_id          │             │ node_id              │            │ alternatives         │     │   │ ║
║   │   │   │ encoding_title       │             │ parent_id            │            │                      │     │   │ ║
║   │   │   │ units                │             │ selectable           │            │                      │     │   │ ║
║   │   │   │ num_participants     │             │                      │            │                      │     │   │ ║
║   │   │   │ notes                │             │                      │            │                      │     │   │ ║
║   │   │   └──────────────────────┘             └──────────────────────┘            └──────────────────────┘     │   │ ║
║   │   │                                                                                                         │   │ ║
║   │   └───────────────┬───────────────────────────────────┬───────────────────────────────────┬─────────────────┘   │ ║
║   │                   │                                   │                                   │                     │ ║
║   └───────────────────┼───────────────────────────────────┼───────────────────────────────────┼─────────────────────┘ ║
║                       │                                   │                                   │                       ║
╚═══════════════════════╪═══════════════════════════════════╪═══════════════════════════════════╪═══════════════════════╝
                        │                                   │                                   │
                        ▼                                   ▼                                   ▼
  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
  │                                                <strong>DOWNSTREAM CONSUMERS  </strong>                                             │
  │                                                ════════════════════                                               │
  │                                                                                                                   │
  │   ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
  │   │  <strong>PIPELINE 03: PDF INGESTION  </strong>                                                                              │  │
  │   │  ══════════════════════════                                                                                │  │
  │   │                                                                                                            │  │
  │   │  <strong>publications.txt</strong> DOIs ───► Download PDFs from arXiv/PubMed/publishers ───► paper.json corpus              │  │
  │   │                                                                                                            │  │
  │   └────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
  │                                                         │                                                         │
  │                                                         ▼                                                         │
  │   ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
  │   │  <strong>PIPELINE 04: NER EXTRACTION</strong>                                                                               │  │
  │   │  ═══════════════════════════                                                                               │  │
  │   │                                                                                                            │  │
  │   │  <strong>paper.json</strong> ───► BERN2/GLiNER/PubMedBERT ───► disease_mentions                                             │  │
  │   │                                                     │                                                      │  │
  │   │  <strong>ukb_fields.parquet</strong> ────────────────────────────────┼────► Feature grounding: &quot;BMI&quot; → field_id 21001       │  │
  │   │  (acr_abb columns enable matching)                  │                                                      │  │
  │   │                                                     ▼                                                      │  │
  │   │                                          paper_disease_ranking                                             │  │
  │   │                                      (primary/secondary/incidental)                                        │  │
  │   │                                                                                                            │  │
  │   └────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
  │                                                         │                                                         │
  │                                                         ▼                                                         │
  │   ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
  │   │  <strong>PIPELINE 04: ELASTIC SEARCH INDEX   </strong>                                                                      │  │
  │   │  ═════════════════════════════════                                                                         │  │
  │   │                                                                                                            │  │
  │   │  <strong>ukb_field_codebook.parque</strong>t ───► Index 10,489 features ───► Semantic search: &quot;diabetes biomarkers&quot; ─────┐  │  │
  │   │                                                                                                         │  │  │
  │   │                                  ┌──────────────────────────────────────────────────────────────────────┘  │  │
  │   │                                  ▼                                                                         │  │
  │   │                         <strong>Results:</strong> field_id 30750 (HbA1c), field_id 30740 (Glucose), ...                     │  │
  │   │                                                                                                            │  │
  │   └────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
  │                                                                                                                   │
  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
╔═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    \textbf{    COMPLETE DATA TRANSFORMATION PIPELINE   }                                       ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                                       ║
║   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ ║
║   │                                \textbf{     STAGE 1: RAW DATA INGESTION (01.01)          }                               │ ║
║   │                                     ═══════════════════════════════════                                         │ ║
║   │                                                                                                                 │ ║
║   │   \textbf{INPUT:} UK Biobank Showcase website + Columbia Meta-Inventory                                                  │ ║
║   │                                                                                                                 │ ║
║   │   ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ ┌────────────────────────────────┐│ ║
║   │   │ \textbf{ field.txt     │ │ category.txt   │ │ encoding.txt   │ │ }\textbf{publications}\textbf{   │ │ Metainventory_Version1.0.0.csv} ││ ║
║   │   │  (10,489)      │ │ (381)          │ │ (847)          │ │ .txt (8,553)   │ │ (405,543)                      ││ ║
║   │   └───────┬────────┘ └───────┬────────┘ └───────┬────────┘ └────────────────┘ └──────────────┬─────────────────┘│ ║
║   │           │                  │                  │                                            │                  │ ║
║   │           │                  │                  │                                            │                  │ ║
║   │   ┌───────┴──────────────────┴──────────────────┴───────┐                                    │                  │ ║
║   │   │ \textbf{esimpstring.txt }(439,346) │ \textbf{ehierstring.txt} (46,928)│                                    │                  │ ║
║   │   │ \textbf{esimpint.txt} (17,861)     │ \textbf{ehierint.txt }(28,901)   │                                    │                  │ ║
║   │   │ \textbf{esimpreal.txt} (18)        │ \textbf{esimptime.txt} (4)       │                                    │                  │ ║
║   │   └───────┬─────────────────────────────────────────────┘                                    │                  │ ║
║   │           │                                                                                  │                  │ ║
║   └───────────┼──────────────────────────────────────────────────────────────────────────────────┼──────────────────┘ ║
║               │                                                                                  │                    ║
║               ▼                                                                                  ▼                    ║
║   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ ║
║   │                                   \textbf{STAGE 2: ABBREVIATION RESOLUTION (01.02a) }                                    │ ║
║   │                                   ═════════════════════════════════════════                                     │ ║
║   │                                                                                                                 │ ║
║   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                        \textbf{SAPBERT EMBEDDING ENGINE }                                        │   │ ║
║   │   │                                        ════════════════════════                                         │   │ ║
║   │   │                                                                                                         │   │ ║
║   │   │    \textbf{field.title:} "LV circumferential strain AHA 1"                                                       │   │ ║
║   │   │         │                                                                                               │   │ ║
║   │   │         ▼                                                                                               │   │ ║
║   │   │   ┌─────────────────┐        ┌──────────────────────────────────────────────────────────┐               │   │ ║
║   │   │   │ SapBERT Encode  │───────►│ Embedding: [0.23, -0.45, 0.12, ..., 0.87] (768 dims)     │               │   │ ║
║   │   │   └─────────────────┘        └───────────────────────────────────┬──────────────────────┘               │   │ ║
║   │   │                                                                  │                                      │   │ ║
║   │   │   Meta-Inventory candidates for "circumferential strain":        ▼                                      │   │ ║
║   │   │   ┌────────────────────────────────────────────────────────────────────────────────┐                    │   │ ║
║   │   │   │  "CS" = "circumferential strain" ───► embed ───► cosine_sim = 0.87 ✓ \textbf{SELECTED}  │                    │   │ ║
║   │   │   │  "CS" = "cigarette smoking"      ───► embed ───► cosine_sim = 0.23 ✗ REJECTED  │                    │   │ ║
║   │   │   │  "CS" = "chronic sinusitis"      ───► embed ───► cosine_sim = 0.19 ✗ REJECTED  │                    │   │ ║
║   │   │   └────────────────────────────────────────────────────────────────────────────────┘                    │   │ ║
║   │   │                                                                                                         │   │ ║
║   │   └───────────────────────────────────────────────────┬─────────────────────────────────────────────────────┘   │ ║
║   │                                                       │                                                         │ ║
║   │   \textbf{OUTPUT:}                                             ▼                                                         │ ║
║   │   ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │ ║
║   │   │                              \textbf{acronym_candidates.parquet (7,314 rows)  }                                    │ │ ║
║   │   │                              ═══════════════════════════════════════                                      │ │ ║
║   │   │                                                                                                           │ │ ║
║   │   │  \textbf{field_id │ original_phrase       │ selected_abbrev │ similarity │ source }                                │ │ ║
║   │   │  ─────────┼───────────────────────┼─────────────────┼────────────┼───────                                 │ │ ║
║   │   │  21001    │ "body mass index"     │ "BMI"           │ 0.94       │ UMLS                                   │ │ ║
║   │   │  4080     │ "systolic blood pres."│ "SBP"           │ 0.91       │ UMLS                                   │ │ ║
║   │   │  ...      │ ...                   │ ...             │ ...        │ ...                                    │ │ ║
║   │   └───────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │ ║
║   │                                                                                                                 │ ║
║   └────────────────────────────────────────────────────────┬────────────────────────────────────────────────────────┘ ║
║                                                            │                                                          ║
║                                                            ▼                                                          ║
║   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ ║
║   │                                    \textbf{STAGE 3: CODEBOOK CONSTRUCTION (01.02b) }                                     │ ║
║   │                                    ═══════════════════════════════════════                                      │ ║
║   │                                                                                                                 │ ║
║   │                                                 \textbf{JOIN CASCADE }                                                   │ ║
║   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                                                         │   │ ║
║   │   │   \textbf{field.txt} ──┬──► \textbf{LEFT JOIN} category.txt ON main_category = category_id ─────────────────┐             │   │ ║
║   │   │               │                                                                           │             │   │ ║
║   │   │               └──► \textbf{LEFT JOIN} encoding.txt ON encoding_id = encoding_id ───────────────────┤             │   │ ║
║   │   │                                                                                           │             │   │ ║
║   │   │   \textbf{acronym_candidates} ──► \textbf{LEFT JOIN} ON field_id ───────────────────────────────────────────┤             │   │ ║
║   │   │                                                                                           │             │   │ ║
║   │   │                                                                                           ▼             │   │ ║
║   │   │                                                                              ┌────────────────────────┐ │   │ ║
║   │   │                                                                              │   \textbf{UNIFIED FIELD VIEW}   │ │   │ ║
║   │   │                                                                              │      (10,489 rows)     │ │   │ ║
║   │   │                                                                              └────────────┬───────────┘ │   │ ║
║   │   │                                                                                           │             │   │ ║
║   │   └───────────────────────────────────────────────────────────────────────────────────────────┼─────────────┘   │ ║
║   │                                                                                               │                 │ ║
║   │   ┌───────────────────────────────────────────────────────────────────────────────────────────┼─────────────┐   │ ║
║   │   │                                                                                           │             │   │ ║
║   │   │   esimpstrin + esimpint + ehierstring + ehierint + esimpreal + esimptime                  │             │   │ ║
║   │   │           │                                                                               │             │   │ ║
║   │   │           └──► \textbf{UNION ALL} ─────────────────────────────────────────────────────────────────┤             │   │ ║
║   │   │                                                                                           ▼             │   │ ║
║   │   │                                                                              ┌────────────────────────┐ │   │ ║
║   │   │                                                                              │  \textbf{FLATTENED DICTIONARY}  │ │   │ ║
║   │   │                                                                              │     (533,056 rows)     │ │   │ ║
║   │   │                                                                              └────────────┬───────────┘ │   │ ║
║   │   │                                                                                           │             │   │ ║
║   │   └───────────────────────────────────────────────────────────────────────────────────────────┼─────────────┘   │ ║
║   │                                                                                               │                 │ ║
║   └───────────────────────────────────────────────────────────────────────────────────────────────┼─────────────────┘ ║
║                                                                                                   │                   ║
║                                                                                                   ▼                   ║
║   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ ║
║   │                                         \textbf{   FINAL OUTPUTS (01.02)  }                                              │ ║
║   │                                            ═════════════════════                                                │ ║
║   │                                                                                                                 │ ║
║   │   ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                                                         │   │ ║
║   │   │  \textbf{ ukb_fields.parquet                  ukb_field_codebook.parquet          acronym_candidates.parquet}    │   │ ║
║   │   │   ══════════════════                  ══════════════════════════          ══════════════════════════    │   │ ║
║   │   │   10,489 rows                         533,056 rows                        7,314 rows                    │   │ ║
║   │   │                                                                                                         │   │ ║
║   │   │   ┌──────────────────────┐             ┌──────────────────────┐            ┌──────────────────────┐     │   │ ║
║   │   │   │ field_id             │             │ encoding_id          │            │ field_id             │     │   │ ║
║   │   │   │ title                │             │ encoding_title       │            │ original_phrase      │     │   │ ║
║   │   │   │ acr_abb_1..6         │             │ encoding_system      │            │ selected_abbrev      │     │   │ ║
║   │   │   │ category_id          │             │ coding               │            │ similarity_score     │     │   │ ║
║   │   │   │ category_title       │             │ meaning              │            │ source               │     │   │ ║
║   │   │   │ encoding_id          │             │ node_id              │            │ alternatives         │     │   │ ║
║   │   │   │ encoding_title       │             │ parent_id            │            │                      │     │   │ ║
║   │   │   │ units                │             │ selectable           │            │                      │     │   │ ║
║   │   │   │ num_participants     │             │                      │            │                      │     │   │ ║
║   │   │   │ notes                │             │                      │            │                      │     │   │ ║
║   │   │   └──────────────────────┘             └──────────────────────┘            └──────────────────────┘     │   │ ║
║   │   │                                                                                                         │   │ ║
║   │   └───────────────┬───────────────────────────────────┬───────────────────────────────────┬─────────────────┘   │ ║
║   │                   │                                   │                                   │                     │ ║
║   └───────────────────┼───────────────────────────────────┼───────────────────────────────────┼─────────────────────┘ ║
║                       │                                   │                                   │                       ║
╚═══════════════════════╪═══════════════════════════════════╪═══════════════════════════════════╪═══════════════════════╝
                        │                                   │                                   │
                        ▼                                   ▼                                   ▼
  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
  │                                                \textbf{DOWNSTREAM CONSUMERS  }                                             │
  │                                                ════════════════════                                               │
  │                                                                                                                   │
  │   ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
  │   │  \textbf{PIPELINE 03: PDF INGESTION  }                                                                              │  │
  │   │  ══════════════════════════                                                                                │  │
  │   │                                                                                                            │  │
  │   │  \textbf{publications.txt} DOIs ───► Download PDFs from arXiv/PubMed/publishers ───► paper.json corpus              │  │
  │   │                                                                                                            │  │
  │   └────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
  │                                                         │                                                         │
  │                                                         ▼                                                         │
  │   ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
  │   │  \textbf{PIPELINE 04: NER EXTRACTION}                                                                               │  │
  │   │  ═══════════════════════════                                                                               │  │
  │   │                                                                                                            │  │
  │   │  \textbf{paper.json} ───► BERN2/GLiNER/PubMedBERT ───► disease_mentions                                             │  │
  │   │                                                     │                                                      │  │
  │   │  \textbf{ukb_fields.parquet} ────────────────────────────────┼────► Feature grounding: "BMI" → field_id 21001       │  │
  │   │  (acr_abb columns enable matching)                  │                                                      │  │
  │   │                                                     ▼                                                      │  │
  │   │                                          paper_disease_ranking                                             │  │
  │   │                                      (primary/secondary/incidental)                                        │  │
  │   │                                                                                                            │  │
  │   └────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
  │                                                         │                                                         │
  │                                                         ▼                                                         │
  │   ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
  │   │  \textbf{PIPELINE 04: ELASTIC SEARCH INDEX   }                                                                      │  │
  │   │  ═════════════════════════════════                                                                         │  │
  │   │                                                                                                            │  │
  │   │  \textbf{ukb_field_codebook.parque}t ───► Index 10,489 features ───► Semantic search: "diabetes biomarkers" ─────┐  │  │
  │   │                                                                                                         │  │  │
  │   │                                  ┌──────────────────────────────────────────────────────────────────────┘  │  │
  │   │                                  ▼                                                                         │  │
  │   │                         \textbf{Results:} field_id 30750 (HbA1c), field_id 30740 (Glucose), ...                     │  │
  │   │                                                                                                            │  │
  │   └────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
  │                                                                                                                   │
  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




---


## 4. Entity-Relationship Diagram (Simplified)




~~~{=html}
<pre class="notion-ascii-diagram"><code>╔════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                 <strong>        ENTITY-RELATIONSHIP SUMMARY  </strong>                                      ║
╠════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                            ║
║                                                                                                            ║
║        ┌──────────────────────────────────────────────────────────────────────────────────────────┐        ║
║        │                                                                                          │        ║
║        │   ┌──────────────┐       1:N        ┌──────────────┐        1:N       ┌──────────────┐   │        ║
║        │   │              │─────────────────►│              │◄──────────────── │              │   │        ║
║        │   │  <strong>CATEGORY</strong>    │                  │    <strong>FIELD </strong>    │                  │   <strong>ENCODING</strong>   │   │        ║
║        │   │  (381)       │                  │   (10,489)   │                  │    (847)     │   │        ║
║        │   │              │◄─────────────────│              │─────────────────►│              │   │        ║
║        │   └──────────────┘    belongs_to    └──────────────┘     uses         └──────────────┘   │        ║
║        │                                            │                                │            │        ║
║        │                                            │                                │            │        ║
║        │                                            │ has_abbreviations              │ defines    │        ║
║        │                                            │ (via Meta-Inventory)           │            │        ║
║        │                                            ▼                                ▼            │        ║
║        │                                     ┌──────────────┐                 ┌──────────────┐    │        ║
║        │                                     │              │                 │              │    │        ║
║        │                                     │   <strong>ACRONYM </strong>   │                 │  <strong>DICTIONARY</strong>  │    │        ║
║        │                                     │   (7,314)    │                 │  (533,056)   │    │        ║
║        │                                     │              │                 │              │    │        ║
║        │                                     └──────────────┘                 └──────────────┘    │        ║
║        │                                                                                          │        ║
║        │                                                                                          │        ║
║        │     STANDALONE:                                                                          │        ║
║        │     ───────────                                                                          │        ║
║        │                                                                                          │        ║
║        │   ┌──────────────┐                             ┌──────────────────────────────────────┐  │        ║
║        │   │              │                             │                                      │  │        ║
║        │   │  <strong>PUBLICATION</strong> │ ◄─── <strong>No FK relationship</strong> ───►│  <strong>META-INVENTORY</strong> (external source)    │  │        ║
║        │   │  (8,553)     │       Papers reference      │          (405,543)                   │  │        ║
║        │   │              │        fields by NAME,      │                                      │  │        ║
║        │   │              │           not by ID         │   Used to generate ACRONYM mappings  │  │        ║
║        │   └──────────────┘                             └──────────────────────────────────────┘  │        ║
║        │                                                                                          │        ║
║        └──────────────────────────────────────────────────────────────────────────────────────────┘        ║
║                                                                                                            ║
║   <strong>CARDINALITY SUMMARY:</strong>                                                                                     ║
║   ────────────────────                                                                                     ║
║   • 1 CATEGORY has N FIELDS (avg 27.5 fields per category)                                                 ║
║   • 1 FIELD has 1 CATEGORY (required)                                                                      ║
║   • 1 FIELD has 0..1 ENCODING (encoding_id = 0 means no encoding)                                          ║
║   • 1 ENCODING has N DICTIONARY values (avg 630 values per encoding)                                       ║
║   • 1 FIELD has 0..N ACRONYM mappings (avg 0.7 per field)                                                  ║
║                                                                                                            ║
╚════════════════════════════════════════════════════════════════════════════════════════════════════════════╝
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
╔════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                 \textbf{        ENTITY-RELATIONSHIP SUMMARY  }                                      ║
╠════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                            ║
║                                                                                                            ║
║        ┌──────────────────────────────────────────────────────────────────────────────────────────┐        ║
║        │                                                                                          │        ║
║        │   ┌──────────────┐       1:N        ┌──────────────┐        1:N       ┌──────────────┐   │        ║
║        │   │              │─────────────────►│              │◄──────────────── │              │   │        ║
║        │   │  \textbf{CATEGORY}    │                  │    \textbf{FIELD }    │                  │   \textbf{ENCODING}   │   │        ║
║        │   │  (381)       │                  │   (10,489)   │                  │    (847)     │   │        ║
║        │   │              │◄─────────────────│              │─────────────────►│              │   │        ║
║        │   └──────────────┘    belongs_to    └──────────────┘     uses         └──────────────┘   │        ║
║        │                                            │                                │            │        ║
║        │                                            │                                │            │        ║
║        │                                            │ has_abbreviations              │ defines    │        ║
║        │                                            │ (via Meta-Inventory)           │            │        ║
║        │                                            ▼                                ▼            │        ║
║        │                                     ┌──────────────┐                 ┌──────────────┐    │        ║
║        │                                     │              │                 │              │    │        ║
║        │                                     │   \textbf{ACRONYM }   │                 │  \textbf{DICTIONARY}  │    │        ║
║        │                                     │   (7,314)    │                 │  (533,056)   │    │        ║
║        │                                     │              │                 │              │    │        ║
║        │                                     └──────────────┘                 └──────────────┘    │        ║
║        │                                                                                          │        ║
║        │                                                                                          │        ║
║        │     STANDALONE:                                                                          │        ║
║        │     ───────────                                                                          │        ║
║        │                                                                                          │        ║
║        │   ┌──────────────┐                             ┌──────────────────────────────────────┐  │        ║
║        │   │              │                             │                                      │  │        ║
║        │   │  \textbf{PUBLICATION} │ ◄─── \textbf{No FK relationship} ───►│  \textbf{META-INVENTORY} (external source)    │  │        ║
║        │   │  (8,553)     │       Papers reference      │          (405,543)                   │  │        ║
║        │   │              │        fields by NAME,      │                                      │  │        ║
║        │   │              │           not by ID         │   Used to generate ACRONYM mappings  │  │        ║
║        │   └──────────────┘                             └──────────────────────────────────────┘  │        ║
║        │                                                                                          │        ║
║        └──────────────────────────────────────────────────────────────────────────────────────────┘        ║
║                                                                                                            ║
║   \textbf{CARDINALITY SUMMARY:}                                                                                     ║
║   ────────────────────                                                                                     ║
║   • 1 CATEGORY has N FIELDS (avg 27.5 fields per category)                                                 ║
║   • 1 FIELD has 1 CATEGORY (required)                                                                      ║
║   • 1 FIELD has 0..1 ENCODING (encoding_id = 0 means no encoding)                                          ║
║   • 1 ENCODING has N DICTIONARY values (avg 630 values per encoding)                                       ║
║   • 1 FIELD has 0..N ACRONYM mappings (avg 0.7 per field)                                                  ║
║                                                                                                            ║
╚════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

\end{Verbatim}
~~~




---


## 5. File Size and Row Count Summary




~~~{=html}
<pre class="notion-ascii-diagram"><code>╔═══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                         <strong>  DATA VOLUME SUMMARY     </strong>                                    ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                       ║
║   <strong>RAW INPUT FILES (11 total)  </strong>                                      <strong>PROCESSED OUTPUT FILES</strong>            ║
║   ══════════════════════════                                        ════════════════════════          ║
║                                                                                                       ║
║   ┌──────────────────────────┬─────────────┐             ┌──────────────────────────┬─────────────┐   ║
║   <strong>│  File                    │ Rows        │             │  File                    │ Rows        │   ║</strong>
║   ├──────────────────────────┼─────────────┤             ├──────────────────────────┼─────────────┤   ║
║   │  field.txt               │    10,489   │             │  ukb_fields.parquet      │    10,489   │   ║
║   │  category.txt            │       381   │             │  ukb_field_codebook      │   533,056   │   ║ 
║   │  encoding.txt            │       847   │             │  .parquet                │             │   ║
║   │  esimpstring.txt         │   439,346   │             │  acronym_candidates      │     7,314   │   ║
║   │  esimpint.txt            │    17,861   │     ═══►    │  .parquet                │             │   ║
║   │  ehierstring.txt         │    46,928   │             │                          │             │   ║
║   │  ehierint.txt            │    28,901   │             │  validation_report.txt   │        -    │   ║
║   │  esimpreal.txt           │        18   │             │  human_verify.txt        │       385   │   ║
║   │  esimptime.txt           │         4   │             │  acronym_summary.txt     │       587   │   ║
║   │  publications.txt        │     8,553   │             │                          │             │   ║
║   │  Metainventory*.csv      │   405,543   │             │                          │             │   ║
║   ├──────────────────────────┼─────────────┤             ├──────────────────────────┼─────────────┤   ║
║   │<strong>  TOTAL                   │   958,871   │   </strong>          │ <strong> TOTAL (key files)       │   550,859 </strong>  │   ║
║   └──────────────────────────┴─────────────┘             └──────────────────────────┴─────────────┘   ║
║                                                                                                       ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════╝</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
╔═══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                         \textbf{  DATA VOLUME SUMMARY     }                                    ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                       ║
║   \textbf{RAW INPUT FILES (11 total)  }                                      \textbf{PROCESSED OUTPUT FILES}            ║
║   ══════════════════════════                                        ════════════════════════          ║
║                                                                                                       ║
║   ┌──────────────────────────┬─────────────┐             ┌──────────────────────────┬─────────────┐   ║
║   \textbf{│  File                    │ Rows        │             │  File                    │ Rows        │   ║}
║   ├──────────────────────────┼─────────────┤             ├──────────────────────────┼─────────────┤   ║
║   │  field.txt               │    10,489   │             │  ukb_fields.parquet      │    10,489   │   ║
║   │  category.txt            │       381   │             │  ukb_field_codebook      │   533,056   │   ║ 
║   │  encoding.txt            │       847   │             │  .parquet                │             │   ║
║   │  esimpstring.txt         │   439,346   │             │  acronym_candidates      │     7,314   │   ║
║   │  esimpint.txt            │    17,861   │     ═══►    │  .parquet                │             │   ║
║   │  ehierstring.txt         │    46,928   │             │                          │             │   ║
║   │  ehierint.txt            │    28,901   │             │  validation_report.txt   │        -    │   ║
║   │  esimpreal.txt           │        18   │             │  human_verify.txt        │       385   │   ║
║   │  esimptime.txt           │         4   │             │  acronym_summary.txt     │       587   │   ║
║   │  publications.txt        │     8,553   │             │                          │             │   ║
║   │  Metainventory*.csv      │   405,543   │             │                          │             │   ║
║   ├──────────────────────────┼─────────────┤             ├──────────────────────────┼─────────────┤   ║
║   │\textbf{  TOTAL                   │   958,871   │   }          │ \textbf{ TOTAL (key files)       │   550,859 }  │   ║
║   └──────────────────────────┴─────────────┘             └──────────────────────────┴─────────────┘   ║
║                                                                                                       ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════╝
\end{Verbatim}
~~~








