# Pipeline Validation Report


## Content


# 1. Objective and Scope


### 1.1 The Challenge


When processing 100,000+ academic PDFs through a multi-stage pipeline, we face a critical question:


> "How do we know if the pipeline produced good results, and can we prove it?"

Each document passes through ~45 processing stages across 10 stage groups (G0-G9). Without a standardised reporting system:




<table>
  <thead>
    <tr>
      <th><strong>Problem</strong></th>
      <th><strong>Impact</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>No consistent quality metrics</td>
      <td>Cannot compare documents or track trends</td>
    </tr>
    <tr>
      <td>Unclear pass/fail criteria</td>
      <td>Manual review for every document</td>
    </tr>
    <tr>
      <td>No reproducibility proof</td>
      <td>Cannot verify results came from same config/code</td>
    </tr>
    <tr>
      <td>Unbounded diagnostic data</td>
      <td>Reports grow to gigabytes, unqueryable</td>
    </tr>
    <tr>
      <td>Inconsistent formats</td>
      <td>Cannot aggregate corpus-level statistics</td>
    </tr>
  </tbody>
</table>



### 1.2 The Solution


We implement a Standardised Report Schema with three key components:





~~~{=html}
<pre class="notion-ascii-diagram"><code>┌───────────────────────────────────────────────────────────────────────────┐
│                      <strong>  REPORT SYSTEM ARCHITECTURE </strong>                        │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│   ┌───────────────────┐   ┌───────────────────┐   ┌───────────────────┐   │
<strong>│   │   STANDARDISED    │   │   PROVENANCE      │   │   TRACE           │   │
│   │   REPORT SCHEMA   │   │   FINGERPRINTS    │   │   MANIFEST        │   │</strong>
│   ├───────────────────┤   ├───────────────────┤   ├───────────────────┤   │
│   │                   │   │                   │   │                   │   │
│   │ • metrics (flat)  │   │ • config_hash     │   │ • run.jsonl       │   │
│   │ • distributions   │   │ • code_hash       │   │ • append-only     │   │
│   │ • checks[]        │   │ • params_hash     │   │ • per-stage       │   │
│   │ • diagnostics     │   │                   │   │ • retry tracking  │   │
│   │ • thresholds      │   │                   │   │                   │   │
│   │ • timing          │   │                   │   │                   │   │
│   │ • provenance      │   │                   │   │                   │   │
│   └───────────────────┘   └───────────────────┘   └───────────────────┘   │
│            │                       │                       │              │
│            └───────────────────────┴───────────────────────┘              │
│                                    │                                      │
│                                    ▼                                      │
│                    ┌───────────────────────────────┐                      │
<strong>│                    │      DuckDB AGGREGATION       </strong>│                      |<strong>
</strong>│<strong>    </strong>                │      (Database Pipeline)      │                      │
│                    │                               │                      │
│                    │  • Corpus-level pass rates    │                      │
│                    │  • Threshold sensitivity      │                      │
│                    │  • Failure correlation        │                      │
│                    │  • Performance analysis       │                      │
│                    └───────────────────────────────┘                      │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌───────────────────────────────────────────────────────────────────────────┐
│                      \textbf{  REPORT SYSTEM ARCHITECTURE }                        │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│   ┌───────────────────┐   ┌───────────────────┐   ┌───────────────────┐   │
\textbf{│   │   STANDARDISED    │   │   PROVENANCE      │   │   TRACE           │   │
│   │   REPORT SCHEMA   │   │   FINGERPRINTS    │   │   MANIFEST        │   │}
│   ├───────────────────┤   ├───────────────────┤   ├───────────────────┤   │
│   │                   │   │                   │   │                   │   │
│   │ • metrics (flat)  │   │ • config_hash     │   │ • run.jsonl       │   │
│   │ • distributions   │   │ • code_hash       │   │ • append-only     │   │
│   │ • checks[]        │   │ • params_hash     │   │ • per-stage       │   │
│   │ • diagnostics     │   │                   │   │ • retry tracking  │   │
│   │ • thresholds      │   │                   │   │                   │   │
│   │ • timing          │   │                   │   │                   │   │
│   │ • provenance      │   │                   │   │                   │   │
│   └───────────────────┘   └───────────────────┘   └───────────────────┘   │
│            │                       │                       │              │
│            └───────────────────────┴───────────────────────┘              │
│                                    │                                      │
│                                    ▼                                      │
│                    ┌───────────────────────────────┐                      │
\textbf{│                    │      DuckDB AGGREGATION       }│                      |\textbf{
}│\textbf{    }                │      (Database Pipeline)      │                      │
│                    │                               │                      │
│                    │  • Corpus-level pass rates    │                      │
│                    │  • Threshold sensitivity      │                      │
│                    │  • Failure correlation        │                      │
│                    │  • Performance analysis       │                      │
│                    └───────────────────────────────┘                      │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### 1.3 Report Types in the Pipeline


Each stage group (G1-G7) produces quality control reports:




<table>
  <thead>
    <tr>
      <th><strong>Stage</strong></th>
      <th><strong>Report</strong></th>
      <th><strong>Purpose</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>G2_05</td>
      <td><code>line_qc.json</code></td>
      <td>Line token OCR confidence and geometry</td>
    </tr>
    <tr>
      <td>G2_06</td>
      <td><code>word_qc.json</code></td>
      <td>Word token coverage and bbox alignment</td>
    </tr>
    <tr>
      <td>G2_09</td>
      <td><code>report.json</code></td>
      <td>Spine health score (consolidated G2 QC)</td>
    </tr>
    <tr>
      <td>G3_03</td>
      <td><code>witness_qc.json</code></td>
      <td>Witness engine (Marker/Docling) validation</td>
    </tr>
    <tr>
      <td>G4_03</td>
      <td><code>header_qc.json</code></td>
      <td>GROBID metadata extraction quality</td>
    </tr>
    <tr>
      <td>G5_03</td>
      <td><code>tabular_qc.json</code></td>
      <td>Table structure extraction quality</td>
    </tr>
    <tr>
      <td>G6_03</td>
      <td><code>layout_qc.json</code></td>
      <td>PP-Structure layout detection quality</td>
    </tr>
    <tr>
      <td>G7_02</td>
      <td><code>fusion_qc.json</code></td>
      <td>Document fusion coverage and integrity</td>
    </tr>
  </tbody>
</table>



---


## 2. Methods and Process


### 2.1 The Standardised Report Schema


Every report across all stages MUST conform to this schema:





~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                       <strong> STANDARD REPORT SCHEMA      </strong>                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   <strong>HEADER (required for every report)   </strong>                                     │
│   ────────────────────────────────────                                      │
│   • doc_id       : Document identifier                                      │
│   • stage_id     : &quot;G2_09&quot;, &quot;G4_03&quot;, etc.                                   │
│   • timestamp    : ISO8601 with timezone                                    │
│   • version      : &quot;G2_09_v1&quot; (increment on schema change)                  │
│   • pass         : boolean (overall verdict)                                │
│   • confidence   : 0-1 (certainty, 1.0 if deterministic)                    │
│                                                                             │
│   <strong>SUMMARY (human-readable)    </strong>                                              │
│   ─────────────────────────                                                 │
│   • status           : &quot;PASS&quot; | &quot;FAIL&quot; | &quot;WARN&quot; | &quot;REVIEW&quot;                  │
│   • status_reason    : Single sentence explaining verdict                   │
│   • critical_failures: List of blocking issues                              │
│   • warnings         : List of non-blocking concerns                        │
│                                                                             │
│   <strong>METRICS (machine-readable, DuckDB-friendly)  </strong>                             │
│   ─────────────────────────────────────────────                             │
│   • ALL keys must be snake_case                                             │
│   • ALL values must be numeric or categorical                               │
│   • Naming: {category}_{metric}_{aggregation}                               │
│   • NO nested objects (flat structure)                                      │
│   • Example: &quot;line_conf_q95&quot;: 0.9891                                        │
│                                                                             │
│   <strong>DISTRIBUTIONS (for visualization)      </strong>                                   │
│   ──────────────────────────────────                                        │
│   • bins[]     : Histogram buckets                                          │
│   • counts[]   : Count per bucket                                           │
│   • quantiles  : q01, q05, q50, q95, q99                                    │
│                                                                             │
│   <strong>CHECKS (itemized validation)   </strong>                                           │
│   ─────────────────────────────                                             │
│   • id           : Unique check identifier                                  │
│   • category     : quality | coverage | structure | alignment | metadata    │
│   • severity     : critical | high | medium | low                           │
│   • passed       : boolean                                                  │
│   • threshold    : The threshold value used                                 │
│   • actual       : The measured value                                       │
│   • description  : What this check validates                                │
│   • recommendation: What to do if it fails                                  │
│                                                                             │
│   <strong>DIAGNOSTICS (bounded samples) </strong>                                            │
│   ──────────────────────────────                                            │
│   • count        : Total count of issues (may be &gt;&gt; sample_size)            │
│   • sample_size  : Actual samples included (max 20)                         │
│   • samples[]    : Worst examples (sorted by severity)                      │
│                                                                             │
│   <strong>THRESHOLDS (explicit for reproducibility)  </strong>                               │
│   ──────────────────────────────────────────                                │
│   • value        : Threshold value used                                     │
│   • description  : What this threshold controls                             │
│   • source       : &quot;config&quot; | &quot;hardcoded&quot; | &quot;computed&quot;                      │
│                                                                             │
│   <strong>PROVENANCE (for traceability)    </strong>                                         │
│   ──────────────────────────────                                            │
│   • inputs       : List of input file paths                                 │
│   • outputs      : List of output file paths                                │
│   • config_hash  : SHA256 fingerprint of params                             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────────────────────┐
│                       \textbf{ STANDARD REPORT SCHEMA      }                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   \textbf{HEADER (required for every report)   }                                     │
│   ────────────────────────────────────                                      │
│   • doc_id       : Document identifier                                      │
│   • stage_id     : "G2_09", "G4_03", etc.                                   │
│   • timestamp    : ISO8601 with timezone                                    │
│   • version      : "G2_09_v1" (increment on schema change)                  │
│   • pass         : boolean (overall verdict)                                │
│   • confidence   : 0-1 (certainty, 1.0 if deterministic)                    │
│                                                                             │
│   \textbf{SUMMARY (human-readable)    }                                              │
│   ─────────────────────────                                                 │
│   • status           : "PASS" | "FAIL" | "WARN" | "REVIEW"                  │
│   • status_reason    : Single sentence explaining verdict                   │
│   • critical_failures: List of blocking issues                              │
│   • warnings         : List of non-blocking concerns                        │
│                                                                             │
│   \textbf{METRICS (machine-readable, DuckDB-friendly)  }                             │
│   ─────────────────────────────────────────────                             │
│   • ALL keys must be snake_case                                             │
│   • ALL values must be numeric or categorical                               │
│   • Naming: \textbraceleft{\textbraceright{}category\textbraceright{}_\textbraceleft{\textbraceright{}metric\textbraceright{}_\textbraceleft{\textbraceright{}aggregation\textbraceright{}                               │
│   • NO nested objects (flat structure)                                      │
│   • Example: "line_conf_q95": 0.9891                                        │
│                                                                             │
│   \textbf{DISTRIBUTIONS (for visualization)      }                                   │
│   ──────────────────────────────────                                        │
│   • bins[]     : Histogram buckets                                          │
│   • counts[]   : Count per bucket                                           │
│   • quantiles  : q01, q05, q50, q95, q99                                    │
│                                                                             │
│   \textbf{CHECKS (itemized validation)   }                                           │
│   ─────────────────────────────                                             │
│   • id           : Unique check identifier                                  │
│   • category     : quality | coverage | structure | alignment | metadata    │
│   • severity     : critical | high | medium | low                           │
│   • passed       : boolean                                                  │
│   • threshold    : The threshold value used                                 │
│   • actual       : The measured value                                       │
│   • description  : What this check validates                                │
│   • recommendation: What to do if it fails                                  │
│                                                                             │
│   \textbf{DIAGNOSTICS (bounded samples) }                                            │
│   ──────────────────────────────                                            │
│   • count        : Total count of issues (may be >> sample_size)            │
│   • sample_size  : Actual samples included (max 20)                         │
│   • samples[]    : Worst examples (sorted by severity)                      │
│                                                                             │
│   \textbf{THRESHOLDS (explicit for reproducibility)  }                               │
│   ──────────────────────────────────────────                                │
│   • value        : Threshold value used                                     │
│   • description  : What this threshold controls                             │
│   • source       : "config" | "hardcoded" | "computed"                      │
│                                                                             │
│   \textbf{PROVENANCE (for traceability)    }                                         │
│   ──────────────────────────────                                            │
│   • inputs       : List of input file paths                                 │
│   • outputs      : List of output file paths                                │
│   • config_hash  : SHA256 fingerprint of params                             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### 2.2 The Template System


All report scripts use a standardised template (GX_YY_template_cpu_report.py):





~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                     <strong>   REPORT SCRIPT ARCHITECTURE  </strong>                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   resources.yaml              contract.py                 core.py           │
│        │                          │                          │              │
│        │   (threshold values)     │   (inputs/outputs)       │              │
│        └──────────────────────────┴──────────────────────────┘              │
│                                   │                                         │
│                                   ▼                                         │
│                       ┌────────────────────────┐                            │
│                       │   <strong>CONTRACT JSON </strong>       │                            │
│                       │                        │                            │
│                       │   doc_id: &quot;paper_123&quot;  │                            │
│                       │   inputs: {...}        │  ◄── QC files, spine data  │
│                       │   outputs: {...}       │  ◄── report.json           │
│                       │   params: {thresholds} │  ◄── ALL from YAML         │
│                       └────────────────────────┘                            │
│                                   │                                         │
│                                   ▼                                         │
│                       ┌────────────────────────┐                            │
│                       │   <strong>REPORT SCRIPT </strong>       │                            │
│                       │                        │                            │
│                       │   1. Load inputs       │                            │
│                       │   2. Extract metrics   │                            │
│                       │   3. Run checks        │                            │
│                       │   4. Sample diagnostics│                            │
│                       │   5. Build report      │                            │
│                       └────────────────────────┘                            │
│                                   │                                         │
│                       ┌───────────┴───────────┐                             │
│                       │                       │                             │
│                       ▼                       ▼                             │
│               lib/provenance.py         lib/timing.py                       │
│               (fingerprints)            (group durations)                   │
│                       │                       │                             │
│                       └───────────┬───────────┘                             │
│                                   │                                         │
│                                   ▼                                         │
│                       ┌────────────────────────┐                            │
│                       │   <strong>STANDARDISED REPORT </strong> │                            │
│                       │                        │                            │
│                       │   metrics: (flat)      │                            │
│                       │   distributions: {...} │                            │
│                       │   checks: [...]        │                            │
│                       │   diagnostics: {...}   │                            │
│                       │   thresholds: {...}    │                            │
│                       │   timing: {...}        │                            │
│                       │   provenance: {...}    │                            │
│                       └────────────────────────┘                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────────────────────┐
│                     \textbf{   REPORT SCRIPT ARCHITECTURE  }                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   resources.yaml              contract.py                 core.py           │
│        │                          │                          │              │
│        │   (threshold values)     │   (inputs/outputs)       │              │
│        └──────────────────────────┴──────────────────────────┘              │
│                                   │                                         │
│                                   ▼                                         │
│                       ┌────────────────────────┐                            │
│                       │   \textbf{CONTRACT JSON }       │                            │
│                       │                        │                            │
│                       │   doc_id: "paper_123"  │                            │
│                       │   inputs: \textbraceleft{\textbraceright{}...\textbraceright{}        │  ◄── QC files, spine data  │
│                       │   outputs: \textbraceleft{\textbraceright{}...\textbraceright{}       │  ◄── report.json           │
│                       │   params: \textbraceleft{\textbraceright{}thresholds\textbraceright{} │  ◄── ALL from YAML         │
│                       └────────────────────────┘                            │
│                                   │                                         │
│                                   ▼                                         │
│                       ┌────────────────────────┐                            │
│                       │   \textbf{REPORT SCRIPT }       │                            │
│                       │                        │                            │
│                       │   1. Load inputs       │                            │
│                       │   2. Extract metrics   │                            │
│                       │   3. Run checks        │                            │
│                       │   4. Sample diagnostics│                            │
│                       │   5. Build report      │                            │
│                       └────────────────────────┘                            │
│                                   │                                         │
│                       ┌───────────┴───────────┐                             │
│                       │                       │                             │
│                       ▼                       ▼                             │
│               lib/provenance.py         lib/timing.py                       │
│               (fingerprints)            (group durations)                   │
│                       │                       │                             │
│                       └───────────┬───────────┘                             │
│                                   │                                         │
│                                   ▼                                         │
│                       ┌────────────────────────┐                            │
│                       │   \textbf{STANDARDISED REPORT } │                            │
│                       │                        │                            │
│                       │   metrics: (flat)      │                            │
│                       │   distributions: \textbraceleft{\textbraceright{}...\textbraceright{} │                            │
│                       │   checks: [...]        │                            │
│                       │   diagnostics: \textbraceleft{\textbraceright{}...\textbraceright{}   │                            │
│                       │   thresholds: \textbraceleft{\textbraceright{}...\textbraceright{}    │                            │
│                       │   timing: \textbraceleft{\textbraceright{}...\textbraceright{}        │                            │
│                       │   provenance: \textbraceleft{\textbraceright{}...\textbraceright{}    │                            │
│                       └────────────────────────┘                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### 2.3 The Provenance System


Provenance answers: "Can I reproduce this exact result?"



We track THREE independent dimensions:





~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                         <strong> THREE FINGERPRINTS (HASHES)</strong>                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────┐   ┌─────────────────────┐   ┌─────────────────┐   │
│   │<strong>   CONFIG            │   │   CODE              │   │   PARAMS        │   │
│   │   FINGERPRINT       │   │   FINGERPRINT       │   │   FINGERPRINT  </strong> │   │
│   ├─────────────────────┤   ├─────────────────────┤   ├─────────────────┤   │
│   │                     │   │                     │   │                 │   │
│   │  SHA256 hash of     │   │  Git commit SHA     │   │  SHA256 hash of │   │
│   │  merged config      │   │  + dirty flag       │   │  stage params   │   │
│   │  (resources.yaml    │   │                     │   │                 │   │
│   │   + profile +       │   │  git:abc123def      │   │  a3b2c1d4...    │   │
│   │   env overrides)    │   │  -dirty:false       │   │  (16 chars)     │   │
│   │                     │   │                     │   │                 │   │
│   └─────────────────────┘   └─────────────────────┘   └─────────────────┘   │
│              │                         │                       │            │
│              ▼                         ▼                       ▼            │
│      &quot;Did the entire            &quot;Did the code          &quot;Did this stage&#39;s    │
│       config change?&quot;               change?&quot;            params change?&quot;     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────────────────────┐
│                         \textbf{ THREE FINGERPRINTS (HASHES)}                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────┐   ┌─────────────────────┐   ┌─────────────────┐   │
│   │\textbf{   CONFIG            │   │   CODE              │   │   PARAMS        │   │
│   │   FINGERPRINT       │   │   FINGERPRINT       │   │   FINGERPRINT  } │   │
│   ├─────────────────────┤   ├─────────────────────┤   ├─────────────────┤   │
│   │                     │   │                     │   │                 │   │
│   │  SHA256 hash of     │   │  Git commit SHA     │   │  SHA256 hash of │   │
│   │  merged config      │   │  + dirty flag       │   │  stage params   │   │
│   │  (resources.yaml    │   │                     │   │                 │   │
│   │   + profile +       │   │  git:abc123def      │   │  a3b2c1d4...    │   │
│   │   env overrides)    │   │  -dirty:false       │   │  (16 chars)     │   │
│   │                     │   │                     │   │                 │   │
│   └─────────────────────┘   └─────────────────────┘   └─────────────────┘   │
│              │                         │                       │            │
│              ▼                         ▼                       ▼            │
│      "Did the entire            "Did the code          "Did this stage's    │
│       config change?"               change?"            params change?"     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\end{Verbatim}
~~~








❓ Why Three Fingerprings (hases)
• config_fingerprint: Pipeline-wide. Any config change triggers this.
• code_fingerprint: Tracks Git. Even uncommitted changes are detected.
• params_fingerprint: Stage-specific. G2 params don't affect G4's hash.







### 2.4 The Trace System


While provenance tracks identity (what config/code), trace tracks history (what happened):





~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                        <strong>TRACE MANIFEST (run.jsonl)</strong>                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    <strong>TIME</strong> ────────────────────────────────────────────────────────────▶       │
│                                                                             │
│   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐       │
│   │  G1_01  │──▶│  <strong>G2_01</strong>  │──▶│  G2_01  │──▶│  G2_02  │──▶│  G2_09  <strong>│       │
│   │</strong> SUCCESS │   │ <strong>FAILURE </strong>│   │ SUCCESS │   │ SUCCESS │   │ SUCCESS │       │
│   └────┬────┘   └────┬────┘   └────┬────┘   └────┬────┘   └────┬────┘       │
│        │             │             │             │             │            │
│        ▼             ▼             ▼             ▼             ▼            │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                          <strong>run.jsonl</strong>                                │     │
│   │                                                                   │     │
│   │   {&quot;stage_id&quot;:&quot;G1_01&quot;,&quot;status&quot;:&quot;SUCCESS&quot;,&quot;attempt&quot;:1,...}         │     │
│   │   <strong>{&quot;stage_id&quot;:&quot;G2_01&quot;,&quot;status&quot;:&quot;FAILURE&quot;,&quot;attempt&quot;:1,&quot;error&quot;:..}</strong> ◄─ <strong>RETRY</strong> 
│   │   {&quot;stage_id&quot;:&quot;G2_01&quot;,&quot;status&quot;:&quot;SUCCESS&quot;,&quot;attempt&quot;:2,...} ◄─ <strong>RETRY SUCCEEDED</strong>
│   │   {&quot;stage_id&quot;:&quot;G2_02&quot;,&quot;status&quot;:&quot;SUCCESS&quot;,&quot;attempt&quot;:1,...}         │     │
│   │   {&quot;stage_id&quot;:&quot;G2_09&quot;,&quot;status&quot;:&quot;SUCCESS&quot;,&quot;attempt&quot;:1,...}         │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   <strong>APPEND-ONLY:</strong> If pipeline crashes mid-stage, we have all prior records.    │
│   <strong>CRASH-SAFE:</strong> No corruption, no data loss.                                  │
│   <strong>DEBUGGABLE:</strong> Easy to grep/query with jq.                                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────────────────────┐
│                        \textbf{TRACE MANIFEST (run.jsonl)}                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    \textbf{TIME} ────────────────────────────────────────────────────────────▶       │
│                                                                             │
│   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐       │
│   │  G1_01  │──▶│  \textbf{G2_01}  │──▶│  G2_01  │──▶│  G2_02  │──▶│  G2_09  \textbf{│       │
│   │} SUCCESS │   │ \textbf{FAILURE }│   │ SUCCESS │   │ SUCCESS │   │ SUCCESS │       │
│   └────┬────┘   └────┬────┘   └────┬────┘   └────┬────┘   └────┬────┘       │
│        │             │             │             │             │            │
│        ▼             ▼             ▼             ▼             ▼            │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                          \textbf{run.jsonl}                                │     │
│   │                                                                   │     │
│   │   \textbraceleft{\textbraceright{}"stage_id":"G1_01","status":"SUCCESS","attempt":1,...\textbraceright{}         │     │
│   │   \textbf{\textbraceleft{\textbraceright{}"stage_id":"G2_01","status":"FAILURE","attempt":1,"error":..\textbraceright{}} ◄─ \textbf{RETRY} 
│   │   \textbraceleft{\textbraceright{}"stage_id":"G2_01","status":"SUCCESS","attempt":2,...\textbraceright{} ◄─ \textbf{RETRY SUCCEEDED}
│   │   \textbraceleft{\textbraceright{}"stage_id":"G2_02","status":"SUCCESS","attempt":1,...\textbraceright{}         │     │
│   │   \textbraceleft{\textbraceright{}"stage_id":"G2_09","status":"SUCCESS","attempt":1,...\textbraceright{}         │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   \textbf{APPEND-ONLY:} If pipeline crashes mid-stage, we have all prior records.    │
│   \textbf{CRASH-SAFE:} No corruption, no data loss.                                  │
│   \textbf{DEBUGGABLE:} Easy to grep/query with jq.                                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\end{Verbatim}
~~~




### 2.5 Example Report: G2_09 Spine Report


The G2_09 report consolidates all G2 quality control into a single Spine Health Score:





~~~{=html}
<pre class="notion-ascii-diagram"><code><strong>JSON</strong>

{
  &quot;doc_id&quot;: &quot;101002alz13610_genetic_risk_score_for_alzheimers_2024&quot;,
  &quot;stage_id&quot;: &quot;G2_09&quot;,
  &quot;version&quot;: &quot;G2_09_v1&quot;,
  &quot;pass&quot;: true,
  &quot;confidence&quot;: 1.0,

  &quot;summary&quot;: {
    &quot;status&quot;: &quot;PASS&quot;,
    &quot;status_reason&quot;: &quot;All checks passed&quot;,
    &quot;critical_failures&quot;: [],
    &quot;warnings&quot;: []
  },

  &quot;metrics&quot;: {
    &quot;line_tokens_total&quot;: 990,
    &quot;word_tokens_total&quot;: 6980,
    &quot;spine_health_score&quot;: 0.9229,      // <strong>◄── Composite quality score</strong>
    &quot;health_ocr_score&quot;: 0.9808,
    &quot;health_reading_order_score&quot;: 0.8805,
    &quot;health_geometry_score&quot;: 0.8939,
    &quot;health_tagging_score&quot;: 0.9404
  },

  &quot;checks&quot;: [
    {
      &quot;id&quot;: &quot;min_line_tokens&quot;,
      &quot;category&quot;: &quot;coverage&quot;,
      &quot;severity&quot;: &quot;critical&quot;,
      &quot;passed&quot;: true,
      &quot;threshold&quot;: 50,
      &quot;actual&quot;: 990,
      &quot;description&quot;: &quot;Minimum number of line tokens extracted from document&quot;,
      &quot;recommendation&quot;: &quot;Check if PDF is readable or contains extractable text&quot;
    }
  ],

  &quot;provenance&quot;: {
    &quot;inputs&quot;: [&quot;line_qc.json&quot;, &quot;word_qc.json&quot;, &quot;reading_order_voted.json&quot;, ...],
    &quot;outputs&quot;: [&quot;report.json&quot;],
    &quot;config_hash&quot;: &quot;8a72e5d82def7cef&quot;
  }
}</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
\textbf{JSON}

\textbraceleft{\textbraceright{}
  "doc_id": "101002alz13610_genetic_risk_score_for_alzheimers_2024",
  "stage_id": "G2_09",
  "version": "G2_09_v1",
  "pass": true,
  "confidence": 1.0,

  "summary": \textbraceleft{\textbraceright{}
    "status": "PASS",
    "status_reason": "All checks passed",
    "critical_failures": [],
    "warnings": []
  \textbraceright{},

  "metrics": \textbraceleft{\textbraceright{}
    "line_tokens_total": 990,
    "word_tokens_total": 6980,
    "spine_health_score": 0.9229,      // \textbf{◄── Composite quality score}
    "health_ocr_score": 0.9808,
    "health_reading_order_score": 0.8805,
    "health_geometry_score": 0.8939,
    "health_tagging_score": 0.9404
  \textbraceright{},

  "checks": [
    \textbraceleft{\textbraceright{}
      "id": "min_line_tokens",
      "category": "coverage",
      "severity": "critical",
      "passed": true,
      "threshold": 50,
      "actual": 990,
      "description": "Minimum number of line tokens extracted from document",
      "recommendation": "Check if PDF is readable or contains extractable text"
    \textbraceright{}
  ],

  "provenance": \textbraceleft{\textbraceright{}
    "inputs": ["line_qc.json", "word_qc.json", "reading_order_voted.json", ...],
    "outputs": ["report.json"],
    "config_hash": "8a72e5d82def7cef"
  \textbraceright{}
\textbraceright{}
\end{Verbatim}
~~~




---


## 3. Key Technical Outcomes


### 3.1 Design Principles



<table>
  <thead>
    <tr>
      <th><strong>Principle</strong></th>
      <th><strong>Implementation</strong></th>
      <th><strong>Benefit</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Flat Metrics</strong></td>
      <td>No nested objects in <code>metrics</code></td>
      <td>DuckDB-queryable</td>
    </tr>
    <tr>
      <td><strong>Bounded Diagnostics</strong></td>
      <td>Max 20 samples per issue type</td>
      <td>Predictable report size</td>
    </tr>
    <tr>
      <td><strong>Explicit Thresholds</strong></td>
      <td>All thresholds documented with source</td>
      <td>Reproducibility</td>
    </tr>
    <tr>
      <td><strong>Severity Levels</strong></td>
      <td>critical &gt; high &gt; medium &gt; low</td>
      <td>Clear pass/fail criteria</td>
    </tr>
    <tr>
      <td><strong>Deterministic Output</strong></td>
      <td>Sorted keys, stable iteration</td>
      <td>Same input = same output</td>
    </tr>
    <tr>
      <td><strong>Provenance Fingerprints</strong></td>
      <td>Config + Code + Params hashes</td>
      <td>Full traceability</td>
    </tr>
  </tbody>
</table>



### 3.2 Severity-Based Pass/Fail Logic




~~~{=html}
<pre class="notion-ascii-diagram"><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                           <strong>PASS/FAIL DECISION TREE   </strong>                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                 Run all checks ──▶ Categorize by severity                   │
│                                                                             │
│          ┌─────────────────────────────────────────────────────┐            │
│          │                                                     │            │
│          ▼                                                     ▼            │
│   ┌─────────────┐                                       ┌─────────────┐     │
│   │  <strong>CRITICAL</strong>   │                                       │    <strong>HIGH </strong>    │     │
│   │  failures?  │                                       │  failures?  │     │
│   └──────┬──────┘                                       └──────┬──────┘     │
│          │                                                     │            │
│     Yes  │  No                                            Yes  │  No        │
│          │                                                     │            │
│          ▼                                                     ▼            │
│   ┌─────────────┐                                       ┌─────────────┐     │
│   │    <strong>FAIL</strong>     │                                       │    <strong>WARN </strong>    │     │
│   │             │                                       │             │     │
│   │ Pipeline    │                                       │ Pass with   │     │
│   │ MUST stop   │                                       │ warnings    │     │
│   └─────────────┘                                       └─────────────┘     │
│                                                                             │
│                               <strong>No failures</strong>                                   │
│                                    │                                        │
│                                    ▼                                        │
│                             ┌─────────────┐                                 │
│                             │    <strong>PASS </strong>    │                                 │
│                             │ All checks  │                                 │
│                             │   passed    │                                 │
│                             └─────────────┘                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
┌─────────────────────────────────────────────────────────────────────────────┐
│                           \textbf{PASS/FAIL DECISION TREE   }                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                 Run all checks ──▶ Categorize by severity                   │
│                                                                             │
│          ┌─────────────────────────────────────────────────────┐            │
│          │                                                     │            │
│          ▼                                                     ▼            │
│   ┌─────────────┐                                       ┌─────────────┐     │
│   │  \textbf{CRITICAL}   │                                       │    \textbf{HIGH }    │     │
│   │  failures?  │                                       │  failures?  │     │
│   └──────┬──────┘                                       └──────┬──────┘     │
│          │                                                     │            │
│     Yes  │  No                                            Yes  │  No        │
│          │                                                     │            │
│          ▼                                                     ▼            │
│   ┌─────────────┐                                       ┌─────────────┐     │
│   │    \textbf{FAIL}     │                                       │    \textbf{WARN }    │     │
│   │             │                                       │             │     │
│   │ Pipeline    │                                       │ Pass with   │     │
│   │ MUST stop   │                                       │ warnings    │     │
│   └─────────────┘                                       └─────────────┘     │
│                                                                             │
│                               \textbf{No failures}                                   │
│                                    │                                        │
│                                    ▼                                        │
│                             ┌─────────────┐                                 │
│                             │    \textbf{PASS }    │                                 │
│                             │ All checks  │                                 │
│                             │   passed    │                                 │
│                             └─────────────┘                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

\end{Verbatim}
~~~




### 3.3 Corpus-Level Analysis


Because all reports follow the same schema, we can query across 100,000+ documents:





~~~{=html}
<pre class="notion-ascii-diagram"><code><strong>SQL</strong>

<strong>-- Pass rate by stage across entire corpus</strong>
SELECT
    stage_id,
    COUNT(*) as total_docs,
    AVG(CASE WHEN pass THEN 1 ELSE 0 END) as pass_rate,
    AVG(metrics.spine_health_score) as avg_health
FROM reports
GROUP BY stage_id;

<strong>-- Find documents with OCR quality issues</strong>
SELECT
    doc_id,
    metrics.line_conf_q05 as worst_confidence
FROM reports
WHERE stage_id = &#39;G2_09&#39;
  AND metrics.line_conf_q05 &lt; 0.7
ORDER BY worst_confidence ASC;

<strong>-- Threshold sensitivity analysis</strong>
SELECT
    ROUND(thresholds.min_reading_order_confidence.value, 2) as threshold,
    COUNT(*) FILTER (WHERE pass) as passing
FROM reports
WHERE stage_id = &#39;G2_09&#39;
GROUP BY 1
ORDER BY 1;
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
\textbf{SQL}

\textbf{-- Pass rate by stage across entire corpus}
SELECT
    stage_id,
    COUNT(*) as total_docs,
    AVG(CASE WHEN pass THEN 1 ELSE 0 END) as pass_rate,
    AVG(metrics.spine_health_score) as avg_health
FROM reports
GROUP BY stage_id;

\textbf{-- Find documents with OCR quality issues}
SELECT
    doc_id,
    metrics.line_conf_q05 as worst_confidence
FROM reports
WHERE stage_id = 'G2_09'
  AND metrics.line_conf_q05 < 0.7
ORDER BY worst_confidence ASC;

\textbf{-- Threshold sensitivity analysis}
SELECT
    ROUND(thresholds.min_reading_order_confidence.value, 2) as threshold,
    COUNT(*) FILTER (WHERE pass) as passing
FROM reports
WHERE stage_id = 'G2_09'
GROUP BY 1
ORDER BY 1;

\end{Verbatim}
~~~




### 3.4 Template Compliance Rules


Every report script MUST follow these rules:




<table>
  <thead>
    <tr>
      <th><strong>Rule</strong></th>
      <th><strong>Violation</strong></th>
      <th><strong>Correct</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>No hardcoded thresholds</td>
      <td><code>if conf &lt; 0.85:</code></td>
      <td><code>if conf &lt; params[&quot;min_conf&quot;]:</code></td>
    </tr>
    <tr>
      <td>No default params</td>
      <td><code>params.get(&quot;x&quot;, 0.8)</code></td>
      <td><code>params[&quot;x&quot;]</code> (fail hard)</td>
    </tr>
    <tr>
      <td>Flat metrics</td>
      <td><code>{&quot;conf&quot;: {&quot;mean&quot;: 0.9}}</code></td>
      <td><code>{&quot;conf_mean&quot;: 0.9}</code></td>
    </tr>
    <tr>
      <td>Bounded diagnostics</td>
      <td><code>&quot;issues&quot;: [...]</code> (1000s)</td>
      <td><code>&quot;count&quot;: 847, &quot;samples&quot;: [20]</code></td>
    </tr>
    <tr>
      <td>Truncated text</td>
      <td>Full paragraph</td>
      <td>Max 50 chars + &quot;...&quot;</td>
    </tr>
    <tr>
      <td>Documented thresholds</td>
      <td>Threshold used but not explained</td>
      <td>Every threshold in <code>thresholds{}</code></td>
    </tr>
    <tr>
      <td>Deterministic output</td>
      <td>Random iteration order</td>
      <td><code>sort_keys=True</code>, sorted lists</td>
    </tr>
  </tbody>
</table>



---


## 4. Critical Reflection


### 4.1 Strengths



<table>
  <thead>
    <tr>
      <th><strong>Aspect</strong></th>
      <th><strong>Strength</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Queryability</strong></td>
      <td>All reports queryable in DuckDB—corpus-level analysis in seconds</td>
    </tr>
    <tr>
      <td><strong>Reproducibility</strong></td>
      <td>Three fingerprints guarantee exact reproduction of any result</td>
    </tr>
    <tr>
      <td><strong>Scalability</strong></td>
      <td>Bounded diagnostics keep report sizes under control at 100k docs</td>
    </tr>
    <tr>
      <td><strong>Debuggability</strong></td>
      <td>Clear checks with thresholds make failures actionable</td>
    </tr>
    <tr>
      <td><strong>Standardisation</strong></td>
      <td>Template ensures consistency across 8 report stages</td>
    </tr>
  </tbody>
</table>



### 4.2 Weaknesses and Risks



<table>
  <thead>
    <tr>
      <th><strong>Risk</strong></th>
      <th><strong>Impact</strong></th>
      <th><strong>Mitigation</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Schema drift</strong></td>
      <td>Different stages might diverge over time</td>
      <td>Template enforcement, linting</td>
    </tr>
    <tr>
      <td><strong>Threshold tuning</strong></td>
      <td>Thresholds may need adjustment per corpus</td>
      <td>All thresholds in config, not code</td>
    </tr>
    <tr>
      <td><strong>Sample bias</strong></td>
      <td>Worst 20 samples may not represent all issues</td>
      <td>Include total count for context</td>
    </tr>
    <tr>
      <td><strong>Fingerprint collisions</strong></td>
      <td>Extremely unlikely but theoretically possible</td>
      <td>64+ character hashes, checked at scale</td>
    </tr>
  </tbody>
</table>



### 4.3 Design Trade-offs



<table>
  <thead>
    <tr>
      <th><strong>Decision</strong></th>
      <th><strong>Trade-off</strong></th>
      <th><strong>Justification</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Flat metrics</td>
      <td>Less semantic structure</td>
      <td>DuckDB compatibility &gt; expressiveness</td>
    </tr>
    <tr>
      <td>Max 20 samples</td>
      <td>May miss context</td>
      <td>Predictable size &gt; completeness</td>
    </tr>
    <tr>
      <td>Three fingerprints</td>
      <td>Complexity</td>
      <td>Granular traceability &gt; simplicity</td>
    </tr>
    <tr>
      <td>Append-only trace</td>
      <td>Growing file size</td>
      <td>Crash safety &gt; space efficiency</td>
    </tr>
  </tbody>
</table>



### 4.4 Maintenance Concerns


Complexity Level: MODERATE



The report system has dependencies on:





~~~{=html}
<pre class="notion-ascii-diagram"><code><strong>DEPENDENCY CHAIN:
</strong>─────────────────

lib/provenance.py ──┐
                    │
lib/trace.py ───────┼──▶ REPORT SCRIPTS ──▶ report.json
                    │
lib/timing.py ──────┘
</code></pre>
~~~

~~~{=latex}
\begin{Verbatim}[commandchars=\\\{\}]
\textbf{DEPENDENCY CHAIN:
}─────────────────

lib/provenance.py ──┐
                    │
lib/trace.py ───────┼──▶ REPORT SCRIPTS ──▶ report.json
                    │
lib/timing.py ──────┘

\end{Verbatim}
~~~




Changes to any provenance/trace module require updating all report scripts.



---


## 5. Next Steps


### 5.1 Future Enhancements

1. **Report Aggregator Stage**
    - Combine all per-document reports into corpus-level statistics
    - Generate pass/fail summary for entire batch
2. **Post 500 PDF batch run: Threshold Optimisation**
    - Analyse corpus to find optimal threshold values
    - Sensitivity analysis: Δ(pass_rate) /Δ(threshold)





$$
\frac{\Delta \text{Pass Rate}}{\Delta \text{Threshold}}
$$


Per Document stage:








What is this?




$$
\mathrm{Pass}_{s,i}=\mathbf{1}\!\left[m_{s,i}\ge \tau_s\right]
$$


Number of documents that pass single stage s:



$$
\mathrm{Pass\ Count}_s=\sum_{i=1}^{N}\mathrm{Pass}_{s,i}
$$


Pass rate for single stage s:



$$
\mathrm{Pass\ Rate}_s=\frac{1}{N}\sum_{i=1}^{N}\mathrm{Pass}_{s,i}
$$






$$
\mathrm{Total\ Pass}=\sum_{s=1}^{S}\sum_{i=1}^{N}\mathrm{Pass}_{s,i}
$$






Overall average pass rate across all stage-results (all stages × all docs):



$$
\mathrm{Avg\ Pass\ Rate}=\frac{1}{SN}\sum_{s=1}^{S}\sum_{i=1}^{N}\mathrm{Pass}_{s,i}
$$





- $s$ = DAG stage (G (e.g., stage 1… $s$ )
- $i$ = Document (PDF) (e.g., document 1… $i$ )
- $\mathrm{Pass}_{s,i}$ = `pass`/ `fail` outcome for stage `s` on document `i` (1 = pass, 0 = fail)
- $\mathrm{m}_{s,i}$ = metric value computed at stage **s** for document **i**
- $\tau_s$ = threshold for stage **s**
- $\mathbf{1}[\cdot]$ = indicator function (returns 1 if condition is true, else 0)









You’re close. What you have is the math, but you’re missing the operational sequence (what gets computed, in what order, and what each number is used for).



## Sequence of events (end-to-end)

1. **Define the stage metric**
    - For each DAG stage $s$, define exactly **one quality control metric** $m$ you can compute per document $i$.
    - Example: “line coverage”, “table cell overlap”, “token join coverage”, etc.
2. **Compute raw metric values**
    - For every document $i$ at stage $s$, calculate:

    $$
    \mathrm{m}_{s,i}
    $$

    - Example: if line coverage = 0.91 , $\mathrm{m}_{2,234} = 0.91$ (stage 2, document 234)
    - This produces a vector per stage: $({m_{s,1},\dots,m_{s,N}})$.
3. **Choose a threshold for that stage**
    - Select a threshold $\tau$ for the metric above $m$ (initially from intuition, later optimized from data).

        $$
        \tau_s \in \mathbb{R}
        $$

    - Example: if threshold for for all metrics = 0.9, $\tau_2 = 0.9$ (total threshold for stage 2)
4. **Compute the metric against the threshold**
    - For every metric calculate the metric and threshold Pass or Fail

$$
m_{s,i} \ge \tau_s \Rightarrow \mathrm{PASS}
\qquad
m_{s,i} < \tau_s \Rightarrow \mathrm{FAIL}
$$

1. **Convert metric → PASS/FAIL per document**
    - For every doc $i:$

        $$
        \mathrm{PASS}{s,i}=\mathbf{1}[m{s,i}\ge \tau_s]
        $$

    - This is **per document, per stage** (not a pass rate).
2. **Aggregate to stage-level stats**
    - Count how many docs pass stage $s:$

        [
        


        $$
        \mathrm{PASS\_ COUNT}s=\sum{i=1}^{N}\mathrm{PASS}_{s,i}
        $$


        ]
        

    - Pass rate for stage (s):

        [
        


        \mathrm{PASS_RATE}s=\frac{1}{N}\sum{i=1}^{N}\mathrm{PASS}_{s,i}
        


        ]
        

3. **(Optional but usually needed) Compute pipeline-level pass**
    - A document passes the pipeline only if it passes **all** stages:

        [
        


        \mathrm{DOC_PASS}i=\prod{s=1}^{S}\mathrm{PASS}_{s,i}
        


        ]
        

    - Pipeline pass rate:

        [
        


        \mathrm{PIPELINE_PASS_RATE}=\frac{1}{N}\sum_{i=1}^{N}\mathrm{DOC_PASS}_i
        


        ]
        

4. **Sensitivity analysis (threshold brittleness)**
    - Pick a small (\Delta\tau) (must be stated).
    - Recompute pass rate at (\tau_s) and (\tau_s+\Delta\tau):[\frac{\Delta \mathrm{PASS_RATE}_s}{\Delta \tau}

        \frac{\mathrm{PASS_RATE}_s(\tau_s+\Delta\tau)-\mathrm{PASS_RATE}_s(\tau_s)}{\Delta\tau}
        


        ]
        

    - Interpretation: “how many docs flip if I tighten the threshold slightly?”
5. **Threshold selection (what “optimal” means)**
    - You need a criterion, e.g.:
        - maximise (\mathrm{PASS_RATE}_s) subject to quality constraints, **or**
        - choose (\tau_s) in a **low-sensitivity region** (stable), **or**
        - hit a target failure budget per stage.

## What you’re missing (that makes this understandable and defensible)

- **A clear definition of (m_{s,i}) per stage** (units, range, direction: higher is better?)
- **A stated (\Delta\tau)** for sensitivity (otherwise the number is meaningless)
- **A pipeline-level pass definition** (AND across stages) — your “Avg Pass Rate across all stage-results” can look good even if the pipeline fails often.
- **Failure reason breakdown per stage** (counts by reason), otherwise PASS/FAIL isn’t actionable.
- **A threshold selection rule** (“optimal” relative to what objective/constraint?)

If you want, paste one stage’s metric definition (just one), and I’ll rewrite the Notion block as a clean “Stage QC sequence” template with the exact fields and equations in the order above.










