## Issues & Debugging (15+ Required) — Issue 4: Metadata Correction

**Description:**  
# UK Biobank PDF Metadata Back-Matching Process

## Background
- Previous method: extracted UK Biobank metadata, downloaded PDFs, but did not link metadata to files.
- Problem: metadata was not tied to filenames → could not guarantee link between downloaded PDF and original UK Biobank record.
- Solution: revisit original code and create a new script to retroactively match PDFs to metadata.

---

## New Script
<image placeholder - script logic diagram>

- Reads all downloaded PDFs (total = 6,841).
- Extracts DOI, authors, title from PDF content.
- Matches extracted DOI to original UK Biobank metadata list.
- Creates JSON file linking filename → metadata.
- Benefit:
- Metadata capture in Marker JSON step is no longer required.
- UK Biobank source metadata is already accurate; this script just aligns filenames with it.
- DOI chosen as primary match key (most accurate, least ambiguous).

---

## Unexpected Discovery
- Some PDFs were not in UK Biobank list → indicates download process error.
- Errors:
- PDFs incomplete or corrupted
- PDFs not readable
- This process filters out non-Biobank PDFs automatically.

---

## Independent Validation Script
- Separate script created to verify matching accuracy.
- Population: 6,367 matched PDFs
- <image placeholder - matching summary table>

### Sampling Details
- Sample Size: 363 randomly selected matches
- Random Seed: 42 (reproducibility)
- Sampling Rate: 5.70%
- Confidence Level: 95%
- Margin of Error Target: ±5.0%
- Statistical approach: z-test (N > 30)

<image placeholder - z-test formula><image placeholder - z-test calculation>

Parameters:
- Z = 1.96 (95% confidence)
- p = 0.5 (max variability)
- E = 0.05 (margin ±5%)
- N = 6,367

<image placeholder - calculated sample requirement>

---

## Results

### Validation Outcomes
- Confirmed Matches: 310/363 → 85.4% (raw check)
- Failed Matches: 3/363 → 0.8% (technical error rate)

---

## Confidence Interval Calculation
- Method: Wilson score interval, 95% confidence (z = 1.96)
- Observed Success Rate: 99.2%
- 95% CI: [97.6%, 99.7%]
- Margin of Error: ±1.1%

✅ Statistical Significance: p < 0.05
→ True match accuracy lies between 97.6% and 99.7%.

Expected matches if all 6,367 were validated:6,214 to 6,349 correct matches (≈6,314 ± 67)

---

## Sample Size Adequacy
- Current margin: ±1.1%
- Recommended sample for ±5%: 385
- Current sample = 471.7% of required precision

✅ Sample size more than adequate

---

## Conclusion
- Matching system is highly accurate and statistically robust.
- Will use JSON file with connected metadata to link PDFs for downstream processing.
- This ensures:
- Clean, reliable metadata for embeddings and knowledge trees
- Only verified UK Biobank PDFs are included
  

**summary:** The problem was that metadata from the UK Biobank was not linked to downloaded PDF files, making it impossible to confirm the relationship between the PDFs and the original records. The solution involved creating a new script to retroactively match the PDFs to the metadata using extracted DOIs, resulting in a JSON file that accurately links filenames to their corresponding metadata.  
**Resolved:** ✓  
**Date:** 2025-08-09  
**Hours:** 2  
**Category:** Data Processing  
**Solution:** ## Solution:
- Revisit original code and create a new script to retroactively match PDFs to metadata.  
**Issue:** Metadata Correction  

## Content


# UK Biobank PDF Metadata Back-Matching Process


## Background

- Previous method: extracted UK Biobank metadata, downloaded PDFs, **but did not link metadata to files**.
- Problem: metadata was not tied to filenames → could not guarantee link between downloaded PDF and original UK Biobank record.
- Solution: revisit original code and create a **new script** to retroactively match PDFs to metadata.

---


## New Script






```c
============================================================
 PROCESSING COMPLETE
============================================================
Time elapsed    : 46.3 seconds
Speed           : 147.9 PDFs/second
Total PDFs      : 6841
✅ Matched      : 6367 (93.1%)
❓ Unmatched    : 324
❌ Errors       : 150
Output          : /data/output/matches.json
Unmatched       : /data/output/unmatched.json
 ============================================================
```





- Reads all downloaded PDFs (**total = 6,841**).
- Extracts DOI, authors, title from PDF content.
- Matches extracted DOI to original UK Biobank metadata list.
- Creates **JSON file** linking `filename → metadata`.
- Benefit:
    - Metadata capture in Marker JSON step is no longer required.
    - UK Biobank source metadata is already accurate; this script just aligns filenames with it.
- DOI chosen as primary match key (most accurate, least ambiguous).

---


## Unexpected Discovery

- Some PDFs were **not in UK Biobank list** → indicates download process error.
- Errors:
    - PDFs incomplete or corrupted
    - PDFs not readable
- This process filters out non-Biobank PDFs automatically.

---


## Independent Validation Script

- Separate script created to verify matching accuracy.
- **Population**: 6,367 matched PDFs
- `<image placeholder - matching summary table>`

### Sampling Details

- **Sample Size**: 363 randomly selected matches
- **Random Seed**: 42 (reproducibility)
- **Sampling Rate**: 5.70%
- **Confidence Level**: 95%
- **Margin of Error Target**: ±5.0%
- Statistical approach: z-test (N > 30)

$$
z = \frac{Z^2 \cdot p \cdot (1 - p)}{E^2}
$$


$$
n = \frac{\frac{Z^2 \cdot p \cdot (1 - p)}{E^2}}{1 + \frac{\frac{Z^2 \cdot p \cdot (1 - p)}{E^2} - 1}{N}}
$$


Parameters:


- Z = 1.96 (95% confidence)
- p = 0.5 (max variability)
- E = 0.05 (margin ±5%)
- N = 6,367

$$
n = \frac{\frac{(1.96)^2 \cdot 0.5 \cdot 0.5}{0.05^2}}{1 + \frac{\frac{(1.96)^2 \cdot 0.5 \cdot 0.5}{0.05^2} - 1}{6367}}
\\[20pt]
n \approx 362.9 \quad \Rightarrow \quad 363 \ \text{people}
$$


---


## Results


### Validation Outcomes

- **Confirmed Matches**: 310/363 → 85.4% (raw check)
- **Failed Matches**: 3/363 → 0.8% (technical error rate)

---


## Confidence Interval Calculation

- Method: Wilson score interval, 95% confidence (z = 1.96)
- Observed Success Rate: **99.2%**
- 95% CI: **[97.6%, 99.7%]**
- Margin of Error: ±1.1%

✅ Statistical Significance: p < 0.05



→ True match accuracy lies between 97.6% and 99.7%.



Expected matches if all 6,367 were validated:



6,214 to 6,349 correct matches (≈6,314 ± 67)



---


## Sample Size Adequacy

- Current margin: ±1.1%
- Recommended sample for ±5%: 385
- Current sample = 471.7% of required precision

✅ Sample size more than adequate



---


## Conclusion

- Matching system is **highly accurate** and statistically robust.
- Will use JSON file with connected metadata to link PDFs for downstream processing.
- This ensures:
    - Clean, reliable metadata for embeddings and knowledge trees
    - Only verified UK Biobank PDFs are included




